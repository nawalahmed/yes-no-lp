module.exports=[74836,(e,t,s)=>{"use strict";let r=["nodebuffer","arraybuffer","fragments"],i="u">typeof Blob;i&&r.push("blob"),t.exports={BINARY_TYPES:r,CLOSE_TIMEOUT:3e4,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:i,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}},97970,(e,t,s)=>{"use strict";let{EMPTY_BUFFER:r}=e.r(74836),i=Buffer[Symbol.species];function o(e,t,s,r,i){for(let o=0;o<i;o++)s[r+o]=e[o]^t[3&o]}function n(e,t){for(let s=0;s<e.length;s++)e[s]^=t[3&s]}function a(e){let t;return(a.readOnly=!0,Buffer.isBuffer(e))?e:(e instanceof ArrayBuffer?t=new i(e):ArrayBuffer.isView(e)?t=new i(e.buffer,e.byteOffset,e.byteLength):(t=Buffer.from(e),a.readOnly=!1),t)}if(t.exports={concat:function(e,t){if(0===e.length)return r;if(1===e.length)return e[0];let s=Buffer.allocUnsafe(t),o=0;for(let t=0;t<e.length;t++){let r=e[t];s.set(r,o),o+=r.length}return o<t?new i(s.buffer,s.byteOffset,o):s},mask:o,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:a,unmask:n},!process.env.WS_NO_BUFFER_UTIL)try{let e=(()=>{let e=Error("Cannot find module 'bufferutil'");throw e.code="MODULE_NOT_FOUND",e})();t.exports.mask=function(t,s,r,i,n){n<48?o(t,s,r,i,n):e.mask(t,s,r,i,n)},t.exports.unmask=function(t,s){t.length<32?n(t,s):e.unmask(t,s)}}catch(e){}},62048,(e,t,s)=>{"use strict";let r=Symbol("kDone"),i=Symbol("kRun");t.exports=class{constructor(e){this[r]=()=>{this.pending--,this[i]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[i]()}[i](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[r])}}}},80295,(e,t,s)=>{"use strict";let r,i=e.r(6461),o=e.r(97970),n=e.r(62048),{kStatusCode:a}=e.r(74836),u=Buffer[Symbol.species],l=Buffer.from([0,0,255,255]),h=Symbol("permessage-deflate"),c=Symbol("total-length"),d=Symbol("callback"),f=Symbol("buffers"),p=Symbol("error");function m(e){this[f].push(e),this[c]+=e.length}function y(e){(this[c]+=e.length,this[h]._maxPayload<1||this[c]<=this[h]._maxPayload)?this[f].push(e):(this[p]=RangeError("Max payload size exceeded"),this[p].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[p][a]=1009,this.removeListener("data",y),this.reset())}function g(e){(this[h]._inflate=null,this[p])?this[d](this[p]):(e[a]=1007,this[d](e))}t.exports=class{constructor(e,t,s){this._maxPayload=0|s,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,r||(r=new n(void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10))}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[d];this._deflate.close(),this._deflate=null,e&&e(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,s=e.find(e=>(!1!==t.serverNoContextTakeover||!e.server_no_context_takeover)&&(!e.server_max_window_bits||!1!==t.serverMaxWindowBits&&("number"!=typeof t.serverMaxWindowBits||!(t.serverMaxWindowBits>e.server_max_window_bits)))&&("number"!=typeof t.clientMaxWindowBits||!!e.client_max_window_bits));if(!s)throw Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(s.server_no_context_takeover=!0),t.clientNoContextTakeover&&(s.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(s.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?s.client_max_window_bits=t.clientMaxWindowBits:(!0===s.client_max_window_bits||!1===t.clientMaxWindowBits)&&delete s.client_max_window_bits,s}acceptAsClient(e){let t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{let s=e[t];if(s.length>1)throw Error(`Parameter "${t}" must have only a single value`);if(s=s[0],"client_max_window_bits"===t){if(!0!==s){let e=+s;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${s}`);s=e}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${t}": ${s}`)}else if("server_max_window_bits"===t){let e=+s;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${s}`);s=e}else if("client_no_context_takeover"===t||"server_no_context_takeover"===t){if(!0!==s)throw TypeError(`Invalid value for parameter "${t}": ${s}`)}else throw Error(`Unknown parameter "${t}"`);e[t]=s})}),e}decompress(e,t,s){r.add(r=>{this._decompress(e,t,(e,t)=>{r(),s(e,t)})})}compress(e,t,s){r.add(r=>{this._compress(e,t,(e,t)=>{r(),s(e,t)})})}_decompress(e,t,s){let r=this._isServer?"client":"server";if(!this._inflate){let e=`${r}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=i.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[h]=this,this._inflate[c]=0,this._inflate[f]=[],this._inflate.on("error",g),this._inflate.on("data",y)}this._inflate[d]=s,this._inflate.write(e),t&&this._inflate.write(l),this._inflate.flush(()=>{let e=this._inflate[p];if(e){this._inflate.close(),this._inflate=null,s(e);return}let i=o.concat(this._inflate[f],this._inflate[c]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[c]=0,this._inflate[f]=[],t&&this.params[`${r}_no_context_takeover`]&&this._inflate.reset()),s(null,i)})}_compress(e,t,s){let r=this._isServer?"server":"client";if(!this._deflate){let e=`${r}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=i.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[c]=0,this._deflate[f]=[],this._deflate.on("data",m)}this._deflate[d]=s,this._deflate.write(e),this._deflate.flush(i.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let e=o.concat(this._deflate[f],this._deflate[c]);t&&(e=new u(e.buffer,e.byteOffset,e.length-4)),this._deflate[d]=null,this._deflate[c]=0,this._deflate[f]=[],t&&this.params[`${r}_no_context_takeover`]&&this._deflate.reset(),s(null,e)})}}},58739,(e,t,s)=>{"use strict";let{isUtf8:r}=e.r(874),{hasBlob:i}=e.r(74836);function o(e){let t=e.length,s=0;for(;s<t;)if((128&e[s])==0)s++;else if((224&e[s])==192){if(s+1===t||(192&e[s+1])!=128||(254&e[s])==192)return!1;s+=2}else if((240&e[s])==224){if(s+2>=t||(192&e[s+1])!=128||(192&e[s+2])!=128||224===e[s]&&(224&e[s+1])==128||237===e[s]&&(224&e[s+1])==160)return!1;s+=3}else{if((248&e[s])!=240||s+3>=t||(192&e[s+1])!=128||(192&e[s+2])!=128||(192&e[s+3])!=128||240===e[s]&&(240&e[s+1])==128||244===e[s]&&e[s+1]>143||e[s]>244)return!1;s+=4}return!0}if(t.exports={isBlob:function(e){return i&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&("Blob"===e[Symbol.toStringTag]||"File"===e[Symbol.toStringTag])},isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:o,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},r)t.exports.isValidUTF8=function(e){return e.length<24?o(e):r(e)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let e=(()=>{let e=Error("Cannot find module 'utf-8-validate'");throw e.code="MODULE_NOT_FOUND",e})();t.exports.isValidUTF8=function(t){return t.length<32?o(t):e(t)}}catch(e){}},29485,(e,t,s)=>{"use strict";let{Writable:r}=e.r(88947),i=e.r(80295),{BINARY_TYPES:o,EMPTY_BUFFER:n,kStatusCode:a,kWebSocket:u}=e.r(74836),{concat:l,toArrayBuffer:h,unmask:c}=e.r(97970),{isValidStatusCode:d,isValidUTF8:f}=e.r(58739),p=Buffer[Symbol.species];t.exports=class extends r{constructor(e={}){super(),this._allowSynchronousEvents=void 0===e.allowSynchronousEvents||e.allowSynchronousEvents,this._binaryType=e.binaryType||o[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[u]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(e,t,s){if(8===this._opcode&&0==this._state)return s();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(s)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let t=this._buffers[0];return this._buffers[0]=new p(t.buffer,t.byteOffset+e,t.length-e),new p(t.buffer,t.byteOffset,e)}let t=Buffer.allocUnsafe(e);do{let s=this._buffers[0],r=t.length-e;e>=s.length?t.set(this._buffers.shift(),r):(t.set(new Uint8Array(s.buffer,s.byteOffset,e),r),this._buffers[0]=new p(s.buffer,s.byteOffset+e,s.length-e)),e-=s.length}while(e>0)return t}startLoop(e){this._loop=!0;do switch(this._state){case 0:this.getInfo(e);break;case 1:this.getPayloadLength16(e);break;case 2:this.getPayloadLength64(e);break;case 3:this.getMask();break;case 4:this.getData(e);break;case 5:case 6:this._loop=!1;return}while(this._loop)this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let t=this.consume(2);if((48&t[0])!=0)return void e(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"));let s=(64&t[0])==64;if(s&&!this._extensions[i.extensionName])return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._fin=(128&t[0])==128,this._opcode=15&t[0],this._payloadLength=127&t[1],0===this._opcode){if(s)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(!this._fragmented)return void e(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"));this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));this._compressed=s}else{if(!(this._opcode>7)||!(this._opcode<11))return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));if(!this._fin)return void e(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"));if(s)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength)return void e(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"))}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=(128&t[1])==128,this._isServer){if(!this._masked)return void e(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"))}else if(this._masked)return void e(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"));126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),s=t.readUInt32BE(0);s>2097151?e(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=0x100000000*s+t.readUInt32BE(4),this.haveLength(e))}haveLength(e){this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)?e(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH")):this._masked?this._state=3:this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(e){let t=n;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!=0&&c(t,this._mask)}if(this._opcode>7)return void this.controlMessage(t,e);if(this._compressed){this._state=5,this.decompress(t,e);return}t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}decompress(e,t){this._extensions[i.extensionName].decompress(e,this._fin,(e,s)=>{if(e)return t(e);if(s.length){if(this._messageLength+=s.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return void t(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(s)}this.dataMessage(t),0===this._state&&this.startLoop(t)})}dataMessage(e){if(!this._fin){this._state=0;return}let t=this._messageLength,s=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let r;r="nodebuffer"===this._binaryType?l(s,t):"arraybuffer"===this._binaryType?h(l(s,t)):"blob"===this._binaryType?new Blob(s):s,this._allowSynchronousEvents?(this.emit("message",r,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",r,!0),this._state=0,this.startLoop(e)}))}else{let r=l(s,t);if(!this._skipUTF8Validation&&!f(r))return void e(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));5===this._state||this._allowSynchronousEvents?(this.emit("message",r,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",r,!1),this._state=0,this.startLoop(e)}))}}controlMessage(e,t){if(8===this._opcode){if(0===e.length)this._loop=!1,this.emit("conclude",1005,n),this.end();else{let s=e.readUInt16BE(0);if(!d(s))return void t(this.createError(RangeError,`invalid status code ${s}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE"));let r=new p(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!f(r))return void t(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));this._loop=!1,this.emit("conclude",s,r),this.end()}this._state=0;return}this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",e),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",e),this._state=0,this.startLoop(t)}))}createError(e,t,s,r,i){this._loop=!1,this._errored=!0;let o=new e(s?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(o,this.createError),o.code=i,o[a]=r,o}}},16735,(e,t,s)=>{"use strict";let r,{Duplex:i}=e.r(88947),{randomFillSync:o}=e.r(54799),n=e.r(80295),{EMPTY_BUFFER:a,kWebSocket:u,NOOP:l}=e.r(74836),{isBlob:h,isValidStatusCode:c}=e.r(58739),{mask:d,toBuffer:f}=e.r(97970),p=Symbol("kByteLength"),m=Buffer.alloc(4),y=8192;class g{constructor(e,t,s){this._extensions=t||{},s&&(this._generateMask=s,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=l,this[u]=void 0}static frame(e,t){let s,i,n=!1,a=2,u=!1;t.mask&&(s=t.maskBuffer||m,t.generateMask?t.generateMask(s):(8192===y&&(void 0===r&&(r=Buffer.alloc(8192)),o(r,0,8192),y=0),s[0]=r[y++],s[1]=r[y++],s[2]=r[y++],s[3]=r[y++]),u=(s[0]|s[1]|s[2]|s[3])==0,a=6),"string"==typeof e?i=(!t.mask||u)&&void 0!==t[p]?t[p]:(e=Buffer.from(e)).length:(i=e.length,n=t.mask&&t.readOnly&&!u);let l=i;i>=65536?(a+=8,l=127):i>125&&(a+=2,l=126);let h=Buffer.allocUnsafe(n?i+a:a);return(h[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(h[0]|=64),h[1]=l,126===l?h.writeUInt16BE(i,2):127===l&&(h[2]=h[3]=0,h.writeUIntBE(i,4,6)),t.mask)?(h[1]|=128,h[a-4]=s[0],h[a-3]=s[1],h[a-2]=s[2],h[a-1]=s[3],u)?[h,e]:n?(d(e,s,h,a,i),[h]):(d(e,s,e,0,i),[h,e]):[h,e]}close(e,t,s,r){let i;if(void 0===e)i=a;else if("number"==typeof e&&c(e))if(void 0!==t&&t.length){let s=Buffer.byteLength(t);if(s>123)throw RangeError("The message must not be greater than 123 bytes");(i=Buffer.allocUnsafe(2+s)).writeUInt16BE(e,0),"string"==typeof t?i.write(t,2):i.set(t,2)}else(i=Buffer.allocUnsafe(2)).writeUInt16BE(e,0);else throw TypeError("First argument must be a valid error code number");let o={[p]:i.length,fin:!0,generateMask:this._generateMask,mask:s,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,i,!1,o,r]):this.sendFrame(g.frame(i,o),r)}ping(e,t,s){let r,i;if("string"==typeof e?(r=Buffer.byteLength(e),i=!1):h(e)?(r=e.size,i=!1):(r=(e=f(e)).length,i=f.readOnly),r>125)throw RangeError("The data size must not be greater than 125 bytes");let o={[p]:r,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};h(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,o,s]):this.getBlobData(e,!1,o,s):0!==this._state?this.enqueue([this.dispatch,e,!1,o,s]):this.sendFrame(g.frame(e,o),s)}pong(e,t,s){let r,i;if("string"==typeof e?(r=Buffer.byteLength(e),i=!1):h(e)?(r=e.size,i=!1):(r=(e=f(e)).length,i=f.readOnly),r>125)throw RangeError("The data size must not be greater than 125 bytes");let o={[p]:r,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};h(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,o,s]):this.getBlobData(e,!1,o,s):0!==this._state?this.enqueue([this.dispatch,e,!1,o,s]):this.sendFrame(g.frame(e,o),s)}send(e,t,s){let r,i,o=this._extensions[n.extensionName],a=t.binary?2:1,u=t.compress;"string"==typeof e?(r=Buffer.byteLength(e),i=!1):h(e)?(r=e.size,i=!1):(r=(e=f(e)).length,i=f.readOnly),this._firstFragment?(this._firstFragment=!1,u&&o&&o.params[o._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(u=r>=o._threshold),this._compress=u):(u=!1,a=0),t.fin&&(this._firstFragment=!0);let l={[p]:r,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:a,readOnly:i,rsv1:u};h(e)?0!==this._state?this.enqueue([this.getBlobData,e,this._compress,l,s]):this.getBlobData(e,this._compress,l,s):0!==this._state?this.enqueue([this.dispatch,e,this._compress,l,s]):this.dispatch(e,this._compress,l,s)}getBlobData(e,t,s,r){this._bufferedBytes+=s[p],this._state=2,e.arrayBuffer().then(e=>{if(this._socket.destroyed){let e=Error("The socket was closed while the blob was being read");process.nextTick(b,this,e,r);return}this._bufferedBytes-=s[p];let i=f(e);t?this.dispatch(i,t,s,r):(this._state=0,this.sendFrame(g.frame(i,s),r),this.dequeue())}).catch(e=>{process.nextTick(_,this,e,r)})}dispatch(e,t,s,r){if(!t)return void this.sendFrame(g.frame(e,s),r);let i=this._extensions[n.extensionName];this._bufferedBytes+=s[p],this._state=1,i.compress(e,s.fin,(e,t)=>{this._socket.destroyed?b(this,Error("The socket was closed while data was being compressed"),r):(this._bufferedBytes-=s[p],this._state=0,s.readOnly=!1,this.sendFrame(g.frame(t,s),r),this.dequeue())})}dequeue(){for(;0===this._state&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][p],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][p],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}function b(e,t,s){"function"==typeof s&&s(t);for(let s=0;s<e._queue.length;s++){let r=e._queue[s],i=r[r.length-1];"function"==typeof i&&i(t)}}function _(e,t,s){b(e,t,s),e.onerror(t)}t.exports=g},70494,(e,t,s)=>{"use strict";let{kForOnEventAttribute:r,kListener:i}=e.r(74836),o=Symbol("kCode"),n=Symbol("kData"),a=Symbol("kError"),u=Symbol("kMessage"),l=Symbol("kReason"),h=Symbol("kTarget"),c=Symbol("kType"),d=Symbol("kWasClean");class f{constructor(e){this[h]=null,this[c]=e}get target(){return this[h]}get type(){return this[c]}}Object.defineProperty(f.prototype,"target",{enumerable:!0}),Object.defineProperty(f.prototype,"type",{enumerable:!0});class p extends f{constructor(e,t={}){super(e),this[o]=void 0===t.code?0:t.code,this[l]=void 0===t.reason?"":t.reason,this[d]=void 0!==t.wasClean&&t.wasClean}get code(){return this[o]}get reason(){return this[l]}get wasClean(){return this[d]}}Object.defineProperty(p.prototype,"code",{enumerable:!0}),Object.defineProperty(p.prototype,"reason",{enumerable:!0}),Object.defineProperty(p.prototype,"wasClean",{enumerable:!0});class m extends f{constructor(e,t={}){super(e),this[a]=void 0===t.error?null:t.error,this[u]=void 0===t.message?"":t.message}get error(){return this[a]}get message(){return this[u]}}Object.defineProperty(m.prototype,"error",{enumerable:!0}),Object.defineProperty(m.prototype,"message",{enumerable:!0});class y extends f{constructor(e,t={}){super(e),this[n]=void 0===t.data?null:t.data}get data(){return this[n]}}function g(e,t,s){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,s):e.call(t,s)}Object.defineProperty(y.prototype,"data",{enumerable:!0}),t.exports={CloseEvent:p,ErrorEvent:m,Event:f,EventTarget:{addEventListener(e,t,s={}){let o;for(let o of this.listeners(e))if(!s[r]&&o[i]===t&&!o[r])return;if("message"===e)o=function(e,s){let r=new y("message",{data:s?e:e.toString()});r[h]=this,g(t,this,r)};else if("close"===e)o=function(e,s){let r=new p("close",{code:e,reason:s.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});r[h]=this,g(t,this,r)};else if("error"===e)o=function(e){let s=new m("error",{error:e,message:e.message});s[h]=this,g(t,this,s)};else{if("open"!==e)return;o=function(){let e=new f("open");e[h]=this,g(t,this,e)}}o[r]=!!s[r],o[i]=t,s.once?this.once(e,o):this.on(e,o)},removeEventListener(e,t){for(let s of this.listeners(e))if(s[i]===t&&!s[r]){this.removeListener(e,s);break}}},MessageEvent:y}},96903,(e,t,s)=>{"use strict";let{tokenChars:r}=e.r(58739);function i(e,t,s){void 0===e[t]?e[t]=[s]:e[t].push(s)}t.exports={format:function(e){return Object.keys(e).map(t=>{let s=e[t];return Array.isArray(s)||(s=[s]),s.map(e=>[t].concat(Object.keys(e).map(t=>{let s=e[t];return Array.isArray(s)||(s=[s]),s.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(e){let t,s,o=Object.create(null),n=Object.create(null),a=!1,u=!1,l=!1,h=-1,c=-1,d=-1,f=0;for(;f<e.length;f++)if(c=e.charCodeAt(f),void 0===t)if(-1===d&&1===r[c])-1===h&&(h=f);else if(0!==f&&(32===c||9===c))-1===d&&-1!==h&&(d=f);else if(59===c||44===c){if(-1===h)throw SyntaxError(`Unexpected character at index ${f}`);-1===d&&(d=f);let s=e.slice(h,d);44===c?(i(o,s,n),n=Object.create(null)):t=s,h=d=-1}else throw SyntaxError(`Unexpected character at index ${f}`);else if(void 0===s)if(-1===d&&1===r[c])-1===h&&(h=f);else if(32===c||9===c)-1===d&&-1!==h&&(d=f);else if(59===c||44===c){if(-1===h)throw SyntaxError(`Unexpected character at index ${f}`);-1===d&&(d=f),i(n,e.slice(h,d),!0),44===c&&(i(o,t,n),n=Object.create(null),t=void 0),h=d=-1}else if(61===c&&-1!==h&&-1===d)s=e.slice(h,f),h=d=-1;else throw SyntaxError(`Unexpected character at index ${f}`);else if(u){if(1!==r[c])throw SyntaxError(`Unexpected character at index ${f}`);-1===h?h=f:a||(a=!0),u=!1}else if(l)if(1===r[c])-1===h&&(h=f);else if(34===c&&-1!==h)l=!1,d=f;else if(92===c)u=!0;else throw SyntaxError(`Unexpected character at index ${f}`);else if(34===c&&61===e.charCodeAt(f-1))l=!0;else if(-1===d&&1===r[c])-1===h&&(h=f);else if(-1!==h&&(32===c||9===c))-1===d&&(d=f);else if(59===c||44===c){if(-1===h)throw SyntaxError(`Unexpected character at index ${f}`);-1===d&&(d=f);let r=e.slice(h,d);a&&(r=r.replace(/\\/g,""),a=!1),i(n,s,r),44===c&&(i(o,t,n),n=Object.create(null),t=void 0),s=void 0,h=d=-1}else throw SyntaxError(`Unexpected character at index ${f}`);if(-1===h||l||32===c||9===c)throw SyntaxError("Unexpected end of input");-1===d&&(d=f);let p=e.slice(h,d);return void 0===t?i(o,p,n):(void 0===s?i(n,p,!0):a?i(n,s,p.replace(/\\/g,"")):i(n,s,p),i(o,t,n)),o}}},35065,(e,t,s)=>{"use strict";let r=e.r(27699),i=e.r(24836),o=e.r(21517),n=e.r(4446),a=e.r(55004),{randomBytes:u,createHash:l}=e.r(54799),{Duplex:h,Readable:c}=e.r(88947),{URL:d}=e.r(92509),f=e.r(80295),p=e.r(29485),m=e.r(16735),{isBlob:y}=e.r(58739),{BINARY_TYPES:g,CLOSE_TIMEOUT:b,EMPTY_BUFFER:_,GUID:w,kForOnEventAttribute:v,kListener:S,kStatusCode:E,kWebSocket:C,NOOP:x}=e.r(74836),{EventTarget:{addEventListener:A,removeEventListener:T}}=e.r(70494),{format:k,parse:R}=e.r(96903),{toBuffer:q}=e.r(97970),O=Symbol("kAborted"),I=[8,13],L=["CONNECTING","OPEN","CLOSING","CLOSED"],D=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class P extends r{constructor(e,t,s){super(),this._binaryType=g[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=_,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=P.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(s=t,t=[]):t=[t]),function e(t,s,r,n){let a,h,c,p,m={allowSynchronousEvents:!0,autoPong:!0,closeTimeout:b,protocolVersion:I[1],maxPayload:0x6400000,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...n,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=m.autoPong,t._closeTimeout=m.closeTimeout,!I.includes(m.protocolVersion))throw RangeError(`Unsupported protocol version: ${m.protocolVersion} (supported versions: ${I.join(", ")})`);if(s instanceof d)a=s;else try{a=new d(s)}catch(e){throw SyntaxError(`Invalid URL: ${s}`)}"http:"===a.protocol?a.protocol="ws:":"https:"===a.protocol&&(a.protocol="wss:"),t._url=a.href;let y="wss:"===a.protocol,g="ws+unix:"===a.protocol;if("ws:"===a.protocol||y||g?g&&!a.pathname?h="The URL's pathname is empty":a.hash&&(h="The URL contains a fragment identifier"):h='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"',h){let e=SyntaxError(h);if(0!==t._redirects)return void N(t,e);throw e}let _=y?443:80,v=u(16).toString("base64"),S=y?i.request:o.request,E=new Set;if(m.createConnection=m.createConnection||(y?B:U),m.defaultPort=m.defaultPort||_,m.port=a.port||_,m.host=a.hostname.startsWith("[")?a.hostname.slice(1,-1):a.hostname,m.headers={...m.headers,"Sec-WebSocket-Version":m.protocolVersion,"Sec-WebSocket-Key":v,Connection:"Upgrade",Upgrade:"websocket"},m.path=a.pathname+a.search,m.timeout=m.handshakeTimeout,m.perMessageDeflate&&(c=new f(!0!==m.perMessageDeflate?m.perMessageDeflate:{},!1,m.maxPayload),m.headers["Sec-WebSocket-Extensions"]=k({[f.extensionName]:c.offer()})),r.length){for(let e of r){if("string"!=typeof e||!D.test(e)||E.has(e))throw SyntaxError("An invalid or duplicated subprotocol was specified");E.add(e)}m.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(m.origin&&(m.protocolVersion<13?m.headers["Sec-WebSocket-Origin"]=m.origin:m.headers.Origin=m.origin),(a.username||a.password)&&(m.auth=`${a.username}:${a.password}`),g){let e=m.path.split(":");m.socketPath=e[0],m.path=e[1]}if(m.followRedirects){if(0===t._redirects){t._originalIpc=g,t._originalSecure=y,t._originalHostOrSocketPath=g?m.socketPath:a.host;let e=n&&n.headers;if(n={...n,headers:{}},e)for(let[t,s]of Object.entries(e))n.headers[t.toLowerCase()]=s}else if(0===t.listenerCount("redirect")){let e=g?!!t._originalIpc&&m.socketPath===t._originalHostOrSocketPath:!t._originalIpc&&a.host===t._originalHostOrSocketPath;e&&(!t._originalSecure||y)||(delete m.headers.authorization,delete m.headers.cookie,e||delete m.headers.host,m.auth=void 0)}m.auth&&!n.headers.authorization&&(n.headers.authorization="Basic "+Buffer.from(m.auth).toString("base64")),p=t._req=S(m),t._redirects&&t.emit("redirect",t.url,p)}else p=t._req=S(m);m.timeout&&p.on("timeout",()=>{F(t,p,"Opening handshake has timed out")}),p.on("error",e=>{null===p||p[O]||(p=t._req=null,N(t,e))}),p.on("response",i=>{let o=i.headers.location,a=i.statusCode;if(o&&m.followRedirects&&a>=300&&a<400){let i;if(++t._redirects>m.maxRedirects)return void F(t,p,"Maximum redirects exceeded");p.abort();try{i=new d(o,s)}catch(e){N(t,SyntaxError(`Invalid URL: ${o}`));return}e(t,i,r,n)}else t.emit("unexpected-response",p,i)||F(t,p,`Unexpected server response: ${i.statusCode}`)}),p.on("upgrade",(e,s,r)=>{let i;if(t.emit("upgrade",e),t.readyState!==P.CONNECTING)return;p=t._req=null;let o=e.headers.upgrade;if(void 0===o||"websocket"!==o.toLowerCase())return void F(t,s,"Invalid Upgrade header");let n=l("sha1").update(v+w).digest("base64");if(e.headers["sec-websocket-accept"]!==n)return void F(t,s,"Invalid Sec-WebSocket-Accept header");let a=e.headers["sec-websocket-protocol"];if(void 0!==a?E.size?E.has(a)||(i="Server sent an invalid subprotocol"):i="Server sent a subprotocol but none was requested":E.size&&(i="Server sent no subprotocol"),i)return void F(t,s,i);a&&(t._protocol=a);let u=e.headers["sec-websocket-extensions"];if(void 0!==u){let e;if(!c)return void F(t,s,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");try{e=R(u)}catch(e){F(t,s,"Invalid Sec-WebSocket-Extensions header");return}let r=Object.keys(e);if(1!==r.length||r[0]!==f.extensionName)return void F(t,s,"Server indicated an extension that was not requested");try{c.accept(e[f.extensionName])}catch(e){F(t,s,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[f.extensionName]=c}t.setSocket(s,r,{allowSynchronousEvents:m.allowSynchronousEvents,generateMask:m.generateMask,maxPayload:m.maxPayload,skipUTF8Validation:m.skipUTF8Validation})}),m.finishRequest?m.finishRequest(p,t):p.end()}(this,e,t,s)):(this._autoPong=s.autoPong,this._closeTimeout=s.closeTimeout,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){g.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,s){let r=new p({allowSynchronousEvents:s.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:s.maxPayload,skipUTF8Validation:s.skipUTF8Validation}),i=new m(e,this._extensions,s.generateMask);this._receiver=r,this._sender=i,this._socket=e,r[C]=this,i[C]=this,e[C]=this,r.on("conclude",M),r.on("drain",$),r.on("error",V),r.on("message",z),r.on("ping",G),r.on("pong",H),i.onerror=Q,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",Y),e.on("data",Z),e.on("end",X),e.on("error",ee),this._readyState=P.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=P.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[f.extensionName]&&this._extensions[f.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=P.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==P.CLOSED){if(this.readyState===P.CONNECTING)return void F(this,this._req,"WebSocket was closed before the connection was established");if(this.readyState===P.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=P.CLOSING,this._sender.close(e,t,!this._isServer,e=>{!e&&(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),J(this)}}pause(){this.readyState!==P.CONNECTING&&this.readyState!==P.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,s){if(this.readyState===P.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof e?(s=e,e=t=void 0):"function"==typeof t&&(s=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==P.OPEN)?j(this,e,s):(void 0===t&&(t=!this._isServer),this._sender.ping(e||_,t,s))}pong(e,t,s){if(this.readyState===P.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof e?(s=e,e=t=void 0):"function"==typeof t&&(s=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==P.OPEN)?j(this,e,s):(void 0===t&&(t=!this._isServer),this._sender.pong(e||_,t,s))}resume(){this.readyState!==P.CONNECTING&&this.readyState!==P.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,s){if(this.readyState===P.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(s=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==P.OPEN)return void j(this,e,s);let r={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[f.extensionName]||(r.compress=!1),this._sender.send(e||_,r,s)}terminate(){if(this.readyState!==P.CLOSED){if(this.readyState===P.CONNECTING)return void F(this,this._req,"WebSocket was closed before the connection was established");this._socket&&(this._readyState=P.CLOSING,this._socket.destroy())}}}function N(e,t){e._readyState=P.CLOSING,e._errorEmitted=!0,e.emit("error",t),e.emitClose()}function U(e){return e.path=e.socketPath,n.connect(e)}function B(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=n.isIP(e.host)?"":e.host),a.connect(e)}function F(e,t,s){e._readyState=P.CLOSING;let r=Error(s);Error.captureStackTrace(r,F),t.setHeader?(t[O]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(N,e,r)):(t.destroy(r),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function j(e,t,s){if(t){let s=y(t)?t.size:q(t).length;e._socket?e._sender._bufferedBytes+=s:e._bufferedAmount+=s}if(s){let t=Error(`WebSocket is not open: readyState ${e.readyState} (${L[e.readyState]})`);process.nextTick(s,t)}}function M(e,t){let s=this[C];s._closeFrameReceived=!0,s._closeMessage=t,s._closeCode=e,void 0!==s._socket[C]&&(s._socket.removeListener("data",Z),process.nextTick(K,s._socket),1005===e?s.close():s.close(e,t))}function $(){let e=this[C];e.isPaused||e._socket.resume()}function V(e){let t=this[C];void 0!==t._socket[C]&&(t._socket.removeListener("data",Z),process.nextTick(K,t._socket),t.close(e[E])),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e))}function W(){this[C].emitClose()}function z(e,t){this[C].emit("message",e,t)}function G(e){let t=this[C];t._autoPong&&t.pong(e,!this._isServer,x),t.emit("ping",e)}function H(e){this[C].emit("pong",e)}function K(e){e.resume()}function Q(e){let t=this[C];t.readyState!==P.CLOSED&&(t.readyState===P.OPEN&&(t._readyState=P.CLOSING,J(t)),this._socket.end(),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e)))}function J(e){e._closeTimer=setTimeout(e._socket.destroy.bind(e._socket),e._closeTimeout)}function Y(){let e=this[C];if(this.removeListener("close",Y),this.removeListener("data",Z),this.removeListener("end",X),e._readyState=P.CLOSING,!this._readableState.endEmitted&&!e._closeFrameReceived&&!e._receiver._writableState.errorEmitted&&0!==this._readableState.length){let t=this.read(this._readableState.length);e._receiver.write(t)}e._receiver.end(),this[C]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",W),e._receiver.on("finish",W))}function Z(e){this[C]._receiver.write(e)||this.pause()}function X(){let e=this[C];e._readyState=P.CLOSING,e._receiver.end(),this.end()}function ee(){let e=this[C];this.removeListener("error",ee),this.on("error",x),e&&(e._readyState=P.CLOSING,this.destroy())}Object.defineProperty(P,"CONNECTING",{enumerable:!0,value:L.indexOf("CONNECTING")}),Object.defineProperty(P.prototype,"CONNECTING",{enumerable:!0,value:L.indexOf("CONNECTING")}),Object.defineProperty(P,"OPEN",{enumerable:!0,value:L.indexOf("OPEN")}),Object.defineProperty(P.prototype,"OPEN",{enumerable:!0,value:L.indexOf("OPEN")}),Object.defineProperty(P,"CLOSING",{enumerable:!0,value:L.indexOf("CLOSING")}),Object.defineProperty(P.prototype,"CLOSING",{enumerable:!0,value:L.indexOf("CLOSING")}),Object.defineProperty(P,"CLOSED",{enumerable:!0,value:L.indexOf("CLOSED")}),Object.defineProperty(P.prototype,"CLOSED",{enumerable:!0,value:L.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(e=>{Object.defineProperty(P.prototype,e,{enumerable:!0})}),["open","error","close","message"].forEach(e=>{Object.defineProperty(P.prototype,`on${e}`,{enumerable:!0,get(){for(let t of this.listeners(e))if(t[v])return t[S];return null},set(t){for(let t of this.listeners(e))if(t[v]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[v]:!0})}})}),P.prototype.addEventListener=A,P.prototype.removeEventListener=T,t.exports=P},21365,(e,t,s)=>{"use strict";e.r(35065);let{Duplex:r}=e.r(88947);function i(e){e.emit("close")}function o(){!this.destroyed&&this._writableState.finished&&this.destroy()}function n(e){this.removeListener("error",n),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}t.exports=function(e,t){let s=!0,a=new r({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return e.on("message",function(t,s){let r=!s&&a._readableState.objectMode?t.toString():t;a.push(r)||e.pause()}),e.once("error",function(e){a.destroyed||(s=!1,a.destroy(e))}),e.once("close",function(){a.destroyed||a.push(null)}),a._destroy=function(t,r){if(e.readyState===e.CLOSED){r(t),process.nextTick(i,a);return}let o=!1;e.once("error",function(e){o=!0,r(e)}),e.once("close",function(){o||r(t),process.nextTick(i,a)}),s&&e.terminate()},a._final=function(t){e.readyState===e.CONNECTING?e.once("open",function(){a._final(t)}):null!==e._socket&&(e._socket._writableState.finished?(t(),a._readableState.endEmitted&&a.destroy()):(e._socket.once("finish",function(){t()}),e.close()))},a._read=function(){e.isPaused&&e.resume()},a._write=function(t,s,r){e.readyState===e.CONNECTING?e.once("open",function(){a._write(t,s,r)}):e.send(t,r)},a.on("end",o),a.on("error",n),a}},42977,(e,t,s)=>{"use strict";let{tokenChars:r}=e.r(58739);t.exports={parse:function(e){let t=new Set,s=-1,i=-1,o=0;for(;o<e.length;o++){let n=e.charCodeAt(o);if(-1===i&&1===r[n])-1===s&&(s=o);else if(0!==o&&(32===n||9===n))-1===i&&-1!==s&&(i=o);else if(44===n){if(-1===s)throw SyntaxError(`Unexpected character at index ${o}`);-1===i&&(i=o);let r=e.slice(s,i);if(t.has(r))throw SyntaxError(`The "${r}" subprotocol is duplicated`);t.add(r),s=i=-1}else throw SyntaxError(`Unexpected character at index ${o}`)}if(-1===s||-1!==i)throw SyntaxError("Unexpected end of input");let n=e.slice(s,o);if(t.has(n))throw SyntaxError(`The "${n}" subprotocol is duplicated`);return t.add(n),t}}},17198,(e,t,s)=>{"use strict";let r=e.r(27699),i=e.r(21517),{Duplex:o}=e.r(88947),{createHash:n}=e.r(54799),a=e.r(96903),u=e.r(80295),l=e.r(42977),h=e.r(35065),{CLOSE_TIMEOUT:c,GUID:d,kWebSocket:f}=e.r(74836),p=/^[+/0-9A-Za-z]{22}==$/;function m(e){e._state=2,e.emit("close")}function y(){this.destroy()}function g(e,t,s,r){s=s||i.STATUS_CODES[t],r={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(s),...r},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${i.STATUS_CODES[t]}\r
`+Object.keys(r).map(e=>`${e}: ${r[e]}`).join("\r\n")+"\r\n\r\n"+s)}function b(e,t,s,r,i,o){if(e.listenerCount("wsClientError")){let r=Error(i);Error.captureStackTrace(r,b),e.emit("wsClientError",r,s,t)}else g(s,r,i,o)}t.exports=class extends r{constructor(e,t){if(super(),null==(e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:0x6400000,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,closeTimeout:c,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:h,...e}).port&&!e.server&&!e.noServer||null!=e.port&&(e.server||e.noServer)||e.server&&e.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=i.createServer((e,t)=>{let s=i.STATUS_CODES[426];t.writeHead(426,{"Content-Length":s.length,"Content-Type":"text/plain"}),t.end(s)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){const e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(let s of Object.keys(t))e.on(s,t[s]);return function(){for(let s of Object.keys(t))e.removeListener(s,t[s])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,s,r)=>{this.handleUpgrade(t,s,r,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(2===this._state){e&&this.once("close",()=>{e(Error("The server is not running"))}),process.nextTick(m,this);return}if(e&&this.once("close",e),1!==this._state)if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(m,this);else{let e=this._server;this._removeListeners(),this._removeListeners=this._server=null,e.close(()=>{m(this)})}}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,s,r){t.on("error",y);let i=e.headers["sec-websocket-key"],o=e.headers.upgrade,n=+e.headers["sec-websocket-version"];if("GET"!==e.method)return void b(this,e,t,405,"Invalid HTTP method");if(void 0===o||"websocket"!==o.toLowerCase())return void b(this,e,t,400,"Invalid Upgrade header");if(void 0===i||!p.test(i))return void b(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");if(13!==n&&8!==n)return void b(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});if(!this.shouldHandle(e))return void g(t,400);let h=e.headers["sec-websocket-protocol"],c=new Set;if(void 0!==h)try{c=l.parse(h)}catch(s){b(this,e,t,400,"Invalid Sec-WebSocket-Protocol header");return}let d=e.headers["sec-websocket-extensions"],f={};if(this.options.perMessageDeflate&&void 0!==d){let s=new u(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let e=a.parse(d);e[u.extensionName]&&(s.accept(e[u.extensionName]),f[u.extensionName]=s)}catch(s){b(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let o={origin:e.headers[`${8===n?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(o,(o,n,a,u)=>{if(!o)return g(t,n||401,a,u);this.completeUpgrade(f,i,c,e,t,s,r)});if(!this.options.verifyClient(o))return g(t,401)}this.completeUpgrade(f,i,c,e,t,s,r)}completeUpgrade(e,t,s,r,i,o,l){if(!i.readable||!i.writable)return i.destroy();if(i[f])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return g(i,503);let h=n("sha1").update(t+d).digest("base64"),c=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${h}`],p=new this.options.WebSocket(null,void 0,this.options);if(s.size){let e=this.options.handleProtocols?this.options.handleProtocols(s,r):s.values().next().value;e&&(c.push(`Sec-WebSocket-Protocol: ${e}`),p._protocol=e)}if(e[u.extensionName]){let t=e[u.extensionName].params,s=a.format({[u.extensionName]:[t]});c.push(`Sec-WebSocket-Extensions: ${s}`),p._extensions=e}this.emit("headers",c,r),i.write(c.concat("\r\n").join("\r\n")),i.removeListener("error",y),p.setSocket(i,o,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(p),p.on("close",()=>{this.clients.delete(p),this._shouldEmitClose&&!this.clients.size&&process.nextTick(m,this)})),l(p,r)}}},55283,(e,t,s)=>{"use strict";var r={};function i(e,t){!t.unsigned&&--e;let s=t.unsigned?0:-Math.pow(2,e),r=Math.pow(2,e)-1,i=t.moduloBitLength?Math.pow(2,t.moduloBitLength):Math.pow(2,e),o=t.moduloBitLength?Math.pow(2,t.moduloBitLength-1):Math.pow(2,e-1);return function(e,n){n||(n={});let a=+e;if(n.enforceRange){if(!Number.isFinite(a))throw TypeError("Argument is not a finite number");if((a=(a<0?-1:1)*Math.floor(Math.abs(a)))<s||a>r)throw TypeError("Argument is not in byte range");return a}if(!isNaN(a)&&n.clamp){var u;return(a=(u=a)%1==.5&&(1&u)==0?Math.floor(u):Math.round(u))<s&&(a=s),a>r&&(a=r),a}if(!Number.isFinite(a)||0===a)return 0;if(a=(a<0?-1:1)*Math.floor(Math.abs(a))%i,!t.unsigned&&a>=o)return a-i;if(t.unsigned){if(a<0)a+=i;else if(-0===a)return 0}return a}}t.exports=r,r.void=function(){},r.boolean=function(e){return!!e},r.byte=i(8,{unsigned:!1}),r.octet=i(8,{unsigned:!0}),r.short=i(16,{unsigned:!1}),r["unsigned short"]=i(16,{unsigned:!0}),r.long=i(32,{unsigned:!1}),r["unsigned long"]=i(32,{unsigned:!0}),r["long long"]=i(32,{unsigned:!1,moduloBitLength:64}),r["unsigned long long"]=i(32,{unsigned:!0,moduloBitLength:64}),r.double=function(e){let t=+e;if(!Number.isFinite(t))throw TypeError("Argument is not a finite floating-point value");return t},r["unrestricted double"]=function(e){let t=+e;if(isNaN(t))throw TypeError("Argument is NaN");return t},r.float=r.double,r["unrestricted float"]=r["unrestricted double"],r.DOMString=function(e,t){return(t||(t={}),t.treatNullAsEmptyString&&null===e)?"":String(e)},r.ByteString=function(e,t){let s,r=String(e);for(let e=0;void 0!==(s=r.codePointAt(e));++e)if(s>255)throw TypeError("Argument is not a valid bytestring");return r},r.USVString=function(e){let t=String(e),s=t.length,r=[];for(let e=0;e<s;++e){let i=t.charCodeAt(e);if(i<55296||i>57343)r.push(String.fromCodePoint(i));else if(56320<=i&&i<=57343)r.push(String.fromCodePoint(65533));else if(e===s-1)r.push(String.fromCodePoint(65533));else{let s=t.charCodeAt(e+1);if(56320<=s&&s<=57343){let t=1023&i,o=1023&s;r.push(String.fromCodePoint(65536+1024*t+o)),++e}else r.push(String.fromCodePoint(65533))}}return r.join("")},r.Date=function(e,t){if(!(e instanceof Date))throw TypeError("Argument is not a Date object");if(!isNaN(e))return e},r.RegExp=function(e,t){return e instanceof RegExp||(e=new RegExp(e)),e}},78289,(e,t,s)=>{"use strict";t.exports.mixin=function(e,t){let s=Object.getOwnPropertyNames(t);for(let r=0;r<s.length;++r)Object.defineProperty(e,s[r],Object.getOwnPropertyDescriptor(t,s[r]))},t.exports.wrapperSymbol=Symbol("wrapper"),t.exports.implSymbol=Symbol("impl"),t.exports.wrapperForImpl=function(e){return e[t.exports.wrapperSymbol]},t.exports.implForWrapper=function(e){return e[t.exports.implSymbol]}},28555,(e,t,s)=>{"use strict";var r=e.r(92097),i=e.r(45736),o={TRANSITIONAL:0,NONTRANSITIONAL:1};function n(e){return e.split("\0").map(function(e){return e.normalize("NFC")}).join("\0")}function a(e){for(var t=0,s=i.length-1;t<=s;){var r=Math.floor((t+s)/2),o=i[r];if(o[0][0]<=e&&o[0][1]>=e)return o;o[0][0]>e?s=r-1:t=r+1}return null}var u=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;function l(e){return e.replace(u,"_").length}var h=/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08E4-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D01-\u0D03\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u18A9\u1920-\u192B\u1930-\u193B\u19B0-\u19C0\u19C8\u19C9\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF5\u1DFC-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C4\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2D]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD804[\uDC00-\uDC02\uDC38-\uDC46\uDC7F-\uDC82\uDCB0-\uDCBA\uDD00-\uDD02\uDD27-\uDD34\uDD73\uDD80-\uDD82\uDDB3-\uDDC0\uDE2C-\uDE37\uDEDF-\uDEEA\uDF01-\uDF03\uDF3C\uDF3E-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF62\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDCB0-\uDCC3\uDDAF-\uDDB5\uDDB8-\uDDC0\uDE30-\uDE40\uDEAB-\uDEB7]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF51-\uDF7E\uDF8F-\uDF92]|\uD82F[\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD83A[\uDCD0-\uDCD6]|\uDB40[\uDD00-\uDDEF]/;function c(e,t,s){var i=function(e,t,s){for(var r=!1,i="",n=l(e),u=0;u<n;++u){var h=e.codePointAt(u),c=a(h);switch(c[1]){case"disallowed":r=!0,i+=String.fromCodePoint(h);break;case"ignored":break;case"mapped":i+=String.fromCodePoint.apply(String,c[2]);break;case"deviation":s===o.TRANSITIONAL?i+=String.fromCodePoint.apply(String,c[2]):i+=String.fromCodePoint(h);break;case"valid":i+=String.fromCodePoint(h);break;case"disallowed_STD3_mapped":t?(r=!0,i+=String.fromCodePoint(h)):i+=String.fromCodePoint.apply(String,c[2]);break;case"disallowed_STD3_valid":t&&(r=!0),i+=String.fromCodePoint(h)}}return{string:i,error:r}}(e,t,s);i.string=n(i.string);for(var u=i.string.split("."),d=0;d<u.length;++d)try{var f=function(e,t){"xn--"===e.substr(0,4)&&(e=r.toUnicode(e),o.NONTRANSITIONAL);var s=!1;(n(e)!==e||"-"===e[3]&&"-"===e[4]||"-"===e[0]||"-"===e[e.length-1]||-1!==e.indexOf(".")||0===e.search(h))&&(s=!0);for(var i=l(e),u=0;u<i;++u){var d=a(e.codePointAt(u));if(c===o.TRANSITIONAL&&"valid"!==d[1]||c===o.NONTRANSITIONAL&&"valid"!==d[1]&&"deviation"!==d[1]){s=!0;break}}return{label:e,error:s}}(u[d]);u[d]=f.label,i.error=i.error||f.error}catch(e){i.error=!0}return{string:u.join("."),error:i.error}}t.exports.toASCII=function(e,t,s,i){var o=c(e,t,s),n=o.string.split(".");if(n=n.map(function(e){try{return r.toASCII(e)}catch(t){return o.error=!0,e}}),i){var a=n.slice(0,n.length-1).join(".").length;(a.length>253||0===a.length)&&(o.error=!0);for(var u=0;u<n.length;++u)if(n.length>63||0===n.length){o.error=!0;break}}return o.error?null:n.join(".")},t.exports.toUnicode=function(e,t){var s=c(e,t,o.NONTRANSITIONAL);return{domain:s.string,error:s.error}},t.exports.PROCESSING_OPTIONS=o},22216,(e,t,s)=>{"use strict";let r=e.r(92097),i=e.r(28555),o={ftp:21,file:null,gopher:70,http:80,https:443,ws:80,wss:443},n=Symbol("failure");function a(e){return r.ucs2.decode(e).length}function u(e,t){let s=e[t];return isNaN(s)?void 0:String.fromCodePoint(s)}function l(e){return e>=48&&e<=57}function h(e){return e>=65&&e<=90||e>=97&&e<=122}function c(e){return l(e)||e>=65&&e<=70||e>=97&&e<=102}function d(e){return"."===e||"%2e"===e.toLowerCase()}function f(e){return 2===e.length&&h(e.codePointAt(0))&&(":"===e[1]||"|"===e[1])}function p(e){return void 0!==o[e]}function m(e){return p(e.scheme)}function y(e){let t=e.toString(16).toUpperCase();return 1===t.length&&(t="0"+t),"%"+t}function g(e){return e<=31||e>126}let b=new Set([32,34,35,60,62,63,96,123,125]);function _(e){return g(e)||b.has(e)}let w=new Set([47,58,59,61,64,91,92,93,94,124]);function v(e){return _(e)||w.has(e)}function S(e,t){let s=String.fromCodePoint(e);if(t(e)){let e=new Buffer(s),t="";for(let s=0;s<e.length;++s)t+=y(e[s]);return t}return s}function E(e,t){if("["===e[0])return"]"!==e[e.length-1]?n:function(e){let t=[0,0,0,0,0,0,0,0],s=0,i=null,o=0;if(58===(e=r.ucs2.decode(e))[o]){if(58!==e[o+1])return n;o+=2,i=++s}for(;o<e.length;){if(8===s)return n;if(58===e[o]){if(null!==i)return n;++o,i=++s;continue}let r=0,a=0;for(;a<4&&c(e[o]);)r=16*r+parseInt(u(e,o),16),++o,++a;if(46===e[o]){if(0===a||(o-=a,s>6))return n;let r=0;for(;void 0!==e[o];){let i=null;if(r>0)if(46!==e[o]||!(r<4))return n;else++o;if(!l(e[o]))return n;for(;l(e[o]);){let t=parseInt(u(e,o));if(null===i)i=t;else{if(0===i)return n;i=10*i+t}if(i>255)return n;++o}t[s]=256*t[s]+i,(2==++r||4===r)&&++s}if(4!==r)return n;break}if(58===e[o]){if(void 0===e[++o])return n}else if(void 0!==e[o])return n;t[s]=r,++s}if(null!==i){let e=s-i;for(s=7;0!==s&&e>0;){let r=t[i+e-1];t[i+e-1]=t[s],t[s]=r,--s,--e}}else if(null===i&&8!==s)return n;return t}(e.substring(1,e.length-1));if(!t){var s=e;if(-1!==s.search(/\u0000|\u0009|\u000A|\u000D|\u0020|#|\/|:|\?|@|\[|\\|\]/))return n;let t="",i=r.ucs2.decode(s);for(let e=0;e<i.length;++e)t+=S(i[e],g);return t}let o=function(e){let t=new Buffer(e),s=[];for(let e=0;e<t.length;++e)37!==t[e]?s.push(t[e]):37===t[e]&&c(t[e+1])&&c(t[e+2])?(s.push(parseInt(t.slice(e+1,e+3).toString(),16)),e+=2):s.push(t[e]);return new Buffer(s).toString()}(e),a=i.toASCII(o,!1,i.PROCESSING_OPTIONS.NONTRANSITIONAL,!1);if(null===a||-1!==a.search(/\u0000|\u0009|\u000A|\u000D|\u0020|#|%|\/|:|\?|@|\[|\\|\]/))return n;let h=function(e){let t=e.split(".");if(""===t[t.length-1]&&t.length>1&&t.pop(),t.length>4)return e;let s=[];for(let r of t){if(""===r)return e;let t=function(e){let t=10;return(e.length>=2&&"0"===e.charAt(0)&&"x"===e.charAt(1).toLowerCase()?(e=e.substring(2),t=16):e.length>=2&&"0"===e.charAt(0)&&(e=e.substring(1),t=8),""===e)?0:(10===t?/[^0-9]/:16===t?/[^0-9A-Fa-f]/:/[^0-7]/).test(e)?n:parseInt(e,t)}(r);if(t===n)return e;s.push(t)}for(let e=0;e<s.length-1;++e)if(s[e]>255)return n;if(s[s.length-1]>=Math.pow(256,5-s.length))return n;let r=s.pop(),i=0;for(let e of s)r+=e*Math.pow(256,3-i),++i;return r}(a);return"number"==typeof h||h===n?h:a}function C(e){if("number"==typeof e){let t="",s=e;for(let e=1;e<=4;++e)t=String(s%256)+t,4!==e&&(t="."+t),s=Math.floor(s/256);return t}return e instanceof Array?"["+function(e){let t="",s=function(e){let t=null,s=1,r=null,i=0;for(let o=0;o<e.length;++o)0!==e[o]?(i>s&&(t=r,s=i),r=null,i=0):(null===r&&(r=o),++i);return i>s&&(t=r,s=i),{idx:t,len:s}}(e).idx,r=!1;for(let i=0;i<=7;++i)if(!r||0!==e[i]){if(r&&(r=!1),s===i){t+=0===i?"::":":",r=!0;continue}t+=e[i].toString(16),7!==i&&(t+=":")}return t}(e)+"]":e}function x(e){var t;let s=e.path;0===s.length||"file"===e.scheme&&1===s.length&&(t=s[0],/^[A-Za-z]:$/.test(t))||s.pop()}function A(e){return""!==e.username||""!==e.password}function T(e,t,s,i,o){if(this.pointer=0,this.input=e,this.base=t||null,this.encodingOverride=s||"utf-8",this.stateOverride=o,this.url=i,this.failure=!1,this.parseError=!1,!this.url){this.url={scheme:"",username:"",password:"",host:null,port:null,path:[],query:null,fragment:null,cannotBeABaseURL:!1};let e=this.input.replace(/^[\u0000-\u001F\u0020]+|[\u0000-\u001F\u0020]+$/g,"");e!==this.input&&(this.parseError=!0),this.input=e}let a=this.input.replace(/\u0009|\u000A|\u000D/g,"");for(a!==this.input&&(this.parseError=!0),this.input=a,this.state=o||"scheme start",this.buffer="",this.atFlag=!1,this.arrFlag=!1,this.passwordTokenSeenFlag=!1,this.input=r.ucs2.decode(this.input);this.pointer<=this.input.length;++this.pointer){let e=this.input[this.pointer],t=isNaN(e)?void 0:String.fromCodePoint(e),s=this["parse "+this.state](e,t);if(s){if(s===n){this.failure=!0;break}}else break}}T.prototype["parse scheme start"]=function(e,t){if(h(e))this.buffer+=t.toLowerCase(),this.state="scheme";else{if(this.stateOverride)return this.parseError=!0,n;this.state="no scheme",--this.pointer}return!0},T.prototype["parse scheme"]=function(e,t){if(h(e)||l(e)||43===e||45===e||46===e)this.buffer+=t.toLowerCase();else if(58===e){if(this.stateOverride&&(m(this.url)&&!p(this.buffer)||!m(this.url)&&p(this.buffer)||(A(this.url)||null!==this.url.port)&&"file"===this.buffer||"file"===this.url.scheme&&(""===this.url.host||null===this.url.host))||(this.url.scheme=this.buffer,this.buffer="",this.stateOverride))return!1;"file"===this.url.scheme?((47!==this.input[this.pointer+1]||47!==this.input[this.pointer+2])&&(this.parseError=!0),this.state="file"):m(this.url)&&null!==this.base&&this.base.scheme===this.url.scheme?this.state="special relative or authority":m(this.url)?this.state="special authority slashes":47===this.input[this.pointer+1]?(this.state="path or authority",++this.pointer):(this.url.cannotBeABaseURL=!0,this.url.path.push(""),this.state="cannot-be-a-base-URL path")}else{if(this.stateOverride)return this.parseError=!0,n;this.buffer="",this.state="no scheme",this.pointer=-1}return!0},T.prototype["parse no scheme"]=function(e){return null===this.base||this.base.cannotBeABaseURL&&35!==e?n:(this.base.cannotBeABaseURL&&35===e?(this.url.scheme=this.base.scheme,this.url.path=this.base.path.slice(),this.url.query=this.base.query,this.url.fragment="",this.url.cannotBeABaseURL=!0,this.state="fragment"):("file"===this.base.scheme?this.state="file":this.state="relative",--this.pointer),!0)},T.prototype["parse special relative or authority"]=function(e){return 47===e&&47===this.input[this.pointer+1]?(this.state="special authority ignore slashes",++this.pointer):(this.parseError=!0,this.state="relative",--this.pointer),!0},T.prototype["parse path or authority"]=function(e){return 47===e?this.state="authority":(this.state="path",--this.pointer),!0},T.prototype["parse relative"]=function(e){return this.url.scheme=this.base.scheme,isNaN(e)?(this.url.username=this.base.username,this.url.password=this.base.password,this.url.host=this.base.host,this.url.port=this.base.port,this.url.path=this.base.path.slice(),this.url.query=this.base.query):47===e?this.state="relative slash":63===e?(this.url.username=this.base.username,this.url.password=this.base.password,this.url.host=this.base.host,this.url.port=this.base.port,this.url.path=this.base.path.slice(),this.url.query="",this.state="query"):35===e?(this.url.username=this.base.username,this.url.password=this.base.password,this.url.host=this.base.host,this.url.port=this.base.port,this.url.path=this.base.path.slice(),this.url.query=this.base.query,this.url.fragment="",this.state="fragment"):m(this.url)&&92===e?(this.parseError=!0,this.state="relative slash"):(this.url.username=this.base.username,this.url.password=this.base.password,this.url.host=this.base.host,this.url.port=this.base.port,this.url.path=this.base.path.slice(0,this.base.path.length-1),this.state="path",--this.pointer),!0},T.prototype["parse relative slash"]=function(e){return m(this.url)&&(47===e||92===e)?(92===e&&(this.parseError=!0),this.state="special authority ignore slashes"):47===e?this.state="authority":(this.url.username=this.base.username,this.url.password=this.base.password,this.url.host=this.base.host,this.url.port=this.base.port,this.state="path",--this.pointer),!0},T.prototype["parse special authority slashes"]=function(e){return 47===e&&47===this.input[this.pointer+1]?(this.state="special authority ignore slashes",++this.pointer):(this.parseError=!0,this.state="special authority ignore slashes",--this.pointer),!0},T.prototype["parse special authority ignore slashes"]=function(e){return 47!==e&&92!==e?(this.state="authority",--this.pointer):this.parseError=!0,!0},T.prototype["parse authority"]=function(e,t){if(64===e){this.parseError=!0,this.atFlag&&(this.buffer="%40"+this.buffer),this.atFlag=!0;let e=a(this.buffer);for(let t=0;t<e;++t){let e=this.buffer.codePointAt(t);if(58===e&&!this.passwordTokenSeenFlag){this.passwordTokenSeenFlag=!0;continue}let s=S(e,v);this.passwordTokenSeenFlag?this.url.password+=s:this.url.username+=s}this.buffer=""}else if(isNaN(e)||47===e||63===e||35===e||m(this.url)&&92===e){if(this.atFlag&&""===this.buffer)return this.parseError=!0,n;this.pointer-=a(this.buffer)+1,this.buffer="",this.state="host"}else this.buffer+=t;return!0},T.prototype["parse hostname"]=T.prototype["parse host"]=function(e,t){if(this.stateOverride&&"file"===this.url.scheme)--this.pointer,this.state="file host";else if(58!==e||this.arrFlag)if(isNaN(e)||47===e||63===e||35===e||m(this.url)&&92===e){if(--this.pointer,m(this.url)&&""===this.buffer)return this.parseError=!0,n;if(this.stateOverride&&""===this.buffer&&(A(this.url)||null!==this.url.port))return this.parseError=!0,!1;let e=E(this.buffer,m(this.url));if(e===n)return n;if(this.url.host=e,this.buffer="",this.state="path start",this.stateOverride)return!1}else 91===e?this.arrFlag=!0:93===e&&(this.arrFlag=!1),this.buffer+=t;else{if(""===this.buffer)return this.parseError=!0,n;let e=E(this.buffer,m(this.url));if(e===n)return n;if(this.url.host=e,this.buffer="",this.state="port","hostname"===this.stateOverride)return!1}return!0},T.prototype["parse port"]=function(e,t){if(l(e))this.buffer+=t;else{if(!(isNaN(e)||47===e||63===e||35===e||m(this.url)&&92===e)&&!this.stateOverride)return this.parseError=!0,n;if(""!==this.buffer){let e=parseInt(this.buffer);if(e>65535)return this.parseError=!0,n;this.url.port=e===o[this.url.scheme]?null:e,this.buffer=""}if(this.stateOverride)return!1;this.state="path start",--this.pointer}return!0};let k=new Set([47,92,63,35]);T.prototype["parse file"]=function(e){if(this.url.scheme="file",47===e||92===e)92===e&&(this.parseError=!0),this.state="file slash";else if(null!==this.base&&"file"===this.base.scheme)if(isNaN(e))this.url.host=this.base.host,this.url.path=this.base.path.slice(),this.url.query=this.base.query;else if(63===e)this.url.host=this.base.host,this.url.path=this.base.path.slice(),this.url.query="",this.state="query";else if(35===e)this.url.host=this.base.host,this.url.path=this.base.path.slice(),this.url.query=this.base.query,this.url.fragment="",this.state="fragment";else{var t;this.input.length-this.pointer-1!=0&&(t=this.input[this.pointer+1],h(e)&&(58===t||124===t))&&(!(this.input.length-this.pointer-1>=2)||k.has(this.input[this.pointer+2]))?this.parseError=!0:(this.url.host=this.base.host,this.url.path=this.base.path.slice(),x(this.url)),this.state="path",--this.pointer}else this.state="path",--this.pointer;return!0},T.prototype["parse file slash"]=function(e){if(47===e||92===e)92===e&&(this.parseError=!0),this.state="file host";else{if(null!==this.base&&"file"===this.base.scheme){var t;2===(t=this.base.path[0]).length&&h(t.codePointAt(0))&&":"===t[1]?this.url.path.push(this.base.path[0]):this.url.host=this.base.host}this.state="path",--this.pointer}return!0},T.prototype["parse file host"]=function(e,t){if(isNaN(e)||47===e||92===e||63===e||35===e)if(--this.pointer,!this.stateOverride&&f(this.buffer))this.parseError=!0,this.state="path";else if(""===this.buffer){if(this.url.host="",this.stateOverride)return!1;this.state="path start"}else{let e=E(this.buffer,m(this.url));if(e===n)return n;if("localhost"===e&&(e=""),this.url.host=e,this.stateOverride)return!1;this.buffer="",this.state="path start"}else this.buffer+=t;return!0},T.prototype["parse path start"]=function(e){return m(this.url)?(92===e&&(this.parseError=!0),this.state="path",47!==e&&92!==e&&--this.pointer):this.stateOverride||63!==e?this.stateOverride||35!==e?void 0!==e&&(this.state="path",47!==e&&--this.pointer):(this.url.fragment="",this.state="fragment"):(this.url.query="",this.state="query"),!0},T.prototype["parse path"]=function(e){if(isNaN(e)||47===e||m(this.url)&&92===e||!this.stateOverride&&(63===e||35===e)){var t;if((m(this.url)&&92===e&&(this.parseError=!0),".."===(t=(t=this.buffer).toLowerCase())||"%2e."===t||".%2e"===t||"%2e%2e"===t)?(x(this.url),47===e||m(this.url)&&92===e||this.url.path.push("")):d(this.buffer)&&47!==e&&!(m(this.url)&&92===e)?this.url.path.push(""):d(this.buffer)||("file"===this.url.scheme&&0===this.url.path.length&&f(this.buffer)&&(""!==this.url.host&&null!==this.url.host&&(this.parseError=!0,this.url.host=""),this.buffer=this.buffer[0]+":"),this.url.path.push(this.buffer)),this.buffer="","file"===this.url.scheme&&(void 0===e||63===e||35===e))for(;this.url.path.length>1&&""===this.url.path[0];)this.parseError=!0,this.url.path.shift();63===e&&(this.url.query="",this.state="query"),35===e&&(this.url.fragment="",this.state="fragment")}else 37!==e||c(this.input[this.pointer+1])&&c(this.input[this.pointer+2])||(this.parseError=!0),this.buffer+=S(e,_);return!0},T.prototype["parse cannot-be-a-base-URL path"]=function(e){return 63===e?(this.url.query="",this.state="query"):35===e?(this.url.fragment="",this.state="fragment"):(isNaN(e)||37===e||(this.parseError=!0),37!==e||c(this.input[this.pointer+1])&&c(this.input[this.pointer+2])||(this.parseError=!0),isNaN(e)||(this.url.path[0]=this.url.path[0]+S(e,g))),!0},T.prototype["parse query"]=function(e,t){if(isNaN(e)||!this.stateOverride&&35===e){m(this.url)&&"ws"!==this.url.scheme&&"wss"!==this.url.scheme||(this.encodingOverride="utf-8");let t=new Buffer(this.buffer);for(let e=0;e<t.length;++e)t[e]<33||t[e]>126||34===t[e]||35===t[e]||60===t[e]||62===t[e]?this.url.query+=y(t[e]):this.url.query+=String.fromCodePoint(t[e]);this.buffer="",35===e&&(this.url.fragment="",this.state="fragment")}else 37!==e||c(this.input[this.pointer+1])&&c(this.input[this.pointer+2])||(this.parseError=!0),this.buffer+=t;return!0},T.prototype["parse fragment"]=function(e){return isNaN(e)||(0===e?this.parseError=!0:(37!==e||c(this.input[this.pointer+1])&&c(this.input[this.pointer+2])||(this.parseError=!0),this.url.fragment+=S(e,g))),!0},t.exports.serializeURL=function(e,t){let s=e.scheme+":";if(null!==e.host?(s+="//",(""!==e.username||""!==e.password)&&(s+=e.username,""!==e.password&&(s+=":"+e.password),s+="@"),s+=C(e.host),null!==e.port&&(s+=":"+e.port)):null===e.host&&"file"===e.scheme&&(s+="//"),e.cannotBeABaseURL)s+=e.path[0];else for(let t of e.path)s+="/"+t;return null!==e.query&&(s+="?"+e.query),t||null===e.fragment||(s+="#"+e.fragment),s},t.exports.serializeURLOrigin=function(e){switch(e.scheme){case"blob":try{return t.exports.serializeURLOrigin(t.exports.parseURL(e.path[0]))}catch(e){return"null"}case"ftp":case"gopher":case"http":case"https":case"ws":case"wss":var s;let r;return r=(s={scheme:e.scheme,host:e.host,port:e.port}).scheme+"://"+C(s.host),null!==s.port&&(r+=":"+s.port),r;case"file":return"file://";default:return"null"}},t.exports.basicURLParse=function(e,t){void 0===t&&(t={});let s=new T(e,t.baseURL,t.encodingOverride,t.url,t.stateOverride);return s.failure?"failure":s.url},t.exports.setTheUsername=function(e,t){e.username="";let s=r.ucs2.decode(t);for(let t=0;t<s.length;++t)e.username+=S(s[t],v)},t.exports.setThePassword=function(e,t){e.password="";let s=r.ucs2.decode(t);for(let t=0;t<s.length;++t)e.password+=S(s[t],v)},t.exports.serializeHost=C,t.exports.cannotHaveAUsernamePasswordPort=function(e){return null===e.host||""===e.host||e.cannotBeABaseURL||"file"===e.scheme},t.exports.serializeInteger=function(e){return String(e)},t.exports.parseURL=function(e,s){return void 0===s&&(s={}),t.exports.basicURLParse(e,{baseURL:s.baseURL,encodingOverride:s.encodingOverride})}},81860,(e,t,s)=>{"use strict";let r=e.r(22216);s.implementation=class{constructor(e){const t=e[0],s=e[1];let i=null;if(void 0!==s&&"failure"===(i=r.basicURLParse(s)))throw TypeError("Invalid base URL");const o=r.basicURLParse(t,{baseURL:i});if("failure"===o)throw TypeError("Invalid URL");this._url=o}get href(){return r.serializeURL(this._url)}set href(e){let t=r.basicURLParse(e);if("failure"===t)throw TypeError("Invalid URL");this._url=t}get origin(){return r.serializeURLOrigin(this._url)}get protocol(){return this._url.scheme+":"}set protocol(e){r.basicURLParse(e+":",{url:this._url,stateOverride:"scheme start"})}get username(){return this._url.username}set username(e){r.cannotHaveAUsernamePasswordPort(this._url)||r.setTheUsername(this._url,e)}get password(){return this._url.password}set password(e){r.cannotHaveAUsernamePasswordPort(this._url)||r.setThePassword(this._url,e)}get host(){let e=this._url;return null===e.host?"":null===e.port?r.serializeHost(e.host):r.serializeHost(e.host)+":"+r.serializeInteger(e.port)}set host(e){this._url.cannotBeABaseURL||r.basicURLParse(e,{url:this._url,stateOverride:"host"})}get hostname(){return null===this._url.host?"":r.serializeHost(this._url.host)}set hostname(e){this._url.cannotBeABaseURL||r.basicURLParse(e,{url:this._url,stateOverride:"hostname"})}get port(){return null===this._url.port?"":r.serializeInteger(this._url.port)}set port(e){r.cannotHaveAUsernamePasswordPort(this._url)||(""===e?this._url.port=null:r.basicURLParse(e,{url:this._url,stateOverride:"port"}))}get pathname(){return this._url.cannotBeABaseURL?this._url.path[0]:0===this._url.path.length?"":"/"+this._url.path.join("/")}set pathname(e){this._url.cannotBeABaseURL||(this._url.path=[],r.basicURLParse(e,{url:this._url,stateOverride:"path start"}))}get search(){return null===this._url.query||""===this._url.query?"":"?"+this._url.query}set search(e){let t=this._url;if(""===e){t.query=null;return}let s="?"===e[0]?e.substring(1):e;t.query="",r.basicURLParse(s,{url:t,stateOverride:"query"})}get hash(){return null===this._url.fragment||""===this._url.fragment?"":"#"+this._url.fragment}set hash(e){if(""===e){this._url.fragment=null;return}let t="#"===e[0]?e.substring(1):e;this._url.fragment="",r.basicURLParse(t,{url:this._url,stateOverride:"fragment"})}toJSON(){return this.href}}},81842,(e,t,s)=>{"use strict";let r=e.r(55283),i=e.r(78289),o=e.r(81860),n=i.implSymbol;function a(e){if(!this||this[n]||!(this instanceof a))throw TypeError("Failed to construct 'URL': Please use the 'new' operator, this DOM object constructor cannot be called as a function.");if(arguments.length<1)throw TypeError("Failed to construct 'URL': 1 argument required, but only "+arguments.length+" present.");let s=[];for(let e=0;e<arguments.length&&e<2;++e)s[e]=arguments[e];s[0]=r.USVString(s[0]),void 0!==s[1]&&(s[1]=r.USVString(s[1])),t.exports.setup(this,s)}a.prototype.toJSON=function(){if(!this||!t.exports.is(this))throw TypeError("Illegal invocation");let e=[];for(let t=0;t<arguments.length&&t<0;++t)e[t]=arguments[t];return this[n].toJSON.apply(this[n],e)},Object.defineProperty(a.prototype,"href",{get(){return this[n].href},set(e){e=r.USVString(e),this[n].href=e},enumerable:!0,configurable:!0}),a.prototype.toString=function(){if(!this||!t.exports.is(this))throw TypeError("Illegal invocation");return this.href},Object.defineProperty(a.prototype,"origin",{get(){return this[n].origin},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"protocol",{get(){return this[n].protocol},set(e){e=r.USVString(e),this[n].protocol=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"username",{get(){return this[n].username},set(e){e=r.USVString(e),this[n].username=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"password",{get(){return this[n].password},set(e){e=r.USVString(e),this[n].password=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"host",{get(){return this[n].host},set(e){e=r.USVString(e),this[n].host=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hostname",{get(){return this[n].hostname},set(e){e=r.USVString(e),this[n].hostname=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"port",{get(){return this[n].port},set(e){e=r.USVString(e),this[n].port=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"pathname",{get(){return this[n].pathname},set(e){e=r.USVString(e),this[n].pathname=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"search",{get(){return this[n].search},set(e){e=r.USVString(e),this[n].search=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hash",{get(){return this[n].hash},set(e){e=r.USVString(e),this[n].hash=e},enumerable:!0,configurable:!0}),t.exports={is:e=>!!e&&e[n]instanceof o.implementation,create(e,t){let s=Object.create(a.prototype);return this.setup(s,e,t),s},setup(e,t,s){s||(s={}),s.wrapper=e,e[n]=new o.implementation(t,s),e[n][i.wrapperSymbol]=e},interface:a,expose:{Window:{URL:a},Worker:{URL:a}}}},18907,(e,t,s)=>{"use strict";s.URL=e.r(81842).interface,s.serializeURL=e.r(22216).serializeURL,s.serializeURLOrigin=e.r(22216).serializeURLOrigin,s.basicURLParse=e.r(22216).basicURLParse,s.setTheUsername=e.r(22216).setTheUsername,s.setThePassword=e.r(22216).setThePassword,s.serializeHost=e.r(22216).serializeHost,s.serializeInteger=e.r(22216).serializeInteger,s.parseURL=e.r(22216).parseURL},61227,e=>{"use strict";let t;var s=e.i(88947),r=e.i(21517),i=e.i(92509),o=e.i(18907),n=e.i(24836),a=e.i(6461);let u=s.default.Readable,l=Symbol("buffer"),h=Symbol("type");class c{constructor(){this[h]="";const e=arguments[0],t=arguments[1],s=[];if(e){const t=Number(e.length);for(let r=0;r<t;r++){let t;const i=e[r];(t=i instanceof Buffer?i:ArrayBuffer.isView(i)?Buffer.from(i.buffer,i.byteOffset,i.byteLength):i instanceof ArrayBuffer?Buffer.from(i):i instanceof c?i[l]:Buffer.from("string"==typeof i?i:String(i))).length,s.push(t)}}this[l]=Buffer.concat(s);let r=t&&void 0!==t.type&&String(t.type).toLowerCase();r&&!/[^\u0020-\u007E]/.test(r)&&(this[h]=r)}get size(){return this[l].length}get type(){return this[h]}text(){return Promise.resolve(this[l].toString())}arrayBuffer(){let e=this[l];return Promise.resolve(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}stream(){let e=new u;return e._read=function(){},e.push(this[l]),e.push(null),e}toString(){return"[object Blob]"}slice(){let e,t=this.size,s=arguments[0],r=arguments[1];e=void 0===s?0:s<0?Math.max(t+s,0):Math.min(s,t);let i=Math.max((void 0===r?t:r<0?Math.max(t+r,0):Math.min(r,t))-e,0),o=this[l].slice(e,e+i),n=new c([],{type:arguments[2]});return n[l]=o,n}}function d(e,t,s){Error.call(this,e),this.message=e,this.type=t,s&&(this.code=this.errno=s.code),Error.captureStackTrace(this,this.constructor)}Object.defineProperties(c.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(c.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),d.prototype=Object.create(Error.prototype),d.prototype.constructor=d,d.prototype.name="FetchError";try{t=(()=>{let e=Error("Cannot find module 'encoding'");throw e.code="MODULE_NOT_FOUND",e})().convert}catch(e){}let f=Symbol("Body internals"),p=s.default.PassThrough;function m(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.size,o=r.timeout;null==e?e=null:g(e)?e=Buffer.from(e.toString()):b(e)||Buffer.isBuffer(e)||("[object ArrayBuffer]"===Object.prototype.toString.call(e)?e=Buffer.from(e):ArrayBuffer.isView(e)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof s.default||(e=Buffer.from(String(e)))),this[f]={body:e,disturbed:!1,error:null},this.size=void 0===i?0:i,this.timeout=void 0===o?0:o,e instanceof s.default&&e.on("error",function(e){let s="AbortError"===e.name?e:new d(`Invalid response body while trying to fetch ${t.url}: ${e.message}`,"system",e);t[f].error=s})}function y(){var e=this;if(this[f].disturbed)return m.Promise.reject(TypeError(`body used already for: ${this.url}`));if(this[f].disturbed=!0,this[f].error)return m.Promise.reject(this[f].error);let t=this.body;if(null===t)return m.Promise.resolve(Buffer.alloc(0));if(b(t)&&(t=t.stream()),Buffer.isBuffer(t))return m.Promise.resolve(t);if(!(t instanceof s.default))return m.Promise.resolve(Buffer.alloc(0));let r=[],i=0,o=!1;return new m.Promise(function(s,n){let a;e.timeout&&(a=setTimeout(function(){o=!0,n(new d(`Response timeout while trying to fetch ${e.url} (over ${e.timeout}ms)`,"body-timeout"))},e.timeout)),t.on("error",function(t){"AbortError"===t.name?(o=!0,n(t)):n(new d(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t))}),t.on("data",function(t){if(!o&&null!==t){if(e.size&&i+t.length>e.size){o=!0,n(new d(`content size at ${e.url} over limit: ${e.size}`,"max-size"));return}i+=t.length,r.push(t)}}),t.on("end",function(){if(!o){clearTimeout(a);try{s(Buffer.concat(r,i))}catch(t){n(new d(`Could not create Buffer from response body for ${e.url}: ${t.message}`,"system",t))}}})})}function g(e){return"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&("URLSearchParams"===e.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(e)||"function"==typeof e.sort)}function b(e){return"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}function _(e){let t,r,i=e.body;if(e.bodyUsed)throw Error("cannot clone body after it is used");return i instanceof s.default&&"function"!=typeof i.getBoundary&&(t=new p,r=new p,i.pipe(t),i.pipe(r),e[f].body=t,i=r),i}function w(e){if(null===e)return null;if("string"==typeof e)return"text/plain;charset=UTF-8";if(g(e))return"application/x-www-form-urlencoded;charset=UTF-8";if(b(e))return e.type||null;if(Buffer.isBuffer(e))return null;else if("[object ArrayBuffer]"===Object.prototype.toString.call(e))return null;else if(ArrayBuffer.isView(e))return null;else if("function"==typeof e.getBoundary)return`multipart/form-data;boundary=${e.getBoundary()}`;else if(e instanceof s.default)return null;else return"text/plain;charset=UTF-8"}function v(e){let t=e.body;return null===t?0:b(t)?t.size:Buffer.isBuffer(t)?t.length:t&&"function"==typeof t.getLengthSync?t._lengthRetrievers&&0==t._lengthRetrievers.length||t.hasKnownLength&&t.hasKnownLength()?t.getLengthSync():null:null}m.prototype={get body(){return this[f].body},get bodyUsed(){return this[f].disturbed},arrayBuffer(){return y.call(this).then(function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)})},blob(){let e=this.headers&&this.headers.get("content-type")||"";return y.call(this).then(function(t){return Object.assign(new c([],{type:e.toLowerCase()}),{[l]:t})})},json(){var e=this;return y.call(this).then(function(t){try{return JSON.parse(t.toString())}catch(t){return m.Promise.reject(new d(`invalid json response body at ${e.url} reason: ${t.message}`,"invalid-json"))}})},text(){return y.call(this).then(function(e){return e.toString()})},buffer(){return y.call(this)},textConverted(){var e=this;return y.call(this).then(function(s){return function(e,s){let r,i;if("function"!=typeof t)throw Error("The package `encoding` must be installed to use the textConverted() function");let o=s.get("content-type"),n="utf-8";return o&&(r=/charset=([^;]*)/i.exec(o)),i=e.slice(0,1024).toString(),!r&&i&&(r=/<meta.+?charset=(['"])(.+?)\1/i.exec(i)),!r&&i&&(!(r=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(i))&&(r=/<meta[\s]+?content=(['"])(.+?)\1[\s]+?http-equiv=(['"])content-type\3/i.exec(i))&&r.pop(),r&&(r=/charset=(.*)/i.exec(r.pop()))),!r&&i&&(r=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(i)),r&&("gb2312"===(n=r.pop())||"gbk"===n)&&(n="gb18030"),t(e,"UTF-8",n).toString()}(s,e.headers)})}},Object.defineProperties(m.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),m.mixIn=function(e){for(let t of Object.getOwnPropertyNames(m.prototype))if(!(t in e)){let s=Object.getOwnPropertyDescriptor(m.prototype,t);Object.defineProperty(e,t,s)}},m.Promise=e.g.Promise;let S=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,E=/[^\t\x20-\x7e\x80-\xff]/;function C(e){if(e=`${e}`,S.test(e)||""===e)throw TypeError(`${e} is not a legal HTTP header name`)}function x(e){if(e=`${e}`,E.test(e))throw TypeError(`${e} is not a legal HTTP header value`)}function A(e,t){for(let s in t=t.toLowerCase(),e)if(s.toLowerCase()===t)return s}let T=Symbol("map");class k{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[T]=Object.create(null),e instanceof k){const t=e.raw();for(const e of Object.keys(t))for(const s of t[e])this.append(e,s);return}if(null==e);else if("object"==typeof e){const t=e[Symbol.iterator];if(null!=t){if("function"!=typeof t)throw TypeError("Header pairs must be iterable");const s=[];for(const t of e){if("object"!=typeof t||"function"!=typeof t[Symbol.iterator])throw TypeError("Each header pair must be iterable");s.push(Array.from(t))}for(const e of s){if(2!==e.length)throw TypeError("Each header pair must be a name/value tuple");this.append(e[0],e[1])}}else for(const t of Object.keys(e)){const s=e[t];this.append(t,s)}}else throw TypeError("Provided initializer must be an object")}get(e){C(e=`${e}`);let t=A(this[T],e);return void 0===t?null:this[T][t].join(", ")}forEach(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,s=R(this),r=0;for(;r<s.length;){var i=s[r];let o=i[0],n=i[1];e.call(t,n,o,this),s=R(this),r++}}set(e,t){e=`${e}`,t=`${t}`,C(e),x(t);let s=A(this[T],e);this[T][void 0!==s?s:e]=[t]}append(e,t){e=`${e}`,t=`${t}`,C(e),x(t);let s=A(this[T],e);void 0!==s?this[T][s].push(t):this[T][e]=[t]}has(e){return C(e=`${e}`),void 0!==A(this[T],e)}delete(e){C(e=`${e}`);let t=A(this[T],e);void 0!==t&&delete this[T][t]}raw(){return this[T]}keys(){return O(this,"key")}values(){return O(this,"value")}[Symbol.iterator](){return O(this,"key+value")}}function R(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";return Object.keys(e[T]).sort().map("key"===t?function(e){return e.toLowerCase()}:"value"===t?function(t){return e[T][t].join(", ")}:function(t){return[t.toLowerCase(),e[T][t].join(", ")]})}k.prototype.entries=k.prototype[Symbol.iterator],Object.defineProperty(k.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(k.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});let q=Symbol("internal");function O(e,t){let s=Object.create(I);return s[q]={target:e,kind:t,index:0},s}let I=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==I)throw TypeError("Value of `this` is not a HeadersIterator");var e=this[q];let t=e.target,s=e.kind,r=e.index,i=R(t,s);return r>=i.length?{value:void 0,done:!0}:(this[q].index=r+1,{value:i[r],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));Object.defineProperty(I,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});let L=Symbol("Response internals"),D=r.default.STATUS_CODES;class P{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};m.call(this,e,t);const s=t.status||200,r=new k(t.headers);if(null!=e&&!r.has("Content-Type")){const t=w(e);t&&r.append("Content-Type",t)}this[L]={url:t.url,status:s,statusText:t.statusText||D[s],headers:r,counter:t.counter}}get url(){return this[L].url||""}get status(){return this[L].status}get ok(){return this[L].status>=200&&this[L].status<300}get redirected(){return this[L].counter>0}get statusText(){return this[L].statusText}get headers(){return this[L].headers}clone(){return new P(_(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}m.mixIn(P.prototype),Object.defineProperties(P.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(P.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});let N=Symbol("Request internals"),U=i.default.URL||o.default.URL,B=i.default.parse,F=i.default.format;function j(e){return/^[a-zA-Z][a-zA-Z\d+\-.]*:/.exec(e)&&(e=new U(e).toString()),B(e)}let M="destroy"in s.default.Readable.prototype;function $(e){return"object"==typeof e&&"object"==typeof e[N]}class V{constructor(e){let t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};$(e)?t=j(e.url):(t=e&&e.href?j(e.href):j(`${e}`),e={});let r=s.method||e.method||"GET";if(r=r.toUpperCase(),(null!=s.body||$(e)&&null!==e.body)&&("GET"===r||"HEAD"===r))throw TypeError("Request with GET/HEAD method cannot have body");let i=null!=s.body?s.body:$(e)&&null!==e.body?_(e):null;m.call(this,i,{timeout:s.timeout||e.timeout||0,size:s.size||e.size||0});const o=new k(s.headers||e.headers||{});if(null!=i&&!o.has("Content-Type")){const e=w(i);e&&o.append("Content-Type",e)}let n=$(e)?e.signal:null;if("signal"in s&&(n=s.signal),null!=n&&!function(e){let t=e&&"object"==typeof e&&Object.getPrototypeOf(e);return!!(t&&"AbortSignal"===t.constructor.name)}(n))throw TypeError("Expected signal to be an instanceof AbortSignal");this[N]={method:r,redirect:s.redirect||e.redirect||"follow",headers:o,parsedURL:t,signal:n},this.follow=void 0!==s.follow?s.follow:void 0!==e.follow?e.follow:20,this.compress=void 0!==s.compress?s.compress:void 0===e.compress||e.compress,this.counter=s.counter||e.counter||0,this.agent=s.agent||e.agent}get method(){return this[N].method}get url(){return F(this[N].parsedURL)}get headers(){return this[N].headers}get redirect(){return this[N].redirect}get signal(){return this[N].signal}clone(){return new V(this)}}function W(e){Error.call(this,e),this.type="aborted",this.message=e,Error.captureStackTrace(this,this.constructor)}m.mixIn(V.prototype),Object.defineProperty(V.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(V.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),W.prototype=Object.create(Error.prototype),W.prototype.constructor=W,W.prototype.name="AbortError";let z=i.default.URL||o.default.URL,G=s.default.PassThrough,H=function(e,t){let s=new z(t).hostname,r=new z(e).hostname;return s===r||"."===s[s.length-r.length-1]&&s.endsWith(r)};function K(e,t){if(!K.Promise)throw Error("native promise missing, set fetch.Promise to your favorite alternative");return m.Promise=K.Promise,new K.Promise(function(i,o){var u,l;let h,c,f,p=new V(e,t),m=function(e){let t,r,i=e[N].parsedURL,o=new k(e[N].headers);if(o.has("Accept")||o.set("Accept","*/*"),!i.protocol||!i.hostname)throw TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(i.protocol))throw TypeError("Only HTTP(S) protocols are supported");if(e.signal&&e.body instanceof s.default.Readable&&!M)throw Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let n=null;if(null==e.body&&/^(POST|PUT)$/i.test(e.method)&&(n="0"),null!=e.body){let t=v(e);"number"==typeof t&&(n=String(t))}n&&o.set("Content-Length",n),o.has("User-Agent")||o.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),e.compress&&!o.has("Accept-Encoding")&&o.set("Accept-Encoding","gzip,deflate");let a=e.agent;return"function"==typeof a&&(a=a(i)),Object.assign({},i,{method:e.method,headers:(t=Object.assign({__proto__:null},o[T]),void 0!==(r=A(o[T],"Host"))&&(t[r]=t[r][0]),t),agent:a})}(p),y=("https:"===m.protocol?n.default:r.default).request,g=p.signal,_=null,w=function(){let e=new W("The user aborted a request.");o(e),p.body&&p.body instanceof s.default.Readable&&Q(p.body,e),_&&_.body&&_.body.emit("error",e)};if(g&&g.aborted)return void w();let C=function(){w(),R()},x=y(m);function R(){x.abort(),g&&g.removeEventListener("abort",C),clearTimeout(c)}g&&g.addEventListener("abort",C),p.timeout&&x.once("socket",function(e){c=setTimeout(function(){o(new d(`network timeout at: ${p.url}`,"request-timeout")),R()},p.timeout)}),x.on("error",function(e){o(new d(`request to ${p.url} failed, reason: ${e.message}`,"system",e)),_&&_.body&&Q(_.body,e),R()}),u=x,l=function(e){(!g||!g.aborted)&&_&&_.body&&Q(_.body,e)},u.on("socket",function(e){h=e}),u.on("response",function(e){let t=e.headers;"chunked"!==t["transfer-encoding"]||t["content-length"]||e.once("close",function(e){if(h&&h.listenerCount("data")>0&&!e){let e=Error("Premature close");e.code="ERR_STREAM_PREMATURE_CLOSE",l(e)}})}),14>parseInt(process.version.substring(1))&&x.on("socket",function(e){e.addListener("close",function(t){let s=e.listenerCount("data")>0;if(_&&s&&!t&&!(g&&g.aborted)){let e=Error("Premature close");e.code="ERR_STREAM_PREMATURE_CLOSE",_.body.emit("error",e)}})}),x.on("response",function(e){clearTimeout(c);let t=function(e){let t=new k;for(let s of Object.keys(e))if(!S.test(s))if(Array.isArray(e[s]))for(let r of e[s])E.test(r)||(void 0===t[T][s]?t[T][s]=[r]:t[T][s].push(r));else E.test(e[s])||(t[T][s]=[e[s]]);return t}(e.headers);if(K.isRedirect(e.statusCode)){let r=t.get("Location"),n=null;try{n=null===r?null:new z(r,p.url).toString()}catch(e){if("manual"!==p.redirect){o(new d(`uri requested responds with an invalid redirect URL: ${r}`,"invalid-redirect")),R();return}}switch(p.redirect){case"error":o(new d(`uri requested responds with a redirect, redirect mode is set to error: ${p.url}`,"no-redirect")),R();return;case"manual":if(null!==n)try{t.set("Location",n)}catch(e){o(e)}break;case"follow":var s;if(null===n)break;if(p.counter>=p.follow){o(new d(`maximum redirect reached at: ${p.url}`,"max-redirect")),R();return}let a={headers:new k(p.headers),follow:p.follow,counter:p.counter+1,agent:p.agent,compress:p.compress,method:p.method,body:p.body,signal:p.signal,timeout:p.timeout,size:p.size};if(!H(p.url,n)||(s=p.url,new z(n).protocol!==new z(s).protocol))for(let e of["authorization","www-authenticate","cookie","cookie2"])a.headers.delete(e);if(303!==e.statusCode&&p.body&&null===v(p)){o(new d("Cannot follow redirect with body being a readable stream","unsupported-redirect")),R();return}(303===e.statusCode||(301===e.statusCode||302===e.statusCode)&&"POST"===p.method)&&(a.method="GET",a.body=void 0,a.headers.delete("content-length")),i(K(new V(n,a))),R();return}}e.once("end",function(){g&&g.removeEventListener("abort",C)});let r=e.pipe(new G),n={url:p.url,status:e.statusCode,statusText:e.statusMessage,headers:t,size:p.size,timeout:p.timeout,counter:p.counter},u=t.get("Content-Encoding");if(!p.compress||"HEAD"===p.method||null===u||204===e.statusCode||304===e.statusCode)return void i(_=new P(r,n));let l={flush:a.default.Z_SYNC_FLUSH,finishFlush:a.default.Z_SYNC_FLUSH};if("gzip"==u||"x-gzip"==u)return void i(_=new P(r=r.pipe(a.default.createGunzip(l)),n));if("deflate"==u||"x-deflate"==u){let t=e.pipe(new G);t.once("data",function(e){i(_=new P(r=(15&e[0])==8?r.pipe(a.default.createInflate()):r.pipe(a.default.createInflateRaw()),n))}),t.on("end",function(){_||i(_=new P(r,n))});return}"br"==u&&"function"==typeof a.default.createBrotliDecompress?i(_=new P(r=r.pipe(a.default.createBrotliDecompress()),n)):i(_=new P(r,n))}),null===(f=p.body)?x.end():b(f)?f.stream().pipe(x):Buffer.isBuffer(f)?(x.write(f),x.end()):f.pipe(x)})}function Q(e,t){e.destroy?e.destroy(t):(e.emit("error",t),e.end())}K.isRedirect=function(e){return 301===e||302===e||303===e||307===e||308===e},K.Promise=e.g.Promise,e.s(["AbortError",()=>W,"FetchError",()=>d,"Headers",()=>k,"Request",()=>V,"Response",()=>P,"default",0,K])},10671,(e,t,s)=>{let r=e.r(61227),i=r.default||r,o=function(e,t){return/^\/\//.test(e)&&(e="https:"+e),i.call(this,e,t)};o.ponyfill=!0,t.exports=s=o,s.fetch=o,s.Headers=r.Headers,s.Request=r.Request,s.Response=r.Response,s.default=o},74270,(e,t,s)=>{function r(e,t){var s=!1,r=this;return Promise.all(e.map(function(){var e=arguments;return r(function(){if(!s)return t.apply(void 0,e).catch(function(e){throw s=!0,e})})}))}function i(e){return e.queue=0,e.map=r,e}t.exports=function(e){return e?i(function(e){var t=0,s=[];function r(){var r;--t<e&&(r=s.shift(),o.queue=s.length,r&&i(r.fn).then(r.resolve).catch(r.reject))}function i(e){t++;try{return Promise.resolve(e()).then(function(e){return r(),e},function(e){throw r(),e})}catch(e){return r(),Promise.reject(e)}}var o=function(r){return t>=e?new Promise(function(e,t){s.push({fn:r,resolve:e,reject:t}),o.queue=s.length}):i(r)};return o}(e)):i(function(e){return e()})}},98686,e=>{"use strict";let t,s;class r extends Error{code;extendedCode;rawCode;constructor(e,t,s,r,i){void 0!==t&&(e=`${t}: ${e}`),super(e,{cause:i}),this.code=t,this.extendedCode=s,this.rawCode=r,this.name="LibsqlError"}}class i extends r{statementIndex;constructor(e,t,s,r,i,o){super(e,s,r,i,o),this.statementIndex=t,this.name="LibsqlBatchError"}}let o=RegExp("^(?<scheme>[A-Za-z][A-Za-z.+-]*):(//(?<authority>[^/?#]*))?(?<path>[^?#]*)(\\?(?<query>[^#]*))?(#(?<fragment>.*))?$","su"),n=RegExp("^((?<username>[^:]*)(:(?<password>.*))?@)?((?<host>[^:\\[\\]]*)|(\\[(?<host_br>[^\\[\\]]*)\\]))(:(?<port>[0-9]*))?$","su");function a(e){try{return decodeURIComponent(e)}catch(e){if(e instanceof URIError)throw new r(`URL component has invalid percent encoding: ${e}`,"URL_INVALID",void 0,void 0,e);throw e}}function u(e,t,s){var i,o;if(void 0===t)throw new r(`URL with scheme ${JSON.stringify(e+":")} requires authority (the "//" part)`,"URL_INVALID");let n=`${e}:`,a=(i=t.host).includes(":")?`[${encodeURI(i)}]`:encodeURI(i),u=void 0!==(o=t.port)?`:${o}`:"",l=function(e){if(void 0===e)return"";let t=encodeURIComponent(e.username),s=void 0!==e.password?`:${encodeURIComponent(e.password)}`:"";return`${t}${s}@`}(t.userinfo),h=`//${l}${a}${u}`,c=s.split("/").map(encodeURIComponent).join("/");return""===c||c.startsWith("/")||(c="/"+c),new URL(`${n}${h}${c}`)}let l="function"==typeof Buffer,h="function"==typeof TextDecoder?new TextDecoder:void 0,c="function"==typeof TextEncoder?new TextEncoder:void 0,d=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),f=(s={},d.forEach((e,t)=>s[e]=t),s),p=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,m=String.fromCharCode.bind(String),y="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),g=e=>e.replace(/=/g,"").replace(/[+\/]/g,e=>"+"==e?"-":"_"),b="function"==typeof btoa?e=>btoa(e):l?e=>Buffer.from(e,"binary").toString("base64"):e=>{let t,s,r,i,o="",n=e.length%3;for(let n=0;n<e.length;){if((s=e.charCodeAt(n++))>255||(r=e.charCodeAt(n++))>255||(i=e.charCodeAt(n++))>255)throw TypeError("invalid character found");o+=d[(t=s<<16|r<<8|i)>>18&63]+d[t>>12&63]+d[t>>6&63]+d[63&t]}return n?o.slice(0,n-3)+"===".substring(n):o},_=l?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let s=0,r=e.length;s<r;s+=4096)t.push(m.apply(null,e.subarray(s,s+4096)));return b(t.join(""))},w=(e,t=!1)=>t?g(_(e)):_(e),v=e=>{if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?m(192|t>>>6)+m(128|63&t):m(224|t>>>12&15)+m(128|t>>>6&63)+m(128|63&t)}var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return m(240|t>>>18&7)+m(128|t>>>12&63)+m(128|t>>>6&63)+m(128|63&t)},S=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,E=l?e=>Buffer.from(e,"utf8").toString("base64"):c?e=>_(c.encode(e)):e=>b(e.replace(S,v)),C=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,x=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return m((t>>>10)+55296)+m((1023&t)+56320);case 3:return m((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return m((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},A="function"==typeof atob?e=>atob(e.replace(/[^A-Za-z0-9\+\/]/g,"")):l?e=>Buffer.from(e,"base64").toString("binary"):e=>{let t,s,r;if(e=e.replace(/\s+/g,""),!p.test(e))throw TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let i=[];for(let o=0;o<e.length;)t=f[e.charAt(o++)]<<18|f[e.charAt(o++)]<<12|(s=f[e.charAt(o++)])<<6|(r=f[e.charAt(o++)]),64===s?i.push(m(t>>16&255)):64===r?i.push(m(t>>16&255,t>>8&255)):i.push(m(t>>16&255,t>>8&255,255&t));return i.join("")},T=l?e=>y(Buffer.from(e,"base64")):e=>y(A(e).split("").map(e=>e.charCodeAt(0))),k=e=>T(q(e)),R=l?e=>Buffer.from(e,"base64").toString("utf8"):h?e=>h.decode(T(e)):e=>A(e).replace(C,x),q=e=>e.replace(/[-_]/g,e=>"-"==e?"+":"/").replace(/[^A-Za-z0-9\+\/]/g,""),O="https://github.com/libsql/libsql-client-ts#supported-urls";function I(e){if("write"===e)return"BEGIN IMMEDIATE";if("read"===e)return"BEGIN TRANSACTION READONLY";if("deferred"===e)return"BEGIN DEFERRED";throw RangeError('Unknown transaction mode, supported values are "write", "read" and "deferred"')}class L{columns;columnTypes;rows;rowsAffected;lastInsertRowid;constructor(e,t,s,r,i){this.columns=e,this.columnTypes=t,this.rows=s,this.rowsAffected=r,this.lastInsertRowid=i}toJSON(){return{columns:this.columns,columnTypes:this.columnTypes,rows:this.rows.map(D),rowsAffected:this.rowsAffected,lastInsertRowid:void 0!==this.lastInsertRowid?""+this.lastInsertRowid:null}}}function D(e){return Array.prototype.map.call(e,P)}function P(e){return"bigint"==typeof e?""+e:e instanceof ArrayBuffer?w(new Uint8Array(e)):e}let N=":memory:";e.i(21365),e.i(29485),e.i(16735);var U=e.i(35065);e.i(17198),U.default;class B{constructor(){this.intMode="number"}intMode}class F extends Error{constructor(e){super(e),this.name="ClientError"}}class j extends F{constructor(e){super(e),this.name="ProtoError"}}class M extends F{code;proto;constructor(e,t){super(e),this.name="ResponseError",this.code=t.code,this.proto=t,this.stack=void 0}}class $ extends F{constructor(e,t){void 0!==t?(super(`${e}: ${t}`),this.cause=t):super(e),this.name="ClosedError"}}class V extends F{constructor(e){super(e),this.name="WebSocketUnsupportedError"}}class W extends F{constructor(e){super(e),this.name="WebSocketError"}}class z extends F{status;constructor(e,t){super(e),this.status=t,this.name="HttpServerError"}}class G extends F{constructor(e){super(e),this.name="ProtocolVersionError"}}class H extends F{constructor(e){super(e),this.name="InternalError"}}class K extends F{constructor(e){super(e),this.name="MisuseError"}}function Q(e){if("string"==typeof e)return e;throw es(e,"string")}function J(e){if(null!=e){if("string"==typeof e)return e;throw es(e,"string or null")}}function Y(e){if("number"==typeof e)return e;throw es(e,"number")}function Z(e){if("boolean"==typeof e)return e;throw es(e,"boolean")}function X(e){if(Array.isArray(e))return e;throw es(e,"array")}function ee(e){if(null!==e&&"object"==typeof e&&!Array.isArray(e))return e;throw es(e,"object")}function et(e,t){return X(e).map(e=>t(ee(e)))}function es(e,t){if(void 0===e)return new j(`Expected ${t}, but the property was missing`);let s=typeof e;return null===e?s="null":Array.isArray(e)&&(s="array"),new j(`Expected ${t}, received ${s}`)}class er{#e;#t;constructor(e){this.#e=e,this.#t=!1}begin(){this.#e.push("{"),this.#t=!0}end(){this.#e.push("}"),this.#t=!1}#s(e){this.#t?(this.#e.push('"'),this.#t=!1):this.#e.push(',"'),this.#e.push(e),this.#e.push('":')}string(e,t){this.#s(e),this.#e.push(JSON.stringify(t))}stringRaw(e,t){this.#s(e),this.#e.push('"'),this.#e.push(t),this.#e.push('"')}number(e,t){this.#s(e),this.#e.push(""+t)}boolean(e,t){this.#s(e),this.#e.push(t?"true":"false")}object(e,t,s){this.#s(e),this.begin(),s(this,t),this.end()}arrayObjects(e,t,s){this.#s(e),this.#e.push("[");for(let e=0;e<t.length;++e)0!==e&&this.#e.push(","),this.begin(),s(this,t[e]),this.end();this.#e.push("]")}}function ei(e,t){let s=[],r=new er(s);return r.begin(),t(r,e),r.end(),s.join("")}class eo{#r;#i;#o;constructor(e){this.#r=e,this.#i=new DataView(e.buffer,e.byteOffset,e.byteLength),this.#o=0}varint(){let e=0;for(let t=0;;t+=7){let s=this.#r[this.#o++];if(e|=(127&s)<<t,!(128&s))break}return e}varintBig(){let e=0n;for(let t=0n;;t+=7n){let s=this.#r[this.#o++];if(e|=BigInt(127&s)<<t,!(128&s))break}return e}bytes(e){let t=new Uint8Array(this.#r.buffer,this.#r.byteOffset+this.#o,e);return this.#o+=e,t}double(){let e=this.#i.getFloat64(this.#o,!0);return this.#o+=8,e}skipVarint(){for(;128&this.#r[this.#o++];);}skip(e){this.#o+=e}eof(){return this.#o>=this.#r.byteLength}}class en{#n;#a;constructor(e){this.#n=e,this.#a=-1}setup(e){this.#a=e}#u(e){if(this.#a!==e)throw new j(`Expected wire type ${e}, got ${this.#a}`);this.#a=-1}bytes(){this.#u(2);let e=this.#n.varint();return this.#n.bytes(e)}string(){return new TextDecoder().decode(this.bytes())}message(e){return ea(this.bytes(),e)}int32(){return this.#u(0),this.#n.varint()}uint32(){return this.int32()}bool(){return 0!==this.int32()}uint64(){return this.#u(0),this.#n.varintBig()}sint64(){let e=this.uint64();return e>>1n^-(1n&e)}double(){return this.#u(1),this.#n.double()}maybeSkip(){if(!(this.#a<0)){if(0===this.#a)this.#n.skipVarint();else if(1===this.#a)this.#n.skip(8);else if(2===this.#a){let e=this.#n.varint();this.#n.skip(e)}else if(5===this.#a)this.#n.skip(4);else throw new j(`Unexpected wire type ${this.#a}`);this.#a=-1}}}function ea(e,t){let s=new eo(e),r=new en(s),i=t.default();for(;!s.eof();){let e=s.varint(),o=e>>3,n=7&e;r.setup(n);let a=t[o];if(void 0!==a){let e=a(r,i);void 0!==e&&(i=e)}r.maybeSkip()}return i}class eu{#l;#r;#i;#o;constructor(){this.#l=new ArrayBuffer(256),this.#r=new Uint8Array(this.#l),this.#i=new DataView(this.#l),this.#o=0}#h(e){if(this.#o+e<=this.#l.byteLength)return;let t=this.#l.byteLength;for(;t<this.#o+e;)t*=2;let s=new ArrayBuffer(t),r=new Uint8Array(s),i=new DataView(s);r.set(new Uint8Array(this.#l,0,this.#o)),this.#l=s,this.#r=r,this.#i=i}#c(e){this.#h(5),e|=0;do{let t=127&e;e>>>=7,t|=128*!!e,this.#r[this.#o++]=t}while(e)}#d(e){this.#h(10),e&=0xffffffffffffffffn;do{let t=Number(127n&e);e>>=7n,t|=128*!!e,this.#r[this.#o++]=t}while(e)}#f(e,t){this.#c(e<<3|t)}bytes(e,t){this.#f(e,2),this.#c(t.byteLength),this.#h(t.byteLength),this.#r.set(t,this.#o),this.#o+=t.byteLength}string(e,t){this.bytes(e,new TextEncoder().encode(t))}message(e,t,s){let r=new eu;s(r,t),this.bytes(e,r.data())}int32(e,t){this.#f(e,0),this.#c(t)}uint32(e,t){this.int32(e,t)}bool(e,t){this.int32(e,+!!t)}sint64(e,t){this.#f(e,0),this.#d(t<<1n^t>>63n)}double(e,t){this.#f(e,1),this.#h(8),this.#i.setFloat64(this.#o,t,!0),this.#o+=8}data(){return new Uint8Array(this.#l,0,this.#o)}}function el(e,t){let s=new eu;return t(s,e),s.data()}class eh{#p;#m;constructor(){this.#p=new Set,this.#m=new Set}alloc(){for(let e of this.#m)return this.#m.delete(e),this.#p.add(e),this.#p.has(this.#p.size-1)||this.#m.add(this.#p.size-1),e;let e=this.#p.size;return this.#p.add(e),e}free(e){if(!this.#p.delete(e))throw new H("Freeing an id that is not allocated");this.#m.delete(this.#p.size),e<this.#p.size&&this.#m.add(e)}}function ec(e,t){throw new H(t)}function ed(e){if(null===e)return null;if("string"==typeof e)return e;if("number"==typeof e){if(!Number.isFinite(e))throw RangeError("Only finite numbers (not Infinity or NaN) can be passed as arguments");return e}if("bigint"==typeof e){if(e<ef||e>ep)throw RangeError("This bigint value is too large to be represented as a 64-bit integer and passed as argument");return e}if("boolean"==typeof e)return e?1n:0n;else if(e instanceof ArrayBuffer)return new Uint8Array(e);else if(e instanceof Uint8Array)return e;else if(e instanceof Date)return+e.valueOf();else if("object"==typeof e)return""+e.toString();else throw TypeError("Unsupported type of value")}let ef=-0x8000000000000000n,ep=0x7fffffffffffffffn;function em(e,t){if(null===e)return null;if("number"==typeof e)return e;if("string"==typeof e)return e;if("bigint"==typeof e)if("number"===t){let t=Number(e);if(!Number.isSafeInteger(t))throw RangeError("Received integer which is too large to be safely represented as a JavaScript number");return t}else if("bigint"===t)return e;else if("string"===t)return""+e;else throw new K("Invalid value for IntMode");if(e instanceof Uint8Array)return e.slice().buffer;else if(void 0===e)throw new j("Received unrecognized type of Value");else throw ec(e,"Impossible type of Value")}function ey(e){return{affectedRowCount:e.affectedRowCount,lastInsertRowid:e.lastInsertRowid,columnNames:e.cols.map(e=>e.name),columnDecltypes:e.cols.map(e=>e.decltype)}}function eg(e,t){let s=ey(e),r=e.rows.map(e=>ew(s.columnNames,e,t));return{...s,rows:r}}function eb(e,t){let s,r=ey(e);return e.rows.length>0&&(s=ew(r.columnNames,e.rows[0],t)),{...r,row:s}}function e_(e,t){let s,r=ey(e);return e.rows.length>0&&r.columnNames.length>0&&(s=em(e.rows[0][0],t)),{...r,value:s}}function ew(e,t,s){let r={};Object.defineProperty(r,"length",{value:t.length});for(let i=0;i<t.length;++i){let o=em(t[i],s);Object.defineProperty(r,i,{value:o});let n=e[i];void 0===n||Object.hasOwn(r,n)||Object.defineProperty(r,n,{value:o,enumerable:!0,configurable:!0,writable:!0})}return r}function ev(e){return new M(e.message,e)}class eS{#y;#g;#b;constructor(e,t){this.#y=e,this.#g=t,this.#b=void 0}_getSqlId(e){if(this.#y!==e)throw new K("Attempted to use SQL text opened with other object");if(void 0!==this.#b)throw new $("SQL text is closed",this.#b);return this.#g}close(){this._setClosed(new F("SQL text was manually closed"))}_setClosed(e){void 0===this.#b&&(this.#b=e,this.#y._closeSql(this.#g))}get closed(){return void 0!==this.#b}}function eE(e,t){return t instanceof eS?{sqlId:t._getSqlId(e)}:{sql:""+t}}class eC{#_;#w;constructor(){this.#_=[],this.#w=[]}get length(){return this.#_.length+this.#w.length}push(e){this.#_.push(e)}shift(){return 0===this.#w.length&&this.#_.length>0&&(this.#w=this.#_.reverse(),this.#_=[]),this.#w.pop()}first(){return 0!==this.#w.length?this.#w[this.#w.length-1]:this.#_[0]}}class ex{sql;_args;_namedArgs;constructor(e){this.sql=e,this._args=[],this._namedArgs=new Map}bindIndexes(e){for(let t of(this._args.length=0,e))this._args.push(ed(t));return this}bindIndex(e,t){if(e!==(0|e)||e<=0)throw RangeError("Index of a positional argument must be positive integer");for(;this._args.length<e;)this._args.push(null);return this._args[e-1]=ed(t),this}bindName(e,t){return this._namedArgs.set(e,ed(t)),this}unbindAll(){return this._args.length=0,this._namedArgs.clear(),this}}function eA(e,t,s){let r,i=[],o=[];if(t instanceof ex)for(let[e,s]of(r=t.sql,i=t._args,t._namedArgs.entries()))o.push({name:e,value:s});else Array.isArray(t)?(r=t[0],Array.isArray(t[1])?i=t[1].map(e=>ed(e)):o=Object.entries(t[1]).map(([e,t])=>({name:e,value:ed(t)}))):r=t;let{sql:n,sqlId:a}=eE(e,r);return{sql:n,sqlId:a,args:i,namedArgs:o,wantRows:s}}class eT{_stream;#v;_steps;#S;constructor(e,t){this._stream=e,this.#v=t,this._steps=[],this.#S=!1}step(){return new eR(this)}execute(){var e,t,s;if(this.#S)throw new K("This batch has already been executed");this.#S=!0;let r={steps:this._steps.map(e=>e.proto)};return this.#v?ek(this._stream,this._steps,r):(e=this._stream,t=this._steps,s=r,e._batch(s).then(e=>{for(let s=0;s<t.length;++s){let r=e.stepResults.get(s),i=e.stepErrors.get(s);t[s].callback(r,i)}}))}}async function ek(e,t,s){let r=await e._openCursor(s);try{let e,s=0,i=[];for(;;){let o=await r.next();if(void 0===o)break;if("step_begin"===o.type){if(o.step<s||o.step>=t.length)throw new j("Server produced StepBeginEntry for unexpected step");if(void 0!==e)throw new j("Server produced StepBeginEntry before terminating previous step");for(let e=s;e<o.step;++e)t[e].callback(void 0,void 0);s=o.step+1,e=o,i=[]}else if("step_end"===o.type){if(void 0===e)throw new j("Server produced StepEndEntry but no step is active");let s={cols:e.cols,rows:i,affectedRowCount:o.affectedRowCount,lastInsertRowid:o.lastInsertRowid};t[e.step].callback(s,void 0),e=void 0,i=[]}else if("step_error"===o.type){if(void 0===e){if(o.step>=t.length)throw new j("Server produced StepErrorEntry for unexpected step");for(let e=s;e<o.step;++e)t[e].callback(void 0,void 0)}else{if(o.step!==e.step)throw new j("Server produced StepErrorEntry for unexpected step");e=void 0,i=[]}t[o.step].callback(void 0,o.error),s=o.step+1}else if("row"===o.type){if(void 0===e)throw new j("Server produced RowEntry but no step is active");i.push(o.row)}else if("error"===o.type)throw ev(o.error);else if("none"===o.type)throw new j("Server produced unrecognized CursorEntry");else throw ec(o,"Impossible CursorEntry")}if(void 0!==e)throw new j("Server closed Cursor before terminating active step");for(let e=s;e<t.length;++e)t[e].callback(void 0,void 0)}finally{r.close()}}class eR{_batch;#E;_index;constructor(e){this._batch=e,this.#E=[],this._index=void 0}condition(e){return this.#E.push(e._proto),this}query(e){return this.#C(e,!0,eg)}queryRow(e){return this.#C(e,!0,eb)}queryValue(e){return this.#C(e,!0,e_)}run(e){return this.#C(e,!1,ey)}#C(e,t,s){if(void 0!==this._index)throw new K("This BatchStep has already been added to the batch");let r={stmt:eA(this._batch._stream._sqlOwner(),e,t),condition:0===this.#E.length?void 0:1===this.#E.length?this.#E[0]:{type:"and",conds:this.#E.slice()}};return new Promise((e,t)=>{let i=(r,i)=>{void 0!==r&&void 0!==i?t(new j("Server returned both result and error")):void 0!==i?t(ev(i)):void 0!==r?e(s(r,this._batch._stream.intMode)):e(void 0)};this._index=this._batch._steps.length,this._batch._steps.push({proto:r,callback:i})})}}class eq{_batch;_proto;constructor(e,t){this._batch=e,this._proto=t}static ok(e){return new eq(e._batch,{type:"ok",step:eO(e)})}static error(e){return new eq(e._batch,{type:"error",step:eO(e)})}static not(e){return new eq(e._batch,{type:"not",cond:e._proto})}static and(e,t){for(let s of t)eI(e,s);return new eq(e,{type:"and",conds:t.map(e=>e._proto)})}static or(e,t){for(let s of t)eI(e,s);return new eq(e,{type:"or",conds:t.map(e=>e._proto)})}static isAutocommit(e){return e._stream.client()._ensureVersion(3,"BatchCond.isAutocommit()"),new eq(e,{type:"is_autocommit"})}}function eO(e){if(void 0===e._index)throw new K("Cannot add a condition referencing a step that has not been added to the batch");return e._index}function eI(e,t){if(t._batch!==e)throw new K("Cannot mix BatchCond objects for different Batch objects")}function eL(e){return{paramNames:e.params.map(e=>e.name),columns:e.cols,isExplain:e.isExplain,isReadonly:e.isReadonly}}class eD{constructor(e){this.intMode=e}query(e){return this.#x(e,!0,eg)}queryRow(e){return this.#x(e,!0,eb)}queryValue(e){return this.#x(e,!0,e_)}run(e){return this.#x(e,!1,ey)}#x(e,t,s){let r=eA(this._sqlOwner(),e,t);return this._execute(r).then(e=>s(e,this.intMode))}batch(e=!1){return new eT(this,e)}describe(e){let t=eE(this._sqlOwner(),e);return this._describe(t).then(eL)}sequence(e){let t=eE(this._sqlOwner(),e);return this._sequence(t)}intMode}class eP{}class eN extends eP{#A;#T;#k;#R;#q;#b;#O;constructor(e,t,s){super(),this.#A=e,this.#T=t,this.#k=s,this.#R=new eC,this.#q=new eC,this.#b=void 0,this.#O=!1}async next(){for(;;){if(void 0!==this.#b)throw new $("Cursor is closed",this.#b);for(;!this.#O&&this.#q.length<10;)this.#q.push(this.#I());let e=this.#R.shift();if(this.#O||void 0!==e)return e;await this.#q.shift().then(e=>{if(void 0!==e){for(let t of e.entries)this.#R.push(t);this.#O||=e.done}})}}#I(){return this.#T._sendCursorRequest(this,{type:"fetch_cursor",cursorId:this.#k,maxCount:1e3}).then(e=>e,e=>{this._setClosed(e)})}_setClosed(e){void 0===this.#b&&(this.#b=e,this.#T._sendCursorRequest(this,{type:"close_cursor",cursorId:this.#k}).catch(()=>void 0),this.#T._cursorClosed(this))}close(){this._setClosed(new F("Cursor was manually closed"))}get closed(){return void 0!==this.#b}}class eU extends eD{#A;#L;#D;#P;#N;#b;static open(e){let t=e._streamIdAlloc.alloc(),s=new eU(e,t);return e._sendRequest({type:"open_stream",streamId:t},{responseCallback:()=>void 0,errorCallback:e=>s.#U(e)}),s}constructor(e,t){super(e.intMode),this.#A=e,this.#L=t,this.#D=new eC,this.#P=void 0,this.#N=!1,this.#b=void 0}client(){return this.#A}_sqlOwner(){return this.#A}_execute(e){return this.#B({type:"execute",streamId:this.#L,stmt:e}).then(e=>e.result)}_batch(e){return this.#B({type:"batch",streamId:this.#L,batch:e}).then(e=>e.result)}_describe(e){return this.#A._ensureVersion(2,"describe()"),this.#B({type:"describe",streamId:this.#L,sql:e.sql,sqlId:e.sqlId}).then(e=>e.result)}_sequence(e){return this.#A._ensureVersion(2,"sequence()"),this.#B({type:"sequence",streamId:this.#L,sql:e.sql,sqlId:e.sqlId}).then(e=>{})}getAutocommit(){return this.#A._ensureVersion(3,"getAutocommit()"),this.#B({type:"get_autocommit",streamId:this.#L}).then(e=>e.isAutocommit)}#B(e){return new Promise((t,s)=>{this.#F({type:"request",request:e,responseCallback:t,errorCallback:s})})}_openCursor(e){return this.#A._ensureVersion(3,"cursor"),new Promise((t,s)=>{this.#F({type:"cursor",batch:e,cursorCallback:t,errorCallback:s})})}_sendCursorRequest(e,t){if(e!==this.#P)throw new H("Cursor not associated with the stream attempted to execute a request");return new Promise((e,s)=>{void 0!==this.#b?s(new $("Stream is closed",this.#b)):this.#A._sendRequest(t,{responseCallback:e,errorCallback:s})})}_cursorClosed(e){if(e!==this.#P)throw new H("Cursor was closed, but it was not associated with the stream");this.#P=void 0,this.#j()}#F(e){void 0!==this.#b?e.errorCallback(new $("Stream is closed",this.#b)):this.#N?e.errorCallback(new $("Stream is closing",void 0)):(this.#D.push(e),this.#j())}#j(){for(;;){let e=this.#D.first();if(void 0===e&&void 0===this.#P&&this.#N){this.#U(new F("Stream was gracefully closed"));break}if(e?.type==="request"&&void 0===this.#P){let{request:t,responseCallback:s,errorCallback:r}=e;this.#D.shift(),this.#A._sendRequest(t,{responseCallback:s,errorCallback:r})}else if(e?.type==="cursor"&&void 0===this.#P){let{batch:t,cursorCallback:s}=e;this.#D.shift();let r=this.#A._cursorIdAlloc.alloc(),i=new eN(this.#A,this,r),o={type:"open_cursor",streamId:this.#L,cursorId:r,batch:t},n=()=>void 0,a=e=>i._setClosed(e);this.#A._sendRequest(o,{responseCallback:n,errorCallback:a}),this.#P=i,s(i)}else break}}#U(e){if(void 0!==this.#b)return;for(this.#b=e,void 0!==this.#P&&this.#P._setClosed(e);;){let t=this.#D.shift();if(void 0!==t)t.errorCallback(e);else break}let t={type:"close_stream",streamId:this.#L},s=()=>this.#A._streamIdAlloc.free(this.#L);this.#A._sendRequest(t,{responseCallback:s,errorCallback:()=>void 0})}close(){this.#U(new F("Stream was manually closed"))}closeGracefully(){this.#N=!0,this.#j()}get closed(){return void 0!==this.#b||this.#N}}function eB(e,t){void 0!==t.sql&&e.string("sql",t.sql),void 0!==t.sqlId&&e.number("sql_id",t.sqlId),e.arrayObjects("args",t.args,eV),e.arrayObjects("named_args",t.namedArgs,eF),e.boolean("want_rows",t.wantRows)}function eF(e,t){e.string("name",t.name),e.object("value",t.value,eV)}function ej(e,t){e.arrayObjects("steps",t.steps,eM)}function eM(e,t){void 0!==t.condition&&e.object("condition",t.condition,e$),e.object("stmt",t.stmt,eB)}function e$(e,t){if(e.stringRaw("type",t.type),"ok"===t.type||"error"===t.type)e.number("step",t.step);else if("not"===t.type)e.object("cond",t.cond,e$);else if("and"===t.type||"or"===t.type)e.arrayObjects("conds",t.conds,e$);else if("is_autocommit"===t.type);else throw ec(t,"Impossible type of BatchCond")}function eV(e,t){if(null===t)e.stringRaw("type","null");else if("bigint"==typeof t)e.stringRaw("type","integer"),e.stringRaw("value",""+t);else if("number"==typeof t)e.stringRaw("type","float"),e.number("value",t);else if("string"==typeof t)e.stringRaw("type","text"),e.string("value",t);else if(t instanceof Uint8Array)e.stringRaw("type","blob"),e.stringRaw("base64",w(t));else if(void 0===t);else throw ec(t,"Impossible type of Value")}function eW(e,t){if(e.stringRaw("type",t.type),"hello"===t.type)void 0!==t.jwt&&e.string("jwt",t.jwt);else if("request"===t.type)e.number("request_id",t.requestId),e.object("request",t.request,ez);else throw ec(t,"Impossible type of ClientMsg")}function ez(e,t){if(e.stringRaw("type",t.type),"open_stream"===t.type)e.number("stream_id",t.streamId);else if("close_stream"===t.type)e.number("stream_id",t.streamId);else if("execute"===t.type)e.number("stream_id",t.streamId),e.object("stmt",t.stmt,eB);else if("batch"===t.type)e.number("stream_id",t.streamId),e.object("batch",t.batch,ej);else if("open_cursor"===t.type)e.number("stream_id",t.streamId),e.number("cursor_id",t.cursorId),e.object("batch",t.batch,ej);else if("close_cursor"===t.type)e.number("cursor_id",t.cursorId);else if("fetch_cursor"===t.type)e.number("cursor_id",t.cursorId),e.number("max_count",t.maxCount);else if("sequence"===t.type)e.number("stream_id",t.streamId),void 0!==t.sql&&e.string("sql",t.sql),void 0!==t.sqlId&&e.number("sql_id",t.sqlId);else if("describe"===t.type)e.number("stream_id",t.streamId),void 0!==t.sql&&e.string("sql",t.sql),void 0!==t.sqlId&&e.number("sql_id",t.sqlId);else if("store_sql"===t.type)e.number("sql_id",t.sqlId),e.string("sql",t.sql);else if("close_sql"===t.type)e.number("sql_id",t.sqlId);else if("get_autocommit"===t.type)e.number("stream_id",t.streamId);else throw ec(t,"Impossible type of Request")}function eG(e,t){for(let s of(void 0!==t.sql&&e.string(1,t.sql),void 0!==t.sqlId&&e.int32(2,t.sqlId),t.args))e.message(3,s,eZ);for(let s of t.namedArgs)e.message(4,s,eH);e.bool(5,t.wantRows)}function eH(e,t){e.string(1,t.name),e.message(2,t.value,eZ)}function eK(e,t){for(let s of t.steps)e.message(1,s,eQ)}function eQ(e,t){void 0!==t.condition&&e.message(1,t.condition,eJ),e.message(2,t.stmt,eG)}function eJ(e,t){if("ok"===t.type)e.uint32(1,t.step);else if("error"===t.type)e.uint32(2,t.step);else if("not"===t.type)e.message(3,t.cond,eJ);else if("and"===t.type)e.message(4,t.conds,eY);else if("or"===t.type)e.message(5,t.conds,eY);else if("is_autocommit"===t.type)e.message(6,void 0,eX);else throw ec(t,"Impossible type of BatchCond")}function eY(e,t){for(let s of t)e.message(1,s,eJ)}function eZ(e,t){if(null===t)e.message(1,void 0,eX);else if("bigint"==typeof t)e.sint64(2,t);else if("number"==typeof t)e.double(3,t);else if("string"==typeof t)e.string(4,t);else if(t instanceof Uint8Array)e.bytes(5,t);else if(void 0===t);else throw ec(t,"Impossible type of Value")}function eX(e,t){}function e0(e,t){if("hello"===t.type)e.message(1,t,e1);else if("request"===t.type)e.message(2,t,e2);else throw ec(t,"Impossible type of ClientMsg")}function e1(e,t){void 0!==t.jwt&&e.string(1,t.jwt)}function e2(e,t){e.int32(1,t.requestId);let s=t.request;if("open_stream"===s.type)e.message(2,s,e3);else if("close_stream"===s.type)e.message(3,s,e4);else if("execute"===s.type)e.message(4,s,e8);else if("batch"===s.type)e.message(5,s,e6);else if("open_cursor"===s.type)e.message(6,s,e5);else if("close_cursor"===s.type)e.message(7,s,e7);else if("fetch_cursor"===s.type)e.message(8,s,e9);else if("sequence"===s.type)e.message(9,s,te);else if("describe"===s.type)e.message(10,s,tt);else if("store_sql"===s.type)e.message(11,s,ts);else if("close_sql"===s.type)e.message(12,s,tr);else if("get_autocommit"===s.type)e.message(13,s,ti);else throw ec(s,"Impossible type of Request")}function e3(e,t){e.int32(1,t.streamId)}function e4(e,t){e.int32(1,t.streamId)}function e8(e,t){e.int32(1,t.streamId),e.message(2,t.stmt,eG)}function e6(e,t){e.int32(1,t.streamId),e.message(2,t.batch,eK)}function e5(e,t){e.int32(1,t.streamId),e.int32(2,t.cursorId),e.message(3,t.batch,eK)}function e7(e,t){e.int32(1,t.cursorId)}function e9(e,t){e.int32(1,t.cursorId),e.uint32(2,t.maxCount)}function te(e,t){e.int32(1,t.streamId),void 0!==t.sql&&e.string(2,t.sql),void 0!==t.sqlId&&e.int32(3,t.sqlId)}function tt(e,t){e.int32(1,t.streamId),void 0!==t.sql&&e.string(2,t.sql),void 0!==t.sqlId&&e.int32(3,t.sqlId)}function ts(e,t){e.int32(1,t.sqlId),e.string(2,t.sql)}function tr(e,t){e.int32(1,t.sqlId)}function ti(e,t){e.int32(1,t.streamId)}function to(e){return{message:Q(e.message),code:J(e.code)}}function tn(e){let t=et(e.cols,ta),s=X(e.rows).map(e=>et(e,tf)),r=Y(e.affected_row_count),i=J(e.last_insert_rowid);return{cols:t,rows:s,affectedRowCount:r,lastInsertRowid:void 0!==i?BigInt(i):void 0}}function ta(e){return{name:J(e.name),decltype:J(e.decltype)}}function tu(e){let t=new Map;X(e.step_results).forEach((e,s)=>{null!==e&&t.set(s,tn(ee(e)))});let s=new Map;return X(e.step_errors).forEach((e,t)=>{null!==e&&s.set(t,to(ee(e)))}),{stepResults:t,stepErrors:s}}function tl(e){let t=Q(e.type);if("step_begin"===t)return{type:"step_begin",step:Y(e.step),cols:et(e.cols,ta)};if("step_end"===t){let t=Y(e.affected_row_count),s=J(e.last_insert_rowid);return{type:"step_end",affectedRowCount:t,lastInsertRowid:void 0!==s?BigInt(s):void 0}}if("step_error"===t)return{type:"step_error",step:Y(e.step),error:to(ee(e.error))};if("row"===t)return{type:"row",row:et(e.row,tf)};if("error"===t)return{type:"error",error:to(ee(e.error))};else throw new j("Unexpected type of CursorEntry")}function th(e){let t=et(e.params,tc),s=et(e.cols,td);return{params:t,cols:s,isExplain:Z(e.is_explain),isReadonly:Z(e.is_readonly)}}function tc(e){return{name:J(e.name)}}function td(e){return{name:Q(e.name),decltype:J(e.decltype)}}function tf(e){let t=Q(e.type);if("null"===t)return null;if("integer"===t)return BigInt(Q(e.value));if("float"===t)return Y(e.value);if("text"===t)return Q(e.value);if("blob"===t)return k(Q(e.base64));else throw new j("Unexpected type of Value")}let tp={default:()=>({message:"",code:void 0}),1(e,t){t.message=e.string()},2(e,t){t.code=e.string()}},tm={default:()=>({cols:[],rows:[],affectedRowCount:0,lastInsertRowid:void 0}),1(e,t){t.cols.push(e.message(ty))},2(e,t){t.rows.push(e.message(tg))},3(e,t){t.affectedRowCount=Number(e.uint64())},4(e,t){t.lastInsertRowid=e.sint64()}},ty={default:()=>({name:void 0,decltype:void 0}),1(e,t){t.name=e.string()},2(e,t){t.decltype=e.string()}},tg={default:()=>[],1(e,t){t.push(e.message(tk))}},tb={default:()=>({stepResults:new Map,stepErrors:new Map}),1(e,t){let[s,r]=e.message(t_);t.stepResults.set(s,r)},2(e,t){let[s,r]=e.message(tw);t.stepErrors.set(s,r)}},t_={default:()=>[0,tm.default()],1(e,t){t[0]=e.uint32()},2(e,t){t[1]=e.message(tm)}},tw={default:()=>[0,tp.default()],1(e,t){t[0]=e.uint32()},2(e,t){t[1]=e.message(tp)}},tv={default:()=>({type:"none"}),1:e=>e.message(tS),2:e=>e.message(tE),3:e=>e.message(tC),4:e=>({type:"row",row:e.message(tg)}),5:e=>({type:"error",error:e.message(tp)})},tS={default:()=>({type:"step_begin",step:0,cols:[]}),1(e,t){t.step=e.uint32()},2(e,t){t.cols.push(e.message(ty))}},tE={default:()=>({type:"step_end",affectedRowCount:0,lastInsertRowid:void 0}),1(e,t){t.affectedRowCount=e.uint32()},2(e,t){t.lastInsertRowid=e.uint64()}},tC={default:()=>({type:"step_error",step:0,error:tp.default()}),1(e,t){t.step=e.uint32()},2(e,t){t.error=e.message(tp)}},tx={default:()=>({params:[],cols:[],isExplain:!1,isReadonly:!1}),1(e,t){t.params.push(e.message(tA))},2(e,t){t.cols.push(e.message(tT))},3(e,t){t.isExplain=e.bool()},4(e,t){t.isReadonly=e.bool()}},tA={default:()=>({name:void 0}),1(e,t){t.name=e.string()}},tT={default:()=>({name:"",decltype:void 0}),1(e,t){t.name=e.string()},2(e,t){t.decltype=e.string()}},tk={default(){},1:e=>null,2:e=>e.sint64(),3:e=>e.double(),4:e=>e.string(),5:e=>e.bytes()},tR={default:()=>({type:"none"}),1:e=>({type:"hello_ok"}),2:e=>e.message(tq),3:e=>e.message(tI),4:e=>e.message(tO)},tq={default:()=>({type:"hello_error",error:tp.default()}),1(e,t){t.error=e.message(tp)}},tO={default:()=>({type:"response_error",requestId:0,error:tp.default()}),1(e,t){t.requestId=e.int32()},2(e,t){t.error=e.message(tp)}},tI={default:()=>({type:"response_ok",requestId:0,response:{type:"none"}}),1(e,t){t.requestId=e.int32()},2(e,t){t.response={type:"open_stream"}},3(e,t){t.response={type:"close_stream"}},4(e,t){t.response=e.message(tL)},5(e,t){t.response=e.message(tD)},6(e,t){t.response={type:"open_cursor"}},7(e,t){t.response={type:"close_cursor"}},8(e,t){t.response=e.message(tP)},9(e,t){t.response={type:"sequence"}},10(e,t){t.response=e.message(tN)},11(e,t){t.response={type:"store_sql"}},12(e,t){t.response={type:"close_sql"}},13(e,t){t.response=e.message(tU)}},tL={default:()=>({type:"execute",result:tm.default()}),1(e,t){t.result=e.message(tm)}},tD={default:()=>({type:"batch",result:tb.default()}),1(e,t){t.result=e.message(tb)}},tP={default:()=>({type:"fetch_cursor",entries:[],done:!1}),1(e,t){t.entries.push(e.message(tv))},2(e,t){t.done=e.bool()}},tN={default:()=>({type:"describe",result:tx.default()}),1(e,t){t.result=e.message(tx)}},tU={default:()=>({type:"get_autocommit",isAutocommit:!1}),1(e,t){t.isAutocommit=e.bool()}},tB=new Map([["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]),tF=new Map([["hrana3-protobuf",{version:3,encoding:"protobuf"}],["hrana3",{version:3,encoding:"json"}],["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]);class tj extends B{#M;#$;#V;#b;#W;#z;#G;#H;#K;_streamIdAlloc;_cursorIdAlloc;#Q;constructor(e,t){super(),this.#M=e,this.#$=[],this.#V=!1,this.#b=void 0,this.#W=!1,this.#z=void 0,this.#G=!1,this.#H=new Map,this.#K=new eh,this._streamIdAlloc=new eh,this._cursorIdAlloc=new eh,this.#Q=new eh,this.#M.binaryType="arraybuffer",this.#M.addEventListener("open",()=>this.#J()),this.#M.addEventListener("close",e=>this.#Y(e)),this.#M.addEventListener("error",e=>this.#Z(e)),this.#M.addEventListener("message",e=>this.#X(e)),this.#ee({type:"hello",jwt:t})}#ee(e){if(void 0!==this.#b)throw new H("Trying to send a message on a closed client");if(this.#V)this.#et(e);else{let t=()=>this.#et(e);this.#$.push({openCallback:t,errorCallback:()=>void 0})}}#J(){let e=this.#M.protocol;if(void 0===e)return void this.#U(new F("The `WebSocket.protocol` property is undefined. This most likely means that the WebSocket implementation provided by the environment is broken. If you are using Miniflare 2, please update to Miniflare 3, which fixes this problem."));if(""===e)this.#z={version:1,encoding:"json"};else if(this.#z=tF.get(e),void 0===this.#z)return void this.#U(new j(`Unrecognized WebSocket subprotocol: ${JSON.stringify(e)}`));for(let e of this.#$)e.openCallback();this.#$.length=0,this.#V=!0}#et(e){let t=this.#z.encoding;if("json"===t){let t=ei(e,eW);this.#M.send(t)}else if("protobuf"===t){let t=el(e,e0);this.#M.send(t)}else throw ec(t,"Impossible encoding")}getVersion(){return new Promise((e,t)=>{if(this.#G=!0,void 0!==this.#b)t(this.#b);else if(this.#V)e(this.#z.version);else{let s=()=>e(this.#z.version);this.#$.push({openCallback:s,errorCallback:t})}})}_ensureVersion(e,t){if(void 0!==this.#z&&this.#G){if(this.#z.version<e)throw new G(`${t} is supported on protocol version ${e} and higher, but the WebSocket server only supports version ${this.#z.version}`)}else throw new G(`${t} is supported only on protocol version ${e} and higher, but the version supported by the WebSocket server is not yet known. Use Client.getVersion() to wait until the version is available.`)}_sendRequest(e,t){if(void 0!==this.#b)return void t.errorCallback(new $("Client is closed",this.#b));let s=this.#K.alloc();this.#H.set(s,{...t,type:e.type}),this.#ee({type:"request",requestId:s,request:e})}#Z(e){let t=e.message;this.#U(new W(t??"WebSocket was closed due to an error"))}#Y(e){let t=`WebSocket was closed with code ${e.code}`;e.reason&&(t+=`: ${e.reason}`),this.#U(new W(t))}#U(e){if(void 0===this.#b){for(let t of(this.#b=e,this.#$))t.errorCallback(e);for(let[t,s]of(this.#$.length=0,this.#H.entries()))s.errorCallback(e),this.#K.free(t);this.#H.clear(),this.#M.close()}}#X(e){if(void 0===this.#b)try{let s,r=this.#z.encoding;if("json"===r){var t;if("string"!=typeof e.data){this.#M.close(3003,"Only text messages are accepted with JSON encoding"),this.#U(new j("Received non-text message from server with JSON encoding"));return}t=JSON.parse(e.data),s=function(e){let t=Q(e.type);if("hello_ok"===t)return{type:"hello_ok"};if("hello_error"===t)return{type:"hello_error",error:to(ee(e.error))};if("response_ok"===t)return{type:"response_ok",requestId:Y(e.request_id),response:function(e){let t=Q(e.type);if("open_stream"===t)return{type:"open_stream"};if("close_stream"===t)return{type:"close_stream"};if("execute"===t)return{type:"execute",result:tn(ee(e.result))};if("batch"===t)return{type:"batch",result:tu(ee(e.result))};if("open_cursor"===t)return{type:"open_cursor"};else if("close_cursor"===t)return{type:"close_cursor"};else if("fetch_cursor"===t)return{type:"fetch_cursor",entries:et(e.entries,tl),done:Z(e.done)};else if("sequence"===t)return{type:"sequence"};else if("describe"===t)return{type:"describe",result:th(ee(e.result))};else if("store_sql"===t)return{type:"store_sql"};else if("close_sql"===t)return{type:"close_sql"};else if("get_autocommit"===t)return{type:"get_autocommit",isAutocommit:Z(e.is_autocommit)};else throw new j("Unexpected type of Response")}(ee(e.response))};if("response_error"===t)return{type:"response_error",requestId:Y(e.request_id),error:to(ee(e.error))};throw new j("Unexpected type of ServerMsg")}(ee(t))}else if("protobuf"===r){if(!(e.data instanceof ArrayBuffer)){this.#M.close(3003,"Only binary messages are accepted with Protobuf encoding"),this.#U(new j("Received non-binary message from server with Protobuf encoding"));return}s=ea(new Uint8Array(e.data),tR)}else throw ec(r,"Impossible encoding");this.#es(s)}catch(e){this.#M.close(3007,"Could not handle message"),this.#U(e)}}#es(e){if("none"===e.type)throw new j("Received an unrecognized ServerMsg");if("hello_ok"===e.type||"hello_error"===e.type){if(this.#W)throw new j("Received a duplicated hello response");if(this.#W=!0,"hello_error"===e.type)throw ev(e.error);return}if(!this.#W)throw new j("Received a non-hello message before a hello response");if("response_ok"===e.type){let t=e.requestId,s=this.#H.get(t);if(this.#H.delete(t),void 0===s)throw new j("Received unexpected OK response");this.#K.free(t);try{if(s.type!==e.response.type)throw console.dir({responseState:s,msg:e}),new j("Received unexpected type of response");s.responseCallback(e.response)}catch(e){throw s.errorCallback(e),e}}else if("response_error"===e.type){let t=e.requestId,s=this.#H.get(t);if(this.#H.delete(t),void 0===s)throw new j("Received unexpected error response");this.#K.free(t),s.errorCallback(ev(e.error))}else throw ec(e,"Impossible ServerMsg type")}openStream(){return eU.open(this)}storeSql(e){this._ensureVersion(2,"storeSql()");let t=this.#Q.alloc(),s=new eS(this,t);return this._sendRequest({type:"store_sql",sqlId:t,sql:e},{responseCallback:()=>void 0,errorCallback:e=>s._setClosed(e)}),s}_closeSql(e){if(void 0!==this.#b)return;let t=()=>this.#Q.free(e),s=e=>this.#U(e);this._sendRequest({type:"close_sql",sqlId:e},{responseCallback:t,errorCallback:s})}close(){this.#U(new F("Client was manually closed"))}get closed(){return void 0!==this.#b}}var tM=e.i(10671);if("u">typeof queueMicrotask)t=queueMicrotask;else{let e=Promise.resolve();t=t=>{e.then(t)}}class t${#r;#er;#ei;constructor(e){this.#r=new Uint8Array(new ArrayBuffer(e)),this.#er=0,this.#ei=0}get length(){return this.#ei-this.#er}data(){return this.#r.slice(this.#er,this.#ei)}push(e){this.#eo(e.byteLength),this.#r.set(e,this.#ei),this.#ei+=e.byteLength}#eo(e){if(this.#ei+e<=this.#r.byteLength)return;let t=this.#ei-this.#er;if(t+e<=this.#r.byteLength&&2*this.#ei>=this.#r.byteLength)this.#r.copyWithin(0,this.#er,this.#ei);else{let s=this.#r.byteLength;do s*=2;while(t+e>s)let r=new Uint8Array(new ArrayBuffer(s));r.set(this.#r.slice(this.#er,this.#ei),0),this.#r=r}this.#ei=t,this.#er=0}shift(e){this.#er+=e}}function tV(e){let t=Q(e.type);if("ok"===t)return{type:"ok",response:function(e){let t=Q(e.type);if("close"===t)return{type:"close"};if("execute"===t)return{type:"execute",result:tn(ee(e.result))};if("batch"===t)return{type:"batch",result:tu(ee(e.result))};if("sequence"===t)return{type:"sequence"};if("describe"===t)return{type:"describe",result:th(ee(e.result))};else if("store_sql"===t)return{type:"store_sql"};else if("close_sql"===t)return{type:"close_sql"};else if("get_autocommit"===t)return{type:"get_autocommit",isAutocommit:Z(e.is_autocommit)};else throw new j("Unexpected type of StreamResponse")}(ee(e.response))};if("error"===t)return{type:"error",error:to(ee(e.error))};throw new j("Unexpected type of StreamResult")}function tW(e){return{baton:J(e.baton),baseUrl:J(e.base_url)}}let tz={default:()=>({baton:void 0,baseUrl:void 0,results:[]}),1(e,t){t.baton=e.string()},2(e,t){t.baseUrl=e.string()},3(e,t){t.results.push(e.message(tG))}},tG={default:()=>({type:"none"}),1:e=>({type:"ok",response:e.message(tH)}),2:e=>({type:"error",error:e.message(tp)})},tH={default:()=>({type:"none"}),1:e=>({type:"close"}),2:e=>e.message(tK),3:e=>e.message(tQ),4:e=>({type:"sequence"}),5:e=>e.message(tJ),6:e=>({type:"store_sql"}),7:e=>({type:"close_sql"}),8:e=>e.message(tY)},tK={default:()=>({type:"execute",result:tm.default()}),1(e,t){t.result=e.message(tm)}},tQ={default:()=>({type:"batch",result:tb.default()}),1(e,t){t.result=e.message(tb)}},tJ={default:()=>({type:"describe",result:tx.default()}),1(e,t){t.result=e.message(tx)}},tY={default:()=>({type:"get_autocommit",isAutocommit:!1}),1(e,t){t.isAutocommit=e.bool()}},tZ={default:()=>({baton:void 0,baseUrl:void 0}),1(e,t){t.baton=e.string()},2(e,t){t.baseUrl=e.string()}};class tX extends eP{#T;#en;#n;#D;#b;#O;constructor(e,t){super(),this.#T=e,this.#en=t,this.#n=void 0,this.#D=new t$(16384),this.#b=void 0,this.#O=!1}async open(e){if(null===e.body)throw new j("No response body for cursor request");this.#n=e.body[Symbol.asyncIterator]();let t=await this.#ea(tW,tZ);if(void 0===t)throw new j("Empty response to cursor request");return t}next(){return this.#ea(tl,tv)}close(){this._setClosed(new F("Cursor was manually closed"))}_setClosed(e){void 0===this.#b&&(this.#b=e,this.#T._cursorClosed(this),void 0!==this.#n&&this.#n.return())}get closed(){return void 0!==this.#b}async #ea(e,t){for(;;){if(this.#O)return;if(void 0!==this.#b)throw new $("Cursor is closed",this.#b);if("json"===this.#en){let t=this.#eu();if(void 0!==t)return e(ee(JSON.parse(new TextDecoder().decode(t))))}else if("protobuf"===this.#en){let e=this.#el();if(void 0!==e)return ea(e,t)}else throw ec(this.#en,"Impossible encoding");if(void 0===this.#n)throw new H("Attempted to read from HTTP cursor before it was opened");let{value:s,done:r}=await this.#n.next();if(r&&0===this.#D.length)this.#O=!0;else if(r)throw new j("Unexpected end of cursor stream");else this.#D.push(s)}}#eu(){let e=this.#D.data(),t=e.indexOf(10);if(t<0)return;let s=e.slice(0,t);return this.#D.shift(t+1),s}#el(){let e=this.#D.data(),t=0,s=0;for(;;){if(s>=e.byteLength)return;let r=e[s];if(t|=(127&r)<<7*s,s+=1,!(128&r))break}if(e.byteLength<s+t)return;let r=e.slice(s,s+t);return this.#D.shift(s+t),r}}function t0(e,t){void 0!==t.baton&&e.string("baton",t.baton),e.arrayObjects("requests",t.requests,t1)}function t1(e,t){if(e.stringRaw("type",t.type),"close"===t.type);else if("execute"===t.type)e.object("stmt",t.stmt,eB);else if("batch"===t.type)e.object("batch",t.batch,ej);else if("sequence"===t.type)void 0!==t.sql&&e.string("sql",t.sql),void 0!==t.sqlId&&e.number("sql_id",t.sqlId);else if("describe"===t.type)void 0!==t.sql&&e.string("sql",t.sql),void 0!==t.sqlId&&e.number("sql_id",t.sqlId);else if("store_sql"===t.type)e.number("sql_id",t.sqlId),e.string("sql",t.sql);else if("close_sql"===t.type)e.number("sql_id",t.sqlId);else if("get_autocommit"===t.type);else throw ec(t,"Impossible type of StreamRequest")}function t2(e,t){void 0!==t.baton&&e.string("baton",t.baton),e.object("batch",t.batch,ej)}function t3(e,t){for(let s of(void 0!==t.baton&&e.string(1,t.baton),t.requests))e.message(2,s,t4)}function t4(e,t){if("close"===t.type)e.message(1,t,t8);else if("execute"===t.type)e.message(2,t,t6);else if("batch"===t.type)e.message(3,t,t5);else if("sequence"===t.type)e.message(4,t,t7);else if("describe"===t.type)e.message(5,t,t9);else if("store_sql"===t.type)e.message(6,t,se);else if("close_sql"===t.type)e.message(7,t,st);else if("get_autocommit"===t.type)e.message(8,t,ss);else throw ec(t,"Impossible type of StreamRequest")}function t8(e,t){}function t6(e,t){e.message(1,t.stmt,eG)}function t5(e,t){e.message(1,t.batch,eK)}function t7(e,t){void 0!==t.sql&&e.string(1,t.sql),void 0!==t.sqlId&&e.int32(2,t.sqlId)}function t9(e,t){void 0!==t.sql&&e.string(1,t.sql),void 0!==t.sqlId&&e.int32(2,t.sqlId)}function se(e,t){e.int32(1,t.sqlId),e.string(2,t.sql)}function st(e,t){e.int32(1,t.sqlId)}function ss(e,t){}function sr(e,t){void 0!==t.baton&&e.string(1,t.baton),e.message(2,t.batch,eK)}class si extends eD{#A;#eh;#ec;#I;#ed;#ef;#D;#ep;#P;#N;#em;#b;#Q;constructor(e,t,s,r,i){super(e.intMode),this.#A=e,this.#eh=t.toString(),this.#ec=s,this.#I=r,this.#ed=i,this.#ef=void 0,this.#D=new eC,this.#ep=!1,this.#N=!1,this.#em=!1,this.#b=void 0,this.#Q=new eh}client(){return this.#A}_sqlOwner(){return this}storeSql(e){let t=this.#Q.alloc();return this.#B({type:"store_sql",sqlId:t,sql:e}).then(()=>void 0,e=>this._setClosed(e)),new eS(this,t)}_closeSql(e){void 0===this.#b&&this.#B({type:"close_sql",sqlId:e}).then(()=>this.#Q.free(e),e=>this._setClosed(e))}_execute(e){return this.#B({type:"execute",stmt:e}).then(e=>e.result)}_batch(e){return this.#B({type:"batch",batch:e}).then(e=>e.result)}_describe(e){return this.#B({type:"describe",sql:e.sql,sqlId:e.sqlId}).then(e=>e.result)}_sequence(e){return this.#B({type:"sequence",sql:e.sql,sqlId:e.sqlId}).then(e=>{})}getAutocommit(){return this.#A._ensureVersion(3,"getAutocommit()"),this.#B({type:"get_autocommit"}).then(e=>e.isAutocommit)}#B(e){return new Promise((t,s)=>{this.#F({type:"pipeline",request:e,responseCallback:t,errorCallback:s})})}_openCursor(e){return new Promise((t,s)=>{this.#F({type:"cursor",batch:e,cursorCallback:t,errorCallback:s})})}_cursorClosed(e){if(e!==this.#P)throw new H("Cursor was closed, but it was not associated with the stream");this.#P=void 0,t(()=>this.#j())}close(){this._setClosed(new F("Stream was manually closed"))}closeGracefully(){this.#N=!0,t(()=>this.#j())}get closed(){return void 0!==this.#b||this.#N}_setClosed(e){if(void 0===this.#b){for(this.#b=e,void 0!==this.#P&&this.#P._setClosed(e),this.#A._streamClosed(this);;){let t=this.#D.shift();if(void 0!==t)t.errorCallback(e);else break}(void 0!==this.#ef||this.#ep)&&!this.#em&&(this.#D.push({type:"pipeline",request:{type:"close"},responseCallback:()=>void 0,errorCallback:()=>void 0}),this.#em=!0,t(()=>this.#j()))}}#F(e){if(void 0!==this.#b)throw new $("Stream is closed",this.#b);if(this.#N)throw new $("Stream is closing",void 0);this.#D.push(e),t(()=>this.#j())}#j(){if(this.#ep||void 0!==this.#P)return;if(this.#N&&0===this.#D.length)return void this._setClosed(new F("Stream was gracefully closed"));let e=this.#A._endpoint;if(void 0===e)return void this.#A._endpointPromise.then(()=>this.#j(),e=>this._setClosed(e));let t=this.#D.shift();if(void 0!==t)if("pipeline"===t.type){let s=[t];for(;;){let e=this.#D.first();if(void 0!==e&&"pipeline"===e.type)s.push(e),this.#D.shift();else if(void 0===e&&this.#N&&!this.#em){s.push({type:"pipeline",request:{type:"close"},responseCallback:()=>void 0,errorCallback:()=>void 0}),this.#em=!0;break}else break}this.#ey(e,s)}else if("cursor"===t.type)this.#eg(e,t);else throw ec(t,"Impossible type of QueueEntry")}#ey(e,t){this.#eb(()=>this.#e_(t,e),t=>so(t,e.encoding),e=>e.baton,e=>e.baseUrl,e=>(function(e,t){if(t.results.length!==e.length)throw new j("Server returned unexpected number of pipeline results");for(let s=0;s<e.length;++s){let r=t.results[s],i=e[s];if("ok"===r.type){if(r.response.type!==i.request.type)throw new j("Received unexpected type of response");i.responseCallback(r.response)}else if("error"===r.type)i.errorCallback(ev(r.error));else if("none"===r.type)throw new j("Received unrecognized type of StreamResult");else throw ec(r,"Received impossible type of StreamResult")}})(t,e),e=>t.forEach(t=>t.errorCallback(e)))}#eg(e,t){let s=new tX(this,e.encoding);this.#P=s,this.#eb(()=>this.#ew(t,e),e=>s.open(e),e=>e.baton,e=>e.baseUrl,e=>t.cursorCallback(s),e=>t.errorCallback(e))}#eb(e,t,s,r,i,o){let n;try{let t=e();n=(0,this.#I)(t)}catch(e){n=Promise.reject(e)}this.#ep=!0,n.then(e=>e.ok?t(e):sn(e).then(e=>{throw e})).then(e=>{this.#ef=s(e),this.#eh=r(e)??this.#eh,i(e)}).catch(e=>{this._setClosed(e),o(e)}).finally(()=>{this.#ep=!1,this.#j()})}#e_(e,t){return this.#ev(new URL(t.pipelinePath,this.#eh),{baton:this.#ef,requests:e.map(e=>e.request)},t.encoding,t0,t3)}#ew(e,t){if(void 0===t.cursorPath)throw new G(`Cursors are supported only on protocol version 3 and higher, but the HTTP server only supports version ${t.version}.`);return this.#ev(new URL(t.cursorPath,this.#eh),{baton:this.#ef,batch:e.batch},t.encoding,t2,sr)}#ev(e,t,s,r,i){let o,n;if("json"===s)o=ei(t,r),n="application/json";else if("protobuf"===s)o=el(t,i),n="application/x-protobuf";else throw ec(s,"Impossible encoding");let a=new tM.Headers;return a.set("content-type",n),void 0!==this.#ec&&a.set("authorization",`Bearer ${this.#ec}`),void 0!==this.#ed&&a.set("x-turso-encryption-key",this.#ed),new tM.Request(e.toString(),{method:"POST",headers:a,body:o})}}async function so(e,t){if("json"===t){var s;return{baton:J((s=ee(await e.json())).baton),baseUrl:J(s.base_url),results:et(s.results,tV)}}if("protobuf"===t)return ea(new Uint8Array(await e.arrayBuffer()),tz);throw await e.body?.cancel(),ec(t,"Impossible encoding")}async function sn(e){let t=e.headers.get("content-type")??"text/plain",s=`Server returned HTTP status ${e.status}`;if("application/json"===t){let t=await e.json();return"message"in t?ev(t):new z(s,e.status)}if("text/plain"===t){let t=(await e.text()).trim();return""!==t&&(s+=`: ${t}`),new z(s,e.status)}return await e.body?.cancel(),new z(s,e.status)}let sa=[{versionPath:"v3-protobuf",pipelinePath:"v3-protobuf/pipeline",cursorPath:"v3-protobuf/cursor",version:3,encoding:"protobuf"}],su={versionPath:"v2",pipelinePath:"v2/pipeline",cursorPath:void 0,version:2,encoding:"json"};class sl extends B{#eS;#ec;#I;#ed;#b;#eE;_endpointPromise;_endpoint;constructor(e,t,s,r,i=2){super(),this.#eS=e,this.#ec=t,this.#I=s??tM.fetch,this.#ed=r,this.#b=void 0,this.#eE=new Set,3==i?(this._endpointPromise=sh(this.#I,this.#eS),this._endpointPromise.then(e=>this._endpoint=e,e=>this.#U(e))):(this._endpointPromise=Promise.resolve(su),this._endpointPromise.then(e=>this._endpoint=e,e=>this.#U(e)))}async getVersion(){return void 0!==this._endpoint?this._endpoint.version:(await this._endpointPromise).version}_ensureVersion(e,t){if(!(e<=su.version)){if(void 0===this._endpoint)throw new G(`${t} is supported only on protocol version ${e} and higher, but the version supported by the HTTP server is not yet known. Use Client.getVersion() to wait until the version is available.`);if(this._endpoint.version<e)throw new G(`${t} is supported only on protocol version ${e} and higher, but the HTTP server only supports version ${this._endpoint.version}.`)}}openStream(){if(void 0!==this.#b)throw new $("Client is closed",this.#b);let e=new si(this,this.#eS,this.#ec,this.#I,this.#ed);return this.#eE.add(e),e}_streamClosed(e){this.#eE.delete(e)}close(){this.#U(new F("Client was manually closed"))}get closed(){return void 0!==this.#b}#U(e){if(void 0===this.#b)for(let t of(this.#b=e,Array.from(this.#eE)))t._setClosed(new $("Client was closed",e))}}async function sh(e,t){for(let s of sa){let r=new URL(s.versionPath,t),i=new tM.Request(r.toString(),{method:"GET"}),o=await e(i);if(await o.arrayBuffer(),o.ok)return s}return su}function sc(e,t,s=2){if(void 0===U.default)throw new V("WebSockets are not supported in this environment");var r=void 0;return r=3==s?Array.from(tF.keys()):Array.from(tB.keys()),new tj(new U.default(e,r),t)}function sd(e,t,s,r,i=2){return new sl(e instanceof URL?e:new URL(e),t,s,r,i)}class sf{#eC;#ex;#eA;constructor(e,t){this.#eC=e,this.#ex=t,this.#eA=void 0}execute(e){return this.batch([e]).then(e=>e[0])}async batch(e){let t=this._getStream();if(t.closed)throw new r("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{let s,o=e.map(sm);if(void 0===this.#eA){this._getSqlCache().apply(o);let e=t.batch(this.#ex>=3),r=e.step(),i=r.run(I(this.#eC)),n=r;s=o.map(t=>{let s=e.step().condition(eq.ok(n));this.#ex>=3&&s.condition(eq.not(eq.isAutocommit(e)));let r=s.query(t);return r.catch(()=>void 0),n=s,r}),this.#eA=e.execute().then(()=>i).then(()=>void 0);try{await this.#eA}catch(e){throw this.close(),e}}else{let e;this.#ex<3&&await this.#eA,this._getSqlCache().apply(o);let r=t.batch(this.#ex>=3);s=o.map(t=>{let s=r.step();void 0!==e&&s.condition(eq.ok(e)),this.#ex>=3&&s.condition(eq.not(eq.isAutocommit(r)));let i=s.query(t);return i.catch(()=>void 0),e=s,i}),await r.execute()}let n=[];for(let e=0;e<s.length;e++)try{let t=await s[e];if(void 0===t)throw new i("Statement in a transaction was not executed, probably because the transaction has been rolled back",e,"TRANSACTION_CLOSED");n.push(sy(t))}catch(s){if(s instanceof i)throw s;let t=sg(s);if(t instanceof r)throw new i(t.message,e,t.code,t.extendedCode,t.rawCode,t.cause instanceof Error?t.cause:void 0);throw t}return n}catch(e){throw sg(e)}}async executeMultiple(e){let t=this._getStream();if(t.closed)throw new r("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{if(void 0===this.#eA){this.#eA=t.run(I(this.#eC)).then(()=>void 0);try{await this.#eA}catch(e){throw this.close(),e}}else await this.#eA;await t.sequence(e)}catch(e){throw sg(e)}}async rollback(){try{let e=this._getStream();if(e.closed||void 0===this.#eA)return;let t=e.run("ROLLBACK").catch(e=>{throw sg(e)});e.closeGracefully(),await t}catch(e){throw sg(e)}finally{this.close()}}async commit(){try{let e=this._getStream();if(e.closed)throw new r("Cannot commit the transaction because it is already closed","TRANSACTION_CLOSED");if(void 0===this.#eA)return;await this.#eA;let t=e.run("COMMIT").catch(e=>{throw sg(e)});e.closeGracefully(),await t}catch(e){throw sg(e)}finally{this.close()}}}async function sp(e,t,s,o,n=!1){n&&s.step().run("PRAGMA foreign_keys=off");let a=s.step(),u=a.run(I(e)),l=a,h=o.map(e=>{let r=s.step().condition(eq.ok(l));t>=3&&r.condition(eq.not(eq.isAutocommit(s)));let i=r.query(e);return l=r,i}),c=s.step().condition(eq.ok(l));t>=3&&c.condition(eq.not(eq.isAutocommit(s)));let d=c.run("COMMIT");s.step().condition(eq.not(eq.ok(c))).run("ROLLBACK").catch(e=>void 0),n&&s.step().run("PRAGMA foreign_keys=on"),await s.execute();let f=[];await u;for(let e=0;e<h.length;e++)try{let t=await h[e];if(void 0===t)throw new i("Statement in a batch was not executed, probably because the transaction has been rolled back",e,"TRANSACTION_CLOSED");f.push(sy(t))}catch(s){if(s instanceof i)throw s;let t=sg(s);if(t instanceof r)throw new i(t.message,e,t.code,t.extendedCode,t.rawCode,t.cause instanceof Error?t.cause:void 0);throw t}return await d,f}function sm(e){let t,s;Array.isArray(e)?[t,s]=e:"string"==typeof e?t=e:(t=e.sql,s=e.args);let r=new ex(t);if(s)if(Array.isArray(s))r.bindIndexes(s);else for(let[e,t]of Object.entries(s))r.bindName(e,t);return r}function sy(e){return new L(e.columnNames.map(e=>e??""),e.columnDecltypes.map(e=>e??""),e.rows,e.affectedRowCount,void 0!==e.lastInsertRowid?e.lastInsertRowid:void 0)}function sg(e){if(e instanceof F){let t=function e(t){if(t instanceof M&&void 0!==t.code)return t.code;if(t instanceof j)return"HRANA_PROTO_ERROR";if(t instanceof $)return t.cause instanceof F?e(t.cause):"HRANA_CLOSED_ERROR";if(t instanceof W)return"HRANA_WEBSOCKET_ERROR";if(t instanceof z)return"SERVER_ERROR";else if(t instanceof G)return"PROTOCOL_VERSION_ERROR";else if(t instanceof H)return"INTERNAL_ERROR";else return"UNKNOWN"}(e);return new r(e.message,t,void 0,void 0,e)}return e}class sb{#y;#eT;capacity;constructor(e,t){this.#y=e,this.#eT=new s_,this.capacity=t}apply(e){if(this.capacity<=0)return;let t=new Set;for(let s of e){if("string"!=typeof s.sql)continue;let e=s.sql;if(e.length>=5e3)continue;let r=this.#eT.get(e);if(void 0===r){for(;this.#eT.size+1>this.capacity;){let[e,s]=this.#eT.peekLru();if(t.has(s))break;s.close(),this.#eT.delete(e)}this.#eT.size+1<=this.capacity&&(r=this.#y.storeSql(e),this.#eT.set(e,r))}void 0!==r&&(s.sql=r,t.add(r))}}}class s_{#ek;constructor(){this.#ek=new Map}get(e){let t=this.#ek.get(e);return void 0!==t&&(this.#ek.delete(e),this.#ek.set(e,t)),t}set(e,t){this.#ek.set(e,t)}peekLru(){for(let e of this.#ek.entries())return e}delete(e){this.#ek.delete(e)}get size(){return this.#ek.size}}var sw=e.i(74270);class sv{#eS;#eR;#eq;#eO;#eI;closed;protocol;#eL;#eD;constructor(e,t,s,r,i){this.#eS=t,this.#eR=s,this.#eq=r,this.#eO=this.#eP(e),this.#eI=void 0,this.closed=!1,this.protocol="ws",this.#eD=(0,sw.default)(i)}async limit(e){return this.#eD(e)}async execute(e,t){let s;return s="string"==typeof e?{sql:e,args:t||[]}:e,this.limit(async()=>{let e=await this.#eN();try{let t=sm(s);e.conn.sqlCache.apply([t]);let r=e.stream.query(t);e.stream.closeGracefully();let i=await r;return sy(i)}catch(e){throw sg(e)}finally{this._closeStream(e)}})}async batch(e,t="deferred"){return this.limit(async()=>{let s=await this.#eN();try{let r=e.map(e=>Array.isArray(e)?{sql:e[0],args:e[1]||[]}:e).map(sm),i=await s.conn.client.getVersion();s.conn.sqlCache.apply(r);let o=s.stream.batch(i>=3),n=sp(t,i,o,r);return await n}catch(e){throw sg(e)}finally{this._closeStream(s)}})}async migrate(e){return this.limit(async()=>{let t=await this.#eN();try{let s=e.map(sm),r=await t.conn.client.getVersion(),i=t.stream.batch(r>=3),o=sp("deferred",r,i,s,!0);return await o}catch(e){throw sg(e)}finally{this._closeStream(t)}})}async transaction(e="write"){return this.limit(async()=>{let t=await this.#eN();try{let s=await t.conn.client.getVersion();return new sS(this,t,e,s)}catch(e){throw this._closeStream(t),sg(e)}})}async executeMultiple(e){return this.limit(async()=>{let t=await this.#eN();try{let s=t.stream.sequence(e);t.stream.closeGracefully(),await s}catch(e){throw sg(e)}finally{this._closeStream(t)}})}sync(){throw new r("sync not supported in ws mode","SYNC_NOT_SUPPORTED")}async #eN(){if(this.closed)throw new r("The client is closed","CLIENT_CLOSED");if(new Date().valueOf()-this.#eO.openTime.valueOf()>6e4&&void 0===this.#eI){let e=this.#eP();this.#eI=e,e.client.getVersion().then(t=>{this.#eO!==e&&0===this.#eO.streamStates.size&&this.#eO.client.close(),this.#eO=e,this.#eI=void 0},e=>{this.#eI=void 0})}if(this.#eO.client.closed)try{void 0!==this.#eI?this.#eO=this.#eI:this.#eO=this.#eP()}catch(e){throw sg(e)}let e=this.#eO;try{void 0===e.useSqlCache&&(e.useSqlCache=await e.client.getVersion()>=2,e.useSqlCache&&(e.sqlCache.capacity=100));let t=e.client.openStream();t.intMode=this.#eq;let s={conn:e,stream:t};return e.streamStates.add(s),s}catch(e){throw sg(e)}}#eP(e){try{return{client:e??=sc(this.#eS,this.#eR),useSqlCache:void 0,sqlCache:new sb(e,0),openTime:new Date,streamStates:new Set}}catch(e){throw sg(e)}}async reconnect(){try{for(let e of Array.from(this.#eO.streamStates))try{e.stream.close()}catch{}this.#eO.client.close()}catch{}if(this.#eI){try{this.#eI.client.close()}catch{}this.#eI=void 0}let e=this.#eP(),t=await e.client.getVersion();e.useSqlCache=t>=2,e.useSqlCache&&(e.sqlCache.capacity=100),this.#eO=e,this.closed=!1}_closeStream(e){e.stream.close();let t=e.conn;t.streamStates.delete(e),0===t.streamStates.size&&t!==this.#eO&&t.client.close()}close(){if(this.#eO.client.close(),this.closed=!0,this.#eI){try{this.#eI.client.close()}catch{}this.#eI=void 0}this.closed=!0}}class sS extends sf{#A;#eU;constructor(e,t,s,r){super(s,r),this.#A=e,this.#eU=t}_getStream(){return this.#eU.stream}_getSqlCache(){return this.#eU.conn.sqlCache}close(){this.#A._closeStream(this.#eU)}get closed(){return this.#eU.stream.closed}}class sE{#A;protocol;#eS;#eq;#eB;#eF;#eR;#ed;#eD;constructor(e,t,s,r,i,o){this.#eS=e,this.#eR=t,this.#eq=s,this.#eB=r,this.#eF=i,this.#ed=o,this.#A=sd(this.#eS,this.#eR,this.#eB,o),this.#A.intMode=this.#eq,this.protocol="http",this.#eD=(0,sw.default)(this.#eF)}async limit(e){return this.#eD(e)}async execute(e,t){let s;return s="string"==typeof e?{sql:e,args:t||[]}:e,this.limit(async()=>{try{let e,t=sm(s),r=this.#A.openStream();try{e=r.query(t)}finally{r.closeGracefully()}let i=await e;return sy(i)}catch(e){throw sg(e)}})}async batch(e,t="deferred"){return this.limit(async()=>{try{let s,r=e.map(e=>Array.isArray(e)?{sql:e[0],args:e[1]||[]}:e).map(sm),i=await this.#A.getVersion(),o=this.#A.openStream();try{new sb(o,30).apply(r);let e=o.batch(!1);s=sp(t,i,e,r)}finally{o.closeGracefully()}return await s}catch(e){throw sg(e)}})}async migrate(e){return this.limit(async()=>{try{let t,s=e.map(sm),r=await this.#A.getVersion(),i=this.#A.openStream();try{let e=i.batch(!1);t=sp("deferred",r,e,s,!0)}finally{i.closeGracefully()}return await t}catch(e){throw sg(e)}})}async transaction(e="write"){return this.limit(async()=>{try{let t=await this.#A.getVersion();return new sC(this.#A.openStream(),e,t)}catch(e){throw sg(e)}})}async executeMultiple(e){return this.limit(async()=>{try{let t,s=this.#A.openStream();try{t=s.sequence(e)}finally{s.closeGracefully()}await t}catch(e){throw sg(e)}})}sync(){throw new r("sync not supported in http mode","SYNC_NOT_SUPPORTED")}close(){this.#A.close()}async reconnect(){try{this.closed||this.#A.close()}finally{this.#A=sd(this.#eS,this.#eR,this.#eB,this.#ed),this.#A.intMode=this.#eq}}get closed(){return this.#A.closed}}class sC extends sf{#T;#ej;constructor(e,t,s){super(t,s),this.#T=e,this.#ej=new sb(e,30)}_getStream(){return this.#T}_getSqlCache(){return this.#ej}close(){this.#T.close()}get closed(){return this.#T.closed}}function sx(e){return function(e){if("ws"===e.scheme||"wss"===e.scheme){let t;if("wss"!==e.scheme&&"ws"!==e.scheme)throw new r(`The WebSocket client supports only "libsql:", "wss:" and "ws:" URLs, got ${JSON.stringify(e.scheme+":")}. For more information, please read ${O}`,"URL_SCHEME_NOT_SUPPORTED");if(void 0!==e.encryptionKey)throw new r("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if("ws"===e.scheme&&e.tls)throw new r('A "ws:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");if("wss"===e.scheme&&!e.tls)throw new r('A "wss:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");let s=u(e.scheme,e.authority,e.path);try{t=sc(s,e.authToken)}catch(t){if(t instanceof V){let t="wss"===e.scheme?"https":"http",s=u(t,e.authority,e.path);throw new r(`This environment does not support WebSockets, please switch to the HTTP client by using a "${t}:" URL (${JSON.stringify(s)}). For more information, please read ${O}`,"WEBSOCKETS_NOT_SUPPORTED")}throw sg(t)}return new sv(t,s,e.authToken,e.intMode,e.concurrency)}if("http"===e.scheme||"https"===e.scheme){if("https"!==e.scheme&&"http"!==e.scheme)throw new r(`The HTTP client supports only "libsql:", "https:" and "http:" URLs, got ${JSON.stringify(e.scheme+":")}. For more information, please read ${O}`,"URL_SCHEME_NOT_SUPPORTED");if(void 0!==e.encryptionKey)throw new r("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if("http"===e.scheme&&e.tls)throw new r('A "http:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");if("https"===e.scheme&&!e.tls)throw new r('A "https:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");return new sE(u(e.scheme,e.authority,e.path),e.authToken,e.intMode,e.fetch,e.concurrency,e.remoteEncryptionKey)}throw new r(`The client that uses Web standard APIs supports only "libsql:", "wss:", "ws:", "https:" and "http:" URLs, got ${JSON.stringify(e.scheme+":")}. For more information, please read ${O}`,"URL_SCHEME_NOT_SUPPORTED")}(function(e,t){let s,i;if("object"!=typeof e)throw TypeError(`Expected client configuration as object, got ${typeof e}`);let{url:u,authToken:l,tls:h,intMode:c,concurrency:d}=e;d=Math.max(0,d||20),c??="number";let f=[];u===N&&(u="file::memory:");let p=function(e){let t=o.exec(e);if(null===t)throw new r(`The URL '${e}' is not in a valid format`,"URL_INVALID");let s=t.groups,i=s.scheme,u=void 0!==s.authority?function(e){let t=n.exec(e);if(null===t)throw new r("The authority part of the URL is not in a valid format","URL_INVALID");let s=t.groups,i=a(s.host_br??s.host);return{host:i,port:s.port?parseInt(s.port,10):void 0,userinfo:void 0!==s.username?{username:a(s.username),password:void 0!==s.password?a(s.password):void 0}:void 0}}(s.authority):void 0,l=a(s.path);return{scheme:i,authority:u,path:l,query:void 0!==s.query?function(e){let t=e.split("&"),s=[];for(let e of t){let t,r;if(""===e)continue;let i=e.indexOf("=");i<0?(t=e,r=""):(t=e.substring(0,i),r=e.substring(i+1)),s.push({key:a(t.replaceAll("+"," ")),value:a(r.replaceAll("+"," "))})}return{pairs:s}}(s.query):void 0,fragment:void 0!==s.fragment?a(s.fragment):void 0}}(u),m=p.scheme.toLowerCase(),y="file"===m&&p.path===N&&void 0===p.authority;for(let{key:e,value:t}of(s=y?{cache:{values:["shared","private"],update:(e,t)=>f.push(`${e}=${t}`)}}:{tls:{values:["0","1"],update:(e,t)=>h="1"===t},authToken:{update:(e,t)=>l=t}},p.query?.pairs??[])){if(!Object.hasOwn(s,e))throw new r(`Unsupported URL query parameter ${JSON.stringify(e)}`,"URL_PARAM_NOT_SUPPORTED");let i=s[e];if(void 0!==i.values&&!i.values.includes(t))throw new r(`Unknown value for the "${e}" query argument: ${JSON.stringify(t)}. Supported values are: [${i.values.map(e=>'"'+e+'"').join(", ")}]`,"URL_INVALID");void 0!==i.update&&i?.update(e,t)}let g=0===f.length?"":`?${f.join("&")}`,b=p.path+g;if("libsql"===m)if(!1===h){if(p.authority?.port===void 0)throw new r('A "libsql:" URL with ?tls=0 must specify an explicit port',"URL_INVALID");i=t?"http":"ws"}else i=t?"https":"wss";else i=m;if("http"===i||"ws"===i?h??=!1:h??=!0,"http"!==i&&"ws"!==i&&"https"!==i&&"wss"!==i&&"file"!==i)throw new r(`The client supports only "libsql:", "wss:", "ws:", "https:", "http:" and "file:" URLs, got ${JSON.stringify(p.scheme+":")}. For more information, please read ${O}`,"URL_SCHEME_NOT_SUPPORTED");if("number"!==c&&"bigint"!==c&&"string"!==c)throw TypeError(`Invalid value for intMode, expected "number", "bigint" or "string", got ${JSON.stringify(c)}`);if(void 0!==p.fragment)throw new r(`URL fragments are not supported: ${JSON.stringify("#"+p.fragment)}`,"URL_INVALID");return y?{scheme:"file",tls:!1,path:b,intMode:c,concurrency:d,syncUrl:e.syncUrl,syncInterval:e.syncInterval,readYourWrites:e.readYourWrites,offline:e.offline,fetch:e.fetch,authToken:void 0,encryptionKey:void 0,remoteEncryptionKey:void 0,authority:void 0}:{scheme:i,tls:h,authority:p.authority,path:b,authToken:l,intMode:c,concurrency:d,encryptionKey:e.encryptionKey,remoteEncryptionKey:e.remoteEncryptionKey,syncUrl:e.syncUrl,syncInterval:e.syncInterval,readYourWrites:e.readYourWrites,offline:e.offline,fetch:e.fetch}}(e,!0))}async function sA(e){await e.execute(`
    CREATE TABLE IF NOT EXISTS pages (
      id TEXT PRIMARY KEY,
      recipient_name TEXT NOT NULL,
      sender_email TEXT NOT NULL,
      question TEXT NOT NULL,
      dodge_button TEXT NOT NULL,
      answer TEXT,
      created_at INTEGER NOT NULL,
      answered_at INTEGER
    )
  `),await e.execute(`
    CREATE TABLE IF NOT EXISTS email_subscriptions (
      email TEXT NOT NULL,
      source TEXT NOT NULL,
      subscribed_at INTEGER NOT NULL,
      PRIMARY KEY (email, source)
    )
  `)}let sT={get url(){return`file://${e.P("lib/db.ts")}`}};function sk(e){let t=sT?.env?.[e];if("string"==typeof t&&t.length)return t;let s=globalThis?.process?.env?.[e];if("string"==typeof s&&s.length)return s;let r=globalThis?.[e];if("string"==typeof r&&r.length)return r}function sR(){let e=sk("TURSO_DB_URL")||sk("TURSO_DATABASE_URL"),t=sk("TURSO_DB_AUTH_TOKEN")||sk("TURSO_AUTH_TOKEN");if(!e)throw Error("Missing TURSO_DB_URL (or TURSO_DATABASE_URL) in environment");return{url:e,authToken:t&&t.trim().length?t.trim():void 0}}let sq=null;async function sO(){sq||(sq=(async()=>{let{url:e,authToken:t}=sR(),s={url:e,fetch:globalThis.fetch};t&&(s.authToken=t);let r=sx(s);await sA(r)})().catch(e=>{throw sq=null,e})),await sq}async function sI(){await sO();let{url:e,authToken:t}=sR(),s={url:e,fetch:globalThis.fetch};return t&&(s.authToken=t),sx(s)}function sL(e){let t="number"==typeof e?e:Number(e);return Number.isFinite(t)?t:0}function sD(e){return String(e||"").trim().toLowerCase()}async function sP(e,t,s,r){let i=await sI(),o=function(e=10){let t=globalThis.crypto||globalThis.webcrypto,s="abcdefghijklmnopqrstuvwxyz0123456789";if(t?.getRandomValues){let r=new Uint8Array(e);t.getRandomValues(r);let i="";for(let t=0;t<e;t++)i+=s[r[t]%s.length];return i}let r="";for(let t=0;t<e;t++)r+=s[Math.floor(Math.random()*s.length)];return r}(10),n=Date.now(),a=String(e||"").trim(),u=String(t||"").trim(),l=sD(s),h="no"===r?"no":"yes";return await i.execute({sql:`
      INSERT INTO pages (id, recipient_name, sender_email, question, dodge_button, created_at)
      VALUES (?, ?, ?, ?, ?, ?)
    `,args:[o,u,l,a,h,n]}),{id:o,recipient_name:u,sender_email:l,question:a,dodge_button:h,answer:null,created_at:n,answered_at:null}}async function sN(e){let t=await sI(),s=String(e||"").trim();if(!s)return null;let r=await t.execute({sql:"SELECT * FROM pages WHERE id = ? LIMIT 1",args:[s]}),i=r?.rows?.[0];return i?{id:String(i.id),recipient_name:String(i.recipient_name),sender_email:sD(i.sender_email),question:String(i.question),dodge_button:"no"===i.dodge_button?"no":"yes",answer:"yes"===i.answer||"no"===i.answer?i.answer:null,created_at:sL(i.created_at),answered_at:null==i.answered_at?null:sL(i.answered_at)}:null}async function sU(e,t){let s=await sI(),r=Date.now(),i=String(e||"").trim();if(!i)return!1;let o=await s.execute({sql:"UPDATE pages SET answer = ?, answered_at = ? WHERE id = ?",args:["no"===t?"no":"yes",r,i]}),n=o?.rowsAffected;return"number"==typeof n&&n>0}async function sB(e,t){let s=await sI(),r=Date.now(),i=sD(e),o=String(t||"").trim()||"subscribe";if(!i)return{success:!1};try{return await s.execute({sql:`
        INSERT INTO email_subscriptions (email, source, subscribed_at)
        VALUES (?, ?, ?)
      `,args:[i,o,r]}),{success:!0}}catch(t){let e=(String(t?.message||"")+" "+String(t?.cause?.message||"")+" "+String(t?.code||t?.cause?.code||"")).toLowerCase();if(e.includes("unique constraint")||e.includes("sqlite_constraint")||e.includes("constraint_unique")||e.includes("already exists")||e.includes("constraint failed"))return{success:!1,duplicate:!0};throw t}}async function sF(e){let t=await sI(),s=sD(e);if(!s)return null;let r=await t.execute({sql:"SELECT email, source, subscribed_at FROM email_subscriptions WHERE email = ? LIMIT 1",args:[s]}),i=r?.rows?.[0];return i?{email:sD(i.email),source:String(i.source||""),subscribed_at:sL(i.subscribed_at)}:null}e.s(["createPageInDb",()=>sP,"getPageById",()=>sN,"getSubscriptionByEmail",()=>sF,"saveEmailSubscription",()=>sB,"setAnswerInDb",()=>sU],98686)}];

//# sourceMappingURL=_567d2213._.js.map