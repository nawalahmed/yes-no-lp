module.exports=[77379,(a,b,c)=>{"use strict";let d=["nodebuffer","arraybuffer","fragments"],e="u">typeof Blob;e&&d.push("blob"),b.exports={BINARY_TYPES:d,CLOSE_TIMEOUT:3e4,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:e,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}},65167,(a,b,c)=>{"use strict";let{EMPTY_BUFFER:d}=a.r(77379),e=Buffer[Symbol.species];function f(a,b,c,d,e){for(let f=0;f<e;f++)c[d+f]=a[f]^b[3&f]}function g(a,b){for(let c=0;c<a.length;c++)a[c]^=b[3&c]}function h(a){let b;return(h.readOnly=!0,Buffer.isBuffer(a))?a:(a instanceof ArrayBuffer?b=new e(a):ArrayBuffer.isView(a)?b=new e(a.buffer,a.byteOffset,a.byteLength):(b=Buffer.from(a),h.readOnly=!1),b)}if(b.exports={concat:function(a,b){if(0===a.length)return d;if(1===a.length)return a[0];let c=Buffer.allocUnsafe(b),f=0;for(let b=0;b<a.length;b++){let d=a[b];c.set(d,f),f+=d.length}return f<b?new e(c.buffer,c.byteOffset,f):c},mask:f,toArrayBuffer:function(a){return a.length===a.buffer.byteLength?a.buffer:a.buffer.slice(a.byteOffset,a.byteOffset+a.length)},toBuffer:h,unmask:g},!process.env.WS_NO_BUFFER_UTIL)try{let a=(()=>{let a=Error("Cannot find module 'bufferutil'");throw a.code="MODULE_NOT_FOUND",a})();b.exports.mask=function(b,c,d,e,g){g<48?f(b,c,d,e,g):a.mask(b,c,d,e,g)},b.exports.unmask=function(b,c){b.length<32?g(b,c):a.unmask(b,c)}}catch(a){}},95973,(a,b,c)=>{"use strict";let d=Symbol("kDone"),e=Symbol("kRun");b.exports=class{constructor(a){this[d]=()=>{this.pending--,this[e]()},this.concurrency=a||1/0,this.jobs=[],this.pending=0}add(a){this.jobs.push(a),this[e]()}[e](){if(this.pending!==this.concurrency&&this.jobs.length){let a=this.jobs.shift();this.pending++,a(this[d])}}}},24191,(a,b,c)=>{"use strict";let d,e=a.r(6461),f=a.r(65167),g=a.r(95973),{kStatusCode:h}=a.r(77379),i=Buffer[Symbol.species],j=Buffer.from([0,0,255,255]),k=Symbol("permessage-deflate"),l=Symbol("total-length"),m=Symbol("callback"),n=Symbol("buffers"),o=Symbol("error");function p(a){this[n].push(a),this[l]+=a.length}function q(a){(this[l]+=a.length,this[k]._maxPayload<1||this[l]<=this[k]._maxPayload)?this[n].push(a):(this[o]=RangeError("Max payload size exceeded"),this[o].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[o][h]=1009,this.removeListener("data",q),this.reset())}function r(a){(this[k]._inflate=null,this[o])?this[m](this[o]):(a[h]=1007,this[m](a))}b.exports=class{constructor(a,b,c){this._maxPayload=0|c,this._options=a||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!b,this._deflate=null,this._inflate=null,this.params=null,d||(d=new g(void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10))}static get extensionName(){return"permessage-deflate"}offer(){let a={};return this._options.serverNoContextTakeover&&(a.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(a.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(a.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?a.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(a.client_max_window_bits=!0),a}accept(a){return a=this.normalizeParams(a),this.params=this._isServer?this.acceptAsServer(a):this.acceptAsClient(a),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let a=this._deflate[m];this._deflate.close(),this._deflate=null,a&&a(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(a){let b=this._options,c=a.find(a=>(!1!==b.serverNoContextTakeover||!a.server_no_context_takeover)&&(!a.server_max_window_bits||!1!==b.serverMaxWindowBits&&("number"!=typeof b.serverMaxWindowBits||!(b.serverMaxWindowBits>a.server_max_window_bits)))&&("number"!=typeof b.clientMaxWindowBits||!!a.client_max_window_bits));if(!c)throw Error("None of the extension offers can be accepted");return b.serverNoContextTakeover&&(c.server_no_context_takeover=!0),b.clientNoContextTakeover&&(c.client_no_context_takeover=!0),"number"==typeof b.serverMaxWindowBits&&(c.server_max_window_bits=b.serverMaxWindowBits),"number"==typeof b.clientMaxWindowBits?c.client_max_window_bits=b.clientMaxWindowBits:(!0===c.client_max_window_bits||!1===b.clientMaxWindowBits)&&delete c.client_max_window_bits,c}acceptAsClient(a){let b=a[0];if(!1===this._options.clientNoContextTakeover&&b.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(b.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&b.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(b.client_max_window_bits=this._options.clientMaxWindowBits);return b}normalizeParams(a){return a.forEach(a=>{Object.keys(a).forEach(b=>{let c=a[b];if(c.length>1)throw Error(`Parameter "${b}" must have only a single value`);if(c=c[0],"client_max_window_bits"===b){if(!0!==c){let a=+c;if(!Number.isInteger(a)||a<8||a>15)throw TypeError(`Invalid value for parameter "${b}": ${c}`);c=a}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${b}": ${c}`)}else if("server_max_window_bits"===b){let a=+c;if(!Number.isInteger(a)||a<8||a>15)throw TypeError(`Invalid value for parameter "${b}": ${c}`);c=a}else if("client_no_context_takeover"===b||"server_no_context_takeover"===b){if(!0!==c)throw TypeError(`Invalid value for parameter "${b}": ${c}`)}else throw Error(`Unknown parameter "${b}"`);a[b]=c})}),a}decompress(a,b,c){d.add(d=>{this._decompress(a,b,(a,b)=>{d(),c(a,b)})})}compress(a,b,c){d.add(d=>{this._compress(a,b,(a,b)=>{d(),c(a,b)})})}_decompress(a,b,c){let d=this._isServer?"client":"server";if(!this._inflate){let a=`${d}_max_window_bits`,b="number"!=typeof this.params[a]?e.Z_DEFAULT_WINDOWBITS:this.params[a];this._inflate=e.createInflateRaw({...this._options.zlibInflateOptions,windowBits:b}),this._inflate[k]=this,this._inflate[l]=0,this._inflate[n]=[],this._inflate.on("error",r),this._inflate.on("data",q)}this._inflate[m]=c,this._inflate.write(a),b&&this._inflate.write(j),this._inflate.flush(()=>{let a=this._inflate[o];if(a){this._inflate.close(),this._inflate=null,c(a);return}let e=f.concat(this._inflate[n],this._inflate[l]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[l]=0,this._inflate[n]=[],b&&this.params[`${d}_no_context_takeover`]&&this._inflate.reset()),c(null,e)})}_compress(a,b,c){let d=this._isServer?"server":"client";if(!this._deflate){let a=`${d}_max_window_bits`,b="number"!=typeof this.params[a]?e.Z_DEFAULT_WINDOWBITS:this.params[a];this._deflate=e.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:b}),this._deflate[l]=0,this._deflate[n]=[],this._deflate.on("data",p)}this._deflate[m]=c,this._deflate.write(a),this._deflate.flush(e.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let a=f.concat(this._deflate[n],this._deflate[l]);b&&(a=new i(a.buffer,a.byteOffset,a.length-4)),this._deflate[m]=null,this._deflate[l]=0,this._deflate[n]=[],b&&this.params[`${d}_no_context_takeover`]&&this._deflate.reset(),c(null,a)})}}},50308,(a,b,c)=>{"use strict";let{isUtf8:d}=a.r(874),{hasBlob:e}=a.r(77379);function f(a){let b=a.length,c=0;for(;c<b;)if((128&a[c])==0)c++;else if((224&a[c])==192){if(c+1===b||(192&a[c+1])!=128||(254&a[c])==192)return!1;c+=2}else if((240&a[c])==224){if(c+2>=b||(192&a[c+1])!=128||(192&a[c+2])!=128||224===a[c]&&(224&a[c+1])==128||237===a[c]&&(224&a[c+1])==160)return!1;c+=3}else{if((248&a[c])!=240||c+3>=b||(192&a[c+1])!=128||(192&a[c+2])!=128||(192&a[c+3])!=128||240===a[c]&&(240&a[c+1])==128||244===a[c]&&a[c+1]>143||a[c]>244)return!1;c+=4}return!0}if(b.exports={isBlob:function(a){return e&&"object"==typeof a&&"function"==typeof a.arrayBuffer&&"string"==typeof a.type&&"function"==typeof a.stream&&("Blob"===a[Symbol.toStringTag]||"File"===a[Symbol.toStringTag])},isValidStatusCode:function(a){return a>=1e3&&a<=1014&&1004!==a&&1005!==a&&1006!==a||a>=3e3&&a<=4999},isValidUTF8:f,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},d)b.exports.isValidUTF8=function(a){return a.length<24?f(a):d(a)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let a=(()=>{let a=Error("Cannot find module 'utf-8-validate'");throw a.code="MODULE_NOT_FOUND",a})();b.exports.isValidUTF8=function(b){return b.length<32?f(b):a(b)}}catch(a){}},23852,(a,b,c)=>{"use strict";let{Writable:d}=a.r(88947),e=a.r(24191),{BINARY_TYPES:f,EMPTY_BUFFER:g,kStatusCode:h,kWebSocket:i}=a.r(77379),{concat:j,toArrayBuffer:k,unmask:l}=a.r(65167),{isValidStatusCode:m,isValidUTF8:n}=a.r(50308),o=Buffer[Symbol.species];b.exports=class extends d{constructor(a={}){super(),this._allowSynchronousEvents=void 0===a.allowSynchronousEvents||a.allowSynchronousEvents,this._binaryType=a.binaryType||f[0],this._extensions=a.extensions||{},this._isServer=!!a.isServer,this._maxPayload=0|a.maxPayload,this._skipUTF8Validation=!!a.skipUTF8Validation,this[i]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(a,b,c){if(8===this._opcode&&0==this._state)return c();this._bufferedBytes+=a.length,this._buffers.push(a),this.startLoop(c)}consume(a){if(this._bufferedBytes-=a,a===this._buffers[0].length)return this._buffers.shift();if(a<this._buffers[0].length){let b=this._buffers[0];return this._buffers[0]=new o(b.buffer,b.byteOffset+a,b.length-a),new o(b.buffer,b.byteOffset,a)}let b=Buffer.allocUnsafe(a);do{let c=this._buffers[0],d=b.length-a;a>=c.length?b.set(this._buffers.shift(),d):(b.set(new Uint8Array(c.buffer,c.byteOffset,a),d),this._buffers[0]=new o(c.buffer,c.byteOffset+a,c.length-a)),a-=c.length}while(a>0)return b}startLoop(a){this._loop=!0;do switch(this._state){case 0:this.getInfo(a);break;case 1:this.getPayloadLength16(a);break;case 2:this.getPayloadLength64(a);break;case 3:this.getMask();break;case 4:this.getData(a);break;case 5:case 6:this._loop=!1;return}while(this._loop)this._errored||a()}getInfo(a){if(this._bufferedBytes<2){this._loop=!1;return}let b=this.consume(2);if((48&b[0])!=0)return void a(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"));let c=(64&b[0])==64;if(c&&!this._extensions[e.extensionName])return void a(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._fin=(128&b[0])==128,this._opcode=15&b[0],this._payloadLength=127&b[1],0===this._opcode){if(c)return void a(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(!this._fragmented)return void a(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"));this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return void a(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));this._compressed=c}else{if(!(this._opcode>7)||!(this._opcode<11))return void a(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));if(!this._fin)return void a(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"));if(c)return void a(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength)return void a(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"))}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=(128&b[1])==128,this._isServer){if(!this._masked)return void a(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"))}else if(this._masked)return void a(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"));126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(a)}getPayloadLength16(a){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(a)}getPayloadLength64(a){if(this._bufferedBytes<8){this._loop=!1;return}let b=this.consume(8),c=b.readUInt32BE(0);c>2097151?a(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=0x100000000*c+b.readUInt32BE(4),this.haveLength(a))}haveLength(a){this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)?a(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH")):this._masked?this._state=3:this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(a){let b=g;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}b=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!=0&&l(b,this._mask)}if(this._opcode>7)return void this.controlMessage(b,a);if(this._compressed){this._state=5,this.decompress(b,a);return}b.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(b)),this.dataMessage(a)}decompress(a,b){this._extensions[e.extensionName].decompress(a,this._fin,(a,c)=>{if(a)return b(a);if(c.length){if(this._messageLength+=c.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return void b(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(c)}this.dataMessage(b),0===this._state&&this.startLoop(b)})}dataMessage(a){if(!this._fin){this._state=0;return}let b=this._messageLength,c=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let d;d="nodebuffer"===this._binaryType?j(c,b):"arraybuffer"===this._binaryType?k(j(c,b)):"blob"===this._binaryType?new Blob(c):c,this._allowSynchronousEvents?(this.emit("message",d,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",d,!0),this._state=0,this.startLoop(a)}))}else{let d=j(c,b);if(!this._skipUTF8Validation&&!n(d))return void a(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));5===this._state||this._allowSynchronousEvents?(this.emit("message",d,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",d,!1),this._state=0,this.startLoop(a)}))}}controlMessage(a,b){if(8===this._opcode){if(0===a.length)this._loop=!1,this.emit("conclude",1005,g),this.end();else{let c=a.readUInt16BE(0);if(!m(c))return void b(this.createError(RangeError,`invalid status code ${c}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE"));let d=new o(a.buffer,a.byteOffset+2,a.length-2);if(!this._skipUTF8Validation&&!n(d))return void b(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));this._loop=!1,this.emit("conclude",c,d),this.end()}this._state=0;return}this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",a),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",a),this._state=0,this.startLoop(b)}))}createError(a,b,c,d,e){this._loop=!1,this._errored=!0;let f=new a(c?`Invalid WebSocket frame: ${b}`:b);return Error.captureStackTrace(f,this.createError),f.code=e,f[h]=d,f}}},21819,(a,b,c)=>{"use strict";let d,{Duplex:e}=a.r(88947),{randomFillSync:f}=a.r(54799),g=a.r(24191),{EMPTY_BUFFER:h,kWebSocket:i,NOOP:j}=a.r(77379),{isBlob:k,isValidStatusCode:l}=a.r(50308),{mask:m,toBuffer:n}=a.r(65167),o=Symbol("kByteLength"),p=Buffer.alloc(4),q=8192;class r{constructor(a,b,c){this._extensions=b||{},c&&(this._generateMask=c,this._maskBuffer=Buffer.alloc(4)),this._socket=a,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=j,this[i]=void 0}static frame(a,b){let c,e,g=!1,h=2,i=!1;b.mask&&(c=b.maskBuffer||p,b.generateMask?b.generateMask(c):(8192===q&&(void 0===d&&(d=Buffer.alloc(8192)),f(d,0,8192),q=0),c[0]=d[q++],c[1]=d[q++],c[2]=d[q++],c[3]=d[q++]),i=(c[0]|c[1]|c[2]|c[3])==0,h=6),"string"==typeof a?e=(!b.mask||i)&&void 0!==b[o]?b[o]:(a=Buffer.from(a)).length:(e=a.length,g=b.mask&&b.readOnly&&!i);let j=e;e>=65536?(h+=8,j=127):e>125&&(h+=2,j=126);let k=Buffer.allocUnsafe(g?e+h:h);return(k[0]=b.fin?128|b.opcode:b.opcode,b.rsv1&&(k[0]|=64),k[1]=j,126===j?k.writeUInt16BE(e,2):127===j&&(k[2]=k[3]=0,k.writeUIntBE(e,4,6)),b.mask)?(k[1]|=128,k[h-4]=c[0],k[h-3]=c[1],k[h-2]=c[2],k[h-1]=c[3],i)?[k,a]:g?(m(a,c,k,h,e),[k]):(m(a,c,a,0,e),[k,a]):[k,a]}close(a,b,c,d){let e;if(void 0===a)e=h;else if("number"==typeof a&&l(a))if(void 0!==b&&b.length){let c=Buffer.byteLength(b);if(c>123)throw RangeError("The message must not be greater than 123 bytes");(e=Buffer.allocUnsafe(2+c)).writeUInt16BE(a,0),"string"==typeof b?e.write(b,2):e.set(b,2)}else(e=Buffer.allocUnsafe(2)).writeUInt16BE(a,0);else throw TypeError("First argument must be a valid error code number");let f={[o]:e.length,fin:!0,generateMask:this._generateMask,mask:c,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,e,!1,f,d]):this.sendFrame(r.frame(e,f),d)}ping(a,b,c){let d,e;if("string"==typeof a?(d=Buffer.byteLength(a),e=!1):k(a)?(d=a.size,e=!1):(d=(a=n(a)).length,e=n.readOnly),d>125)throw RangeError("The data size must not be greater than 125 bytes");let f={[o]:d,fin:!0,generateMask:this._generateMask,mask:b,maskBuffer:this._maskBuffer,opcode:9,readOnly:e,rsv1:!1};k(a)?0!==this._state?this.enqueue([this.getBlobData,a,!1,f,c]):this.getBlobData(a,!1,f,c):0!==this._state?this.enqueue([this.dispatch,a,!1,f,c]):this.sendFrame(r.frame(a,f),c)}pong(a,b,c){let d,e;if("string"==typeof a?(d=Buffer.byteLength(a),e=!1):k(a)?(d=a.size,e=!1):(d=(a=n(a)).length,e=n.readOnly),d>125)throw RangeError("The data size must not be greater than 125 bytes");let f={[o]:d,fin:!0,generateMask:this._generateMask,mask:b,maskBuffer:this._maskBuffer,opcode:10,readOnly:e,rsv1:!1};k(a)?0!==this._state?this.enqueue([this.getBlobData,a,!1,f,c]):this.getBlobData(a,!1,f,c):0!==this._state?this.enqueue([this.dispatch,a,!1,f,c]):this.sendFrame(r.frame(a,f),c)}send(a,b,c){let d,e,f=this._extensions[g.extensionName],h=b.binary?2:1,i=b.compress;"string"==typeof a?(d=Buffer.byteLength(a),e=!1):k(a)?(d=a.size,e=!1):(d=(a=n(a)).length,e=n.readOnly),this._firstFragment?(this._firstFragment=!1,i&&f&&f.params[f._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(i=d>=f._threshold),this._compress=i):(i=!1,h=0),b.fin&&(this._firstFragment=!0);let j={[o]:d,fin:b.fin,generateMask:this._generateMask,mask:b.mask,maskBuffer:this._maskBuffer,opcode:h,readOnly:e,rsv1:i};k(a)?0!==this._state?this.enqueue([this.getBlobData,a,this._compress,j,c]):this.getBlobData(a,this._compress,j,c):0!==this._state?this.enqueue([this.dispatch,a,this._compress,j,c]):this.dispatch(a,this._compress,j,c)}getBlobData(a,b,c,d){this._bufferedBytes+=c[o],this._state=2,a.arrayBuffer().then(a=>{if(this._socket.destroyed){let a=Error("The socket was closed while the blob was being read");process.nextTick(s,this,a,d);return}this._bufferedBytes-=c[o];let e=n(a);b?this.dispatch(e,b,c,d):(this._state=0,this.sendFrame(r.frame(e,c),d),this.dequeue())}).catch(a=>{process.nextTick(t,this,a,d)})}dispatch(a,b,c,d){if(!b)return void this.sendFrame(r.frame(a,c),d);let e=this._extensions[g.extensionName];this._bufferedBytes+=c[o],this._state=1,e.compress(a,c.fin,(a,b)=>{this._socket.destroyed?s(this,Error("The socket was closed while data was being compressed"),d):(this._bufferedBytes-=c[o],this._state=0,c.readOnly=!1,this.sendFrame(r.frame(b,c),d),this.dequeue())})}dequeue(){for(;0===this._state&&this._queue.length;){let a=this._queue.shift();this._bufferedBytes-=a[3][o],Reflect.apply(a[0],this,a.slice(1))}}enqueue(a){this._bufferedBytes+=a[3][o],this._queue.push(a)}sendFrame(a,b){2===a.length?(this._socket.cork(),this._socket.write(a[0]),this._socket.write(a[1],b),this._socket.uncork()):this._socket.write(a[0],b)}}function s(a,b,c){"function"==typeof c&&c(b);for(let c=0;c<a._queue.length;c++){let d=a._queue[c],e=d[d.length-1];"function"==typeof e&&e(b)}}function t(a,b,c){s(a,b,c),a.onerror(b)}b.exports=r},53447,(a,b,c)=>{"use strict";let{kForOnEventAttribute:d,kListener:e}=a.r(77379),f=Symbol("kCode"),g=Symbol("kData"),h=Symbol("kError"),i=Symbol("kMessage"),j=Symbol("kReason"),k=Symbol("kTarget"),l=Symbol("kType"),m=Symbol("kWasClean");class n{constructor(a){this[k]=null,this[l]=a}get target(){return this[k]}get type(){return this[l]}}Object.defineProperty(n.prototype,"target",{enumerable:!0}),Object.defineProperty(n.prototype,"type",{enumerable:!0});class o extends n{constructor(a,b={}){super(a),this[f]=void 0===b.code?0:b.code,this[j]=void 0===b.reason?"":b.reason,this[m]=void 0!==b.wasClean&&b.wasClean}get code(){return this[f]}get reason(){return this[j]}get wasClean(){return this[m]}}Object.defineProperty(o.prototype,"code",{enumerable:!0}),Object.defineProperty(o.prototype,"reason",{enumerable:!0}),Object.defineProperty(o.prototype,"wasClean",{enumerable:!0});class p extends n{constructor(a,b={}){super(a),this[h]=void 0===b.error?null:b.error,this[i]=void 0===b.message?"":b.message}get error(){return this[h]}get message(){return this[i]}}Object.defineProperty(p.prototype,"error",{enumerable:!0}),Object.defineProperty(p.prototype,"message",{enumerable:!0});class q extends n{constructor(a,b={}){super(a),this[g]=void 0===b.data?null:b.data}get data(){return this[g]}}function r(a,b,c){"object"==typeof a&&a.handleEvent?a.handleEvent.call(a,c):a.call(b,c)}Object.defineProperty(q.prototype,"data",{enumerable:!0}),b.exports={CloseEvent:o,ErrorEvent:p,Event:n,EventTarget:{addEventListener(a,b,c={}){let f;for(let f of this.listeners(a))if(!c[d]&&f[e]===b&&!f[d])return;if("message"===a)f=function(a,c){let d=new q("message",{data:c?a:a.toString()});d[k]=this,r(b,this,d)};else if("close"===a)f=function(a,c){let d=new o("close",{code:a,reason:c.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});d[k]=this,r(b,this,d)};else if("error"===a)f=function(a){let c=new p("error",{error:a,message:a.message});c[k]=this,r(b,this,c)};else{if("open"!==a)return;f=function(){let a=new n("open");a[k]=this,r(b,this,a)}}f[d]=!!c[d],f[e]=b,c.once?this.once(a,f):this.on(a,f)},removeEventListener(a,b){for(let c of this.listeners(a))if(c[e]===b&&!c[d]){this.removeListener(a,c);break}}},MessageEvent:q}},82731,(a,b,c)=>{"use strict";let{tokenChars:d}=a.r(50308);function e(a,b,c){void 0===a[b]?a[b]=[c]:a[b].push(c)}b.exports={format:function(a){return Object.keys(a).map(b=>{let c=a[b];return Array.isArray(c)||(c=[c]),c.map(a=>[b].concat(Object.keys(a).map(b=>{let c=a[b];return Array.isArray(c)||(c=[c]),c.map(a=>!0===a?b:`${b}=${a}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(a){let b,c,f=Object.create(null),g=Object.create(null),h=!1,i=!1,j=!1,k=-1,l=-1,m=-1,n=0;for(;n<a.length;n++)if(l=a.charCodeAt(n),void 0===b)if(-1===m&&1===d[l])-1===k&&(k=n);else if(0!==n&&(32===l||9===l))-1===m&&-1!==k&&(m=n);else if(59===l||44===l){if(-1===k)throw SyntaxError(`Unexpected character at index ${n}`);-1===m&&(m=n);let c=a.slice(k,m);44===l?(e(f,c,g),g=Object.create(null)):b=c,k=m=-1}else throw SyntaxError(`Unexpected character at index ${n}`);else if(void 0===c)if(-1===m&&1===d[l])-1===k&&(k=n);else if(32===l||9===l)-1===m&&-1!==k&&(m=n);else if(59===l||44===l){if(-1===k)throw SyntaxError(`Unexpected character at index ${n}`);-1===m&&(m=n),e(g,a.slice(k,m),!0),44===l&&(e(f,b,g),g=Object.create(null),b=void 0),k=m=-1}else if(61===l&&-1!==k&&-1===m)c=a.slice(k,n),k=m=-1;else throw SyntaxError(`Unexpected character at index ${n}`);else if(i){if(1!==d[l])throw SyntaxError(`Unexpected character at index ${n}`);-1===k?k=n:h||(h=!0),i=!1}else if(j)if(1===d[l])-1===k&&(k=n);else if(34===l&&-1!==k)j=!1,m=n;else if(92===l)i=!0;else throw SyntaxError(`Unexpected character at index ${n}`);else if(34===l&&61===a.charCodeAt(n-1))j=!0;else if(-1===m&&1===d[l])-1===k&&(k=n);else if(-1!==k&&(32===l||9===l))-1===m&&(m=n);else if(59===l||44===l){if(-1===k)throw SyntaxError(`Unexpected character at index ${n}`);-1===m&&(m=n);let d=a.slice(k,m);h&&(d=d.replace(/\\/g,""),h=!1),e(g,c,d),44===l&&(e(f,b,g),g=Object.create(null),b=void 0),c=void 0,k=m=-1}else throw SyntaxError(`Unexpected character at index ${n}`);if(-1===k||j||32===l||9===l)throw SyntaxError("Unexpected end of input");-1===m&&(m=n);let o=a.slice(k,m);return void 0===b?e(f,o,g):(void 0===c?e(g,o,!0):h?e(g,c,o.replace(/\\/g,"")):e(g,c,o),e(f,b,g)),f}}},73253,(a,b,c)=>{"use strict";let d=a.r(27699),e=a.r(24836),f=a.r(21517),g=a.r(4446),h=a.r(55004),{randomBytes:i,createHash:j}=a.r(54799),{Duplex:k,Readable:l}=a.r(88947),{URL:m}=a.r(92509),n=a.r(24191),o=a.r(23852),p=a.r(21819),{isBlob:q}=a.r(50308),{BINARY_TYPES:r,CLOSE_TIMEOUT:s,EMPTY_BUFFER:t,GUID:u,kForOnEventAttribute:v,kListener:w,kStatusCode:x,kWebSocket:y,NOOP:z}=a.r(77379),{EventTarget:{addEventListener:A,removeEventListener:B}}=a.r(53447),{format:C,parse:D}=a.r(82731),{toBuffer:E}=a.r(65167),F=Symbol("kAborted"),G=[8,13],H=["CONNECTING","OPEN","CLOSING","CLOSED"],I=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class J extends d{constructor(a,b,c){super(),this._binaryType=r[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=t,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=J.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==a?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===b?b=[]:Array.isArray(b)||("object"==typeof b&&null!==b?(c=b,b=[]):b=[b]),function a(b,c,d,g){let h,k,l,o,p={allowSynchronousEvents:!0,autoPong:!0,closeTimeout:s,protocolVersion:G[1],maxPayload:0x6400000,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...g,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(b._autoPong=p.autoPong,b._closeTimeout=p.closeTimeout,!G.includes(p.protocolVersion))throw RangeError(`Unsupported protocol version: ${p.protocolVersion} (supported versions: ${G.join(", ")})`);if(c instanceof m)h=c;else try{h=new m(c)}catch(a){throw SyntaxError(`Invalid URL: ${c}`)}"http:"===h.protocol?h.protocol="ws:":"https:"===h.protocol&&(h.protocol="wss:"),b._url=h.href;let q="wss:"===h.protocol,r="ws+unix:"===h.protocol;if("ws:"===h.protocol||q||r?r&&!h.pathname?k="The URL's pathname is empty":h.hash&&(k="The URL contains a fragment identifier"):k='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"',k){let a=SyntaxError(k);if(0!==b._redirects)return void K(b,a);throw a}let t=q?443:80,v=i(16).toString("base64"),w=q?e.request:f.request,x=new Set;if(p.createConnection=p.createConnection||(q?M:L),p.defaultPort=p.defaultPort||t,p.port=h.port||t,p.host=h.hostname.startsWith("[")?h.hostname.slice(1,-1):h.hostname,p.headers={...p.headers,"Sec-WebSocket-Version":p.protocolVersion,"Sec-WebSocket-Key":v,Connection:"Upgrade",Upgrade:"websocket"},p.path=h.pathname+h.search,p.timeout=p.handshakeTimeout,p.perMessageDeflate&&(l=new n(!0!==p.perMessageDeflate?p.perMessageDeflate:{},!1,p.maxPayload),p.headers["Sec-WebSocket-Extensions"]=C({[n.extensionName]:l.offer()})),d.length){for(let a of d){if("string"!=typeof a||!I.test(a)||x.has(a))throw SyntaxError("An invalid or duplicated subprotocol was specified");x.add(a)}p.headers["Sec-WebSocket-Protocol"]=d.join(",")}if(p.origin&&(p.protocolVersion<13?p.headers["Sec-WebSocket-Origin"]=p.origin:p.headers.Origin=p.origin),(h.username||h.password)&&(p.auth=`${h.username}:${h.password}`),r){let a=p.path.split(":");p.socketPath=a[0],p.path=a[1]}if(p.followRedirects){if(0===b._redirects){b._originalIpc=r,b._originalSecure=q,b._originalHostOrSocketPath=r?p.socketPath:h.host;let a=g&&g.headers;if(g={...g,headers:{}},a)for(let[b,c]of Object.entries(a))g.headers[b.toLowerCase()]=c}else if(0===b.listenerCount("redirect")){let a=r?!!b._originalIpc&&p.socketPath===b._originalHostOrSocketPath:!b._originalIpc&&h.host===b._originalHostOrSocketPath;a&&(!b._originalSecure||q)||(delete p.headers.authorization,delete p.headers.cookie,a||delete p.headers.host,p.auth=void 0)}p.auth&&!g.headers.authorization&&(g.headers.authorization="Basic "+Buffer.from(p.auth).toString("base64")),o=b._req=w(p),b._redirects&&b.emit("redirect",b.url,o)}else o=b._req=w(p);p.timeout&&o.on("timeout",()=>{N(b,o,"Opening handshake has timed out")}),o.on("error",a=>{null===o||o[F]||(o=b._req=null,K(b,a))}),o.on("response",e=>{let f=e.headers.location,h=e.statusCode;if(f&&p.followRedirects&&h>=300&&h<400){let e;if(++b._redirects>p.maxRedirects)return void N(b,o,"Maximum redirects exceeded");o.abort();try{e=new m(f,c)}catch(a){K(b,SyntaxError(`Invalid URL: ${f}`));return}a(b,e,d,g)}else b.emit("unexpected-response",o,e)||N(b,o,`Unexpected server response: ${e.statusCode}`)}),o.on("upgrade",(a,c,d)=>{let e;if(b.emit("upgrade",a),b.readyState!==J.CONNECTING)return;o=b._req=null;let f=a.headers.upgrade;if(void 0===f||"websocket"!==f.toLowerCase())return void N(b,c,"Invalid Upgrade header");let g=j("sha1").update(v+u).digest("base64");if(a.headers["sec-websocket-accept"]!==g)return void N(b,c,"Invalid Sec-WebSocket-Accept header");let h=a.headers["sec-websocket-protocol"];if(void 0!==h?x.size?x.has(h)||(e="Server sent an invalid subprotocol"):e="Server sent a subprotocol but none was requested":x.size&&(e="Server sent no subprotocol"),e)return void N(b,c,e);h&&(b._protocol=h);let i=a.headers["sec-websocket-extensions"];if(void 0!==i){let a;if(!l)return void N(b,c,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");try{a=D(i)}catch(a){N(b,c,"Invalid Sec-WebSocket-Extensions header");return}let d=Object.keys(a);if(1!==d.length||d[0]!==n.extensionName)return void N(b,c,"Server indicated an extension that was not requested");try{l.accept(a[n.extensionName])}catch(a){N(b,c,"Invalid Sec-WebSocket-Extensions header");return}b._extensions[n.extensionName]=l}b.setSocket(c,d,{allowSynchronousEvents:p.allowSynchronousEvents,generateMask:p.generateMask,maxPayload:p.maxPayload,skipUTF8Validation:p.skipUTF8Validation})}),p.finishRequest?p.finishRequest(o,b):o.end()}(this,a,b,c)):(this._autoPong=c.autoPong,this._closeTimeout=c.closeTimeout,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(a){r.includes(a)&&(this._binaryType=a,this._receiver&&(this._receiver._binaryType=a))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(a,b,c){let d=new o({allowSynchronousEvents:c.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:c.maxPayload,skipUTF8Validation:c.skipUTF8Validation}),e=new p(a,this._extensions,c.generateMask);this._receiver=d,this._sender=e,this._socket=a,d[y]=this,e[y]=this,a[y]=this,d.on("conclude",P),d.on("drain",Q),d.on("error",R),d.on("message",T),d.on("ping",U),d.on("pong",V),e.onerror=X,a.setTimeout&&a.setTimeout(0),a.setNoDelay&&a.setNoDelay(),b.length>0&&a.unshift(b),a.on("close",Z),a.on("data",$),a.on("end",_),a.on("error",aa),this._readyState=J.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=J.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[n.extensionName]&&this._extensions[n.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=J.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(a,b){if(this.readyState!==J.CLOSED){if(this.readyState===J.CONNECTING)return void N(this,this._req,"WebSocket was closed before the connection was established");if(this.readyState===J.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=J.CLOSING,this._sender.close(a,b,!this._isServer,a=>{!a&&(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),Y(this)}}pause(){this.readyState!==J.CONNECTING&&this.readyState!==J.CLOSED&&(this._paused=!0,this._socket.pause())}ping(a,b,c){if(this.readyState===J.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof a?(c=a,a=b=void 0):"function"==typeof b&&(c=b,b=void 0),"number"==typeof a&&(a=a.toString()),this.readyState!==J.OPEN)?O(this,a,c):(void 0===b&&(b=!this._isServer),this._sender.ping(a||t,b,c))}pong(a,b,c){if(this.readyState===J.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof a?(c=a,a=b=void 0):"function"==typeof b&&(c=b,b=void 0),"number"==typeof a&&(a=a.toString()),this.readyState!==J.OPEN)?O(this,a,c):(void 0===b&&(b=!this._isServer),this._sender.pong(a||t,b,c))}resume(){this.readyState!==J.CONNECTING&&this.readyState!==J.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(a,b,c){if(this.readyState===J.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof b&&(c=b,b={}),"number"==typeof a&&(a=a.toString()),this.readyState!==J.OPEN)return void O(this,a,c);let d={binary:"string"!=typeof a,mask:!this._isServer,compress:!0,fin:!0,...b};this._extensions[n.extensionName]||(d.compress=!1),this._sender.send(a||t,d,c)}terminate(){if(this.readyState!==J.CLOSED){if(this.readyState===J.CONNECTING)return void N(this,this._req,"WebSocket was closed before the connection was established");this._socket&&(this._readyState=J.CLOSING,this._socket.destroy())}}}function K(a,b){a._readyState=J.CLOSING,a._errorEmitted=!0,a.emit("error",b),a.emitClose()}function L(a){return a.path=a.socketPath,g.connect(a)}function M(a){return a.path=void 0,a.servername||""===a.servername||(a.servername=g.isIP(a.host)?"":a.host),h.connect(a)}function N(a,b,c){a._readyState=J.CLOSING;let d=Error(c);Error.captureStackTrace(d,N),b.setHeader?(b[F]=!0,b.abort(),b.socket&&!b.socket.destroyed&&b.socket.destroy(),process.nextTick(K,a,d)):(b.destroy(d),b.once("error",a.emit.bind(a,"error")),b.once("close",a.emitClose.bind(a)))}function O(a,b,c){if(b){let c=q(b)?b.size:E(b).length;a._socket?a._sender._bufferedBytes+=c:a._bufferedAmount+=c}if(c){let b=Error(`WebSocket is not open: readyState ${a.readyState} (${H[a.readyState]})`);process.nextTick(c,b)}}function P(a,b){let c=this[y];c._closeFrameReceived=!0,c._closeMessage=b,c._closeCode=a,void 0!==c._socket[y]&&(c._socket.removeListener("data",$),process.nextTick(W,c._socket),1005===a?c.close():c.close(a,b))}function Q(){let a=this[y];a.isPaused||a._socket.resume()}function R(a){let b=this[y];void 0!==b._socket[y]&&(b._socket.removeListener("data",$),process.nextTick(W,b._socket),b.close(a[x])),b._errorEmitted||(b._errorEmitted=!0,b.emit("error",a))}function S(){this[y].emitClose()}function T(a,b){this[y].emit("message",a,b)}function U(a){let b=this[y];b._autoPong&&b.pong(a,!this._isServer,z),b.emit("ping",a)}function V(a){this[y].emit("pong",a)}function W(a){a.resume()}function X(a){let b=this[y];b.readyState!==J.CLOSED&&(b.readyState===J.OPEN&&(b._readyState=J.CLOSING,Y(b)),this._socket.end(),b._errorEmitted||(b._errorEmitted=!0,b.emit("error",a)))}function Y(a){a._closeTimer=setTimeout(a._socket.destroy.bind(a._socket),a._closeTimeout)}function Z(){let a=this[y];if(this.removeListener("close",Z),this.removeListener("data",$),this.removeListener("end",_),a._readyState=J.CLOSING,!this._readableState.endEmitted&&!a._closeFrameReceived&&!a._receiver._writableState.errorEmitted&&0!==this._readableState.length){let b=this.read(this._readableState.length);a._receiver.write(b)}a._receiver.end(),this[y]=void 0,clearTimeout(a._closeTimer),a._receiver._writableState.finished||a._receiver._writableState.errorEmitted?a.emitClose():(a._receiver.on("error",S),a._receiver.on("finish",S))}function $(a){this[y]._receiver.write(a)||this.pause()}function _(){let a=this[y];a._readyState=J.CLOSING,a._receiver.end(),this.end()}function aa(){let a=this[y];this.removeListener("error",aa),this.on("error",z),a&&(a._readyState=J.CLOSING,this.destroy())}Object.defineProperty(J,"CONNECTING",{enumerable:!0,value:H.indexOf("CONNECTING")}),Object.defineProperty(J.prototype,"CONNECTING",{enumerable:!0,value:H.indexOf("CONNECTING")}),Object.defineProperty(J,"OPEN",{enumerable:!0,value:H.indexOf("OPEN")}),Object.defineProperty(J.prototype,"OPEN",{enumerable:!0,value:H.indexOf("OPEN")}),Object.defineProperty(J,"CLOSING",{enumerable:!0,value:H.indexOf("CLOSING")}),Object.defineProperty(J.prototype,"CLOSING",{enumerable:!0,value:H.indexOf("CLOSING")}),Object.defineProperty(J,"CLOSED",{enumerable:!0,value:H.indexOf("CLOSED")}),Object.defineProperty(J.prototype,"CLOSED",{enumerable:!0,value:H.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(a=>{Object.defineProperty(J.prototype,a,{enumerable:!0})}),["open","error","close","message"].forEach(a=>{Object.defineProperty(J.prototype,`on${a}`,{enumerable:!0,get(){for(let b of this.listeners(a))if(b[v])return b[w];return null},set(b){for(let b of this.listeners(a))if(b[v]){this.removeListener(a,b);break}"function"==typeof b&&this.addEventListener(a,b,{[v]:!0})}})}),J.prototype.addEventListener=A,J.prototype.removeEventListener=B,b.exports=J},16816,(a,b,c)=>{"use strict";a.r(73253);let{Duplex:d}=a.r(88947);function e(a){a.emit("close")}function f(){!this.destroyed&&this._writableState.finished&&this.destroy()}function g(a){this.removeListener("error",g),this.destroy(),0===this.listenerCount("error")&&this.emit("error",a)}b.exports=function(a,b){let c=!0,h=new d({...b,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return a.on("message",function(b,c){let d=!c&&h._readableState.objectMode?b.toString():b;h.push(d)||a.pause()}),a.once("error",function(a){h.destroyed||(c=!1,h.destroy(a))}),a.once("close",function(){h.destroyed||h.push(null)}),h._destroy=function(b,d){if(a.readyState===a.CLOSED){d(b),process.nextTick(e,h);return}let f=!1;a.once("error",function(a){f=!0,d(a)}),a.once("close",function(){f||d(b),process.nextTick(e,h)}),c&&a.terminate()},h._final=function(b){a.readyState===a.CONNECTING?a.once("open",function(){h._final(b)}):null!==a._socket&&(a._socket._writableState.finished?(b(),h._readableState.endEmitted&&h.destroy()):(a._socket.once("finish",function(){b()}),a.close()))},h._read=function(){a.isPaused&&a.resume()},h._write=function(b,c,d){a.readyState===a.CONNECTING?a.once("open",function(){h._write(b,c,d)}):a.send(b,d)},h.on("end",f),h.on("error",g),h}},35816,(a,b,c)=>{"use strict";let{tokenChars:d}=a.r(50308);b.exports={parse:function(a){let b=new Set,c=-1,e=-1,f=0;for(;f<a.length;f++){let g=a.charCodeAt(f);if(-1===e&&1===d[g])-1===c&&(c=f);else if(0!==f&&(32===g||9===g))-1===e&&-1!==c&&(e=f);else if(44===g){if(-1===c)throw SyntaxError(`Unexpected character at index ${f}`);-1===e&&(e=f);let d=a.slice(c,e);if(b.has(d))throw SyntaxError(`The "${d}" subprotocol is duplicated`);b.add(d),c=e=-1}else throw SyntaxError(`Unexpected character at index ${f}`)}if(-1===c||-1!==e)throw SyntaxError("Unexpected end of input");let g=a.slice(c,f);if(b.has(g))throw SyntaxError(`The "${g}" subprotocol is duplicated`);return b.add(g),b}}},72513,(a,b,c)=>{"use strict";let d=a.r(27699),e=a.r(21517),{Duplex:f}=a.r(88947),{createHash:g}=a.r(54799),h=a.r(82731),i=a.r(24191),j=a.r(35816),k=a.r(73253),{CLOSE_TIMEOUT:l,GUID:m,kWebSocket:n}=a.r(77379),o=/^[+/0-9A-Za-z]{22}==$/;function p(a){a._state=2,a.emit("close")}function q(){this.destroy()}function r(a,b,c,d){c=c||e.STATUS_CODES[b],d={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(c),...d},a.once("finish",a.destroy),a.end(`HTTP/1.1 ${b} ${e.STATUS_CODES[b]}\r
`+Object.keys(d).map(a=>`${a}: ${d[a]}`).join("\r\n")+"\r\n\r\n"+c)}function s(a,b,c,d,e,f){if(a.listenerCount("wsClientError")){let d=Error(e);Error.captureStackTrace(d,s),a.emit("wsClientError",d,c,b)}else r(c,d,e,f)}b.exports=class extends d{constructor(a,b){if(super(),null==(a={allowSynchronousEvents:!0,autoPong:!0,maxPayload:0x6400000,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,closeTimeout:l,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:k,...a}).port&&!a.server&&!a.noServer||null!=a.port&&(a.server||a.noServer)||a.server&&a.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=a.port?(this._server=e.createServer((a,b)=>{let c=e.STATUS_CODES[426];b.writeHead(426,{"Content-Length":c.length,"Content-Type":"text/plain"}),b.end(c)}),this._server.listen(a.port,a.host,a.backlog,b)):a.server&&(this._server=a.server),this._server){const a=this.emit.bind(this,"connection");this._removeListeners=function(a,b){for(let c of Object.keys(b))a.on(c,b[c]);return function(){for(let c of Object.keys(b))a.removeListener(c,b[c])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(b,c,d)=>{this.handleUpgrade(b,c,d,a)}})}!0===a.perMessageDeflate&&(a.perMessageDeflate={}),a.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=a,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(a){if(2===this._state){a&&this.once("close",()=>{a(Error("The server is not running"))}),process.nextTick(p,this);return}if(a&&this.once("close",a),1!==this._state)if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(p,this);else{let a=this._server;this._removeListeners(),this._removeListeners=this._server=null,a.close(()=>{p(this)})}}shouldHandle(a){if(this.options.path){let b=a.url.indexOf("?");if((-1!==b?a.url.slice(0,b):a.url)!==this.options.path)return!1}return!0}handleUpgrade(a,b,c,d){b.on("error",q);let e=a.headers["sec-websocket-key"],f=a.headers.upgrade,g=+a.headers["sec-websocket-version"];if("GET"!==a.method)return void s(this,a,b,405,"Invalid HTTP method");if(void 0===f||"websocket"!==f.toLowerCase())return void s(this,a,b,400,"Invalid Upgrade header");if(void 0===e||!o.test(e))return void s(this,a,b,400,"Missing or invalid Sec-WebSocket-Key header");if(13!==g&&8!==g)return void s(this,a,b,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});if(!this.shouldHandle(a))return void r(b,400);let k=a.headers["sec-websocket-protocol"],l=new Set;if(void 0!==k)try{l=j.parse(k)}catch(c){s(this,a,b,400,"Invalid Sec-WebSocket-Protocol header");return}let m=a.headers["sec-websocket-extensions"],n={};if(this.options.perMessageDeflate&&void 0!==m){let c=new i(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let a=h.parse(m);a[i.extensionName]&&(c.accept(a[i.extensionName]),n[i.extensionName]=c)}catch(c){s(this,a,b,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let f={origin:a.headers[`${8===g?"sec-websocket-origin":"origin"}`],secure:!!(a.socket.authorized||a.socket.encrypted),req:a};if(2===this.options.verifyClient.length)return void this.options.verifyClient(f,(f,g,h,i)=>{if(!f)return r(b,g||401,h,i);this.completeUpgrade(n,e,l,a,b,c,d)});if(!this.options.verifyClient(f))return r(b,401)}this.completeUpgrade(n,e,l,a,b,c,d)}completeUpgrade(a,b,c,d,e,f,j){if(!e.readable||!e.writable)return e.destroy();if(e[n])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return r(e,503);let k=g("sha1").update(b+m).digest("base64"),l=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${k}`],o=new this.options.WebSocket(null,void 0,this.options);if(c.size){let a=this.options.handleProtocols?this.options.handleProtocols(c,d):c.values().next().value;a&&(l.push(`Sec-WebSocket-Protocol: ${a}`),o._protocol=a)}if(a[i.extensionName]){let b=a[i.extensionName].params,c=h.format({[i.extensionName]:[b]});l.push(`Sec-WebSocket-Extensions: ${c}`),o._extensions=a}this.emit("headers",l,d),e.write(l.concat("\r\n").join("\r\n")),e.removeListener("error",q),o.setSocket(e,f,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(o),o.on("close",()=>{this.clients.delete(o),this._shouldEmitClose&&!this.clients.size&&process.nextTick(p,this)})),j(o,d)}}},51933,(a,b,c)=>{"use strict";var d={};function e(a,b){!b.unsigned&&--a;let c=b.unsigned?0:-Math.pow(2,a),d=Math.pow(2,a)-1,e=b.moduloBitLength?Math.pow(2,b.moduloBitLength):Math.pow(2,a),f=b.moduloBitLength?Math.pow(2,b.moduloBitLength-1):Math.pow(2,a-1);return function(a,g){g||(g={});let h=+a;if(g.enforceRange){if(!Number.isFinite(h))throw TypeError("Argument is not a finite number");if((h=(h<0?-1:1)*Math.floor(Math.abs(h)))<c||h>d)throw TypeError("Argument is not in byte range");return h}if(!isNaN(h)&&g.clamp){var i;return(h=(i=h)%1==.5&&(1&i)==0?Math.floor(i):Math.round(i))<c&&(h=c),h>d&&(h=d),h}if(!Number.isFinite(h)||0===h)return 0;if(h=(h<0?-1:1)*Math.floor(Math.abs(h))%e,!b.unsigned&&h>=f)return h-e;if(b.unsigned){if(h<0)h+=e;else if(-0===h)return 0}return h}}b.exports=d,d.void=function(){},d.boolean=function(a){return!!a},d.byte=e(8,{unsigned:!1}),d.octet=e(8,{unsigned:!0}),d.short=e(16,{unsigned:!1}),d["unsigned short"]=e(16,{unsigned:!0}),d.long=e(32,{unsigned:!1}),d["unsigned long"]=e(32,{unsigned:!0}),d["long long"]=e(32,{unsigned:!1,moduloBitLength:64}),d["unsigned long long"]=e(32,{unsigned:!0,moduloBitLength:64}),d.double=function(a){let b=+a;if(!Number.isFinite(b))throw TypeError("Argument is not a finite floating-point value");return b},d["unrestricted double"]=function(a){let b=+a;if(isNaN(b))throw TypeError("Argument is NaN");return b},d.float=d.double,d["unrestricted float"]=d["unrestricted double"],d.DOMString=function(a,b){return(b||(b={}),b.treatNullAsEmptyString&&null===a)?"":String(a)},d.ByteString=function(a,b){let c,d=String(a);for(let a=0;void 0!==(c=d.codePointAt(a));++a)if(c>255)throw TypeError("Argument is not a valid bytestring");return d},d.USVString=function(a){let b=String(a),c=b.length,d=[];for(let a=0;a<c;++a){let e=b.charCodeAt(a);if(e<55296||e>57343)d.push(String.fromCodePoint(e));else if(56320<=e&&e<=57343)d.push(String.fromCodePoint(65533));else if(a===c-1)d.push(String.fromCodePoint(65533));else{let c=b.charCodeAt(a+1);if(56320<=c&&c<=57343){let b=1023&e,f=1023&c;d.push(String.fromCodePoint(65536+1024*b+f)),++a}else d.push(String.fromCodePoint(65533))}}return d.join("")},d.Date=function(a,b){if(!(a instanceof Date))throw TypeError("Argument is not a Date object");if(!isNaN(a))return a},d.RegExp=function(a,b){return a instanceof RegExp||(a=new RegExp(a)),a}},39534,(a,b,c)=>{"use strict";b.exports.mixin=function(a,b){let c=Object.getOwnPropertyNames(b);for(let d=0;d<c.length;++d)Object.defineProperty(a,c[d],Object.getOwnPropertyDescriptor(b,c[d]))},b.exports.wrapperSymbol=Symbol("wrapper"),b.exports.implSymbol=Symbol("impl"),b.exports.wrapperForImpl=function(a){return a[b.exports.wrapperSymbol]},b.exports.implForWrapper=function(a){return a[b.exports.implSymbol]}},33205,(a,b,c)=>{"use strict";var d=a.r(92097),e=a.r(45736),f={TRANSITIONAL:0,NONTRANSITIONAL:1};function g(a){return a.split("\0").map(function(a){return a.normalize("NFC")}).join("\0")}function h(a){for(var b=0,c=e.length-1;b<=c;){var d=Math.floor((b+c)/2),f=e[d];if(f[0][0]<=a&&f[0][1]>=a)return f;f[0][0]>a?c=d-1:b=d+1}return null}var i=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;function j(a){return a.replace(i,"_").length}var k=/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08E4-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D01-\u0D03\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u18A9\u1920-\u192B\u1930-\u193B\u19B0-\u19C0\u19C8\u19C9\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF5\u1DFC-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C4\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2D]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD804[\uDC00-\uDC02\uDC38-\uDC46\uDC7F-\uDC82\uDCB0-\uDCBA\uDD00-\uDD02\uDD27-\uDD34\uDD73\uDD80-\uDD82\uDDB3-\uDDC0\uDE2C-\uDE37\uDEDF-\uDEEA\uDF01-\uDF03\uDF3C\uDF3E-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF62\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDCB0-\uDCC3\uDDAF-\uDDB5\uDDB8-\uDDC0\uDE30-\uDE40\uDEAB-\uDEB7]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF51-\uDF7E\uDF8F-\uDF92]|\uD82F[\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD83A[\uDCD0-\uDCD6]|\uDB40[\uDD00-\uDDEF]/;function l(a,b,c){var e=function(a,b,c){for(var d=!1,e="",g=j(a),i=0;i<g;++i){var k=a.codePointAt(i),l=h(k);switch(l[1]){case"disallowed":d=!0,e+=String.fromCodePoint(k);break;case"ignored":break;case"mapped":e+=String.fromCodePoint.apply(String,l[2]);break;case"deviation":c===f.TRANSITIONAL?e+=String.fromCodePoint.apply(String,l[2]):e+=String.fromCodePoint(k);break;case"valid":e+=String.fromCodePoint(k);break;case"disallowed_STD3_mapped":b?(d=!0,e+=String.fromCodePoint(k)):e+=String.fromCodePoint.apply(String,l[2]);break;case"disallowed_STD3_valid":b&&(d=!0),e+=String.fromCodePoint(k)}}return{string:e,error:d}}(a,b,c);e.string=g(e.string);for(var i=e.string.split("."),m=0;m<i.length;++m)try{var n=function(a,b){"xn--"===a.substr(0,4)&&(a=d.toUnicode(a),f.NONTRANSITIONAL);var c=!1;(g(a)!==a||"-"===a[3]&&"-"===a[4]||"-"===a[0]||"-"===a[a.length-1]||-1!==a.indexOf(".")||0===a.search(k))&&(c=!0);for(var e=j(a),i=0;i<e;++i){var m=h(a.codePointAt(i));if(l===f.TRANSITIONAL&&"valid"!==m[1]||l===f.NONTRANSITIONAL&&"valid"!==m[1]&&"deviation"!==m[1]){c=!0;break}}return{label:a,error:c}}(i[m]);i[m]=n.label,e.error=e.error||n.error}catch(a){e.error=!0}return{string:i.join("."),error:e.error}}b.exports.toASCII=function(a,b,c,e){var f=l(a,b,c),g=f.string.split(".");if(g=g.map(function(a){try{return d.toASCII(a)}catch(b){return f.error=!0,a}}),e){var h=g.slice(0,g.length-1).join(".").length;(h.length>253||0===h.length)&&(f.error=!0);for(var i=0;i<g.length;++i)if(g.length>63||0===g.length){f.error=!0;break}}return f.error?null:g.join(".")},b.exports.toUnicode=function(a,b){var c=l(a,b,f.NONTRANSITIONAL);return{domain:c.string,error:c.error}},b.exports.PROCESSING_OPTIONS=f},16114,(a,b,c)=>{"use strict";let d=a.r(92097),e=a.r(33205),f={ftp:21,file:null,gopher:70,http:80,https:443,ws:80,wss:443},g=Symbol("failure");function h(a){return d.ucs2.decode(a).length}function i(a,b){let c=a[b];return isNaN(c)?void 0:String.fromCodePoint(c)}function j(a){return a>=48&&a<=57}function k(a){return a>=65&&a<=90||a>=97&&a<=122}function l(a){return j(a)||a>=65&&a<=70||a>=97&&a<=102}function m(a){return"."===a||"%2e"===a.toLowerCase()}function n(a){return 2===a.length&&k(a.codePointAt(0))&&(":"===a[1]||"|"===a[1])}function o(a){return void 0!==f[a]}function p(a){return o(a.scheme)}function q(a){let b=a.toString(16).toUpperCase();return 1===b.length&&(b="0"+b),"%"+b}function r(a){return a<=31||a>126}let s=new Set([32,34,35,60,62,63,96,123,125]);function t(a){return r(a)||s.has(a)}let u=new Set([47,58,59,61,64,91,92,93,94,124]);function v(a){return t(a)||u.has(a)}function w(a,b){let c=String.fromCodePoint(a);if(b(a)){let a=new Buffer(c),b="";for(let c=0;c<a.length;++c)b+=q(a[c]);return b}return c}function x(a,b){if("["===a[0])return"]"!==a[a.length-1]?g:function(a){let b=[0,0,0,0,0,0,0,0],c=0,e=null,f=0;if(58===(a=d.ucs2.decode(a))[f]){if(58!==a[f+1])return g;f+=2,e=++c}for(;f<a.length;){if(8===c)return g;if(58===a[f]){if(null!==e)return g;++f,e=++c;continue}let d=0,h=0;for(;h<4&&l(a[f]);)d=16*d+parseInt(i(a,f),16),++f,++h;if(46===a[f]){if(0===h||(f-=h,c>6))return g;let d=0;for(;void 0!==a[f];){let e=null;if(d>0)if(46!==a[f]||!(d<4))return g;else++f;if(!j(a[f]))return g;for(;j(a[f]);){let b=parseInt(i(a,f));if(null===e)e=b;else{if(0===e)return g;e=10*e+b}if(e>255)return g;++f}b[c]=256*b[c]+e,(2==++d||4===d)&&++c}if(4!==d)return g;break}if(58===a[f]){if(void 0===a[++f])return g}else if(void 0!==a[f])return g;b[c]=d,++c}if(null!==e){let a=c-e;for(c=7;0!==c&&a>0;){let d=b[e+a-1];b[e+a-1]=b[c],b[c]=d,--c,--a}}else if(null===e&&8!==c)return g;return b}(a.substring(1,a.length-1));if(!b){var c=a;if(-1!==c.search(/\u0000|\u0009|\u000A|\u000D|\u0020|#|\/|:|\?|@|\[|\\|\]/))return g;let b="",e=d.ucs2.decode(c);for(let a=0;a<e.length;++a)b+=w(e[a],r);return b}let f=function(a){let b=new Buffer(a),c=[];for(let a=0;a<b.length;++a)37!==b[a]?c.push(b[a]):37===b[a]&&l(b[a+1])&&l(b[a+2])?(c.push(parseInt(b.slice(a+1,a+3).toString(),16)),a+=2):c.push(b[a]);return new Buffer(c).toString()}(a),h=e.toASCII(f,!1,e.PROCESSING_OPTIONS.NONTRANSITIONAL,!1);if(null===h||-1!==h.search(/\u0000|\u0009|\u000A|\u000D|\u0020|#|%|\/|:|\?|@|\[|\\|\]/))return g;let k=function(a){let b=a.split(".");if(""===b[b.length-1]&&b.length>1&&b.pop(),b.length>4)return a;let c=[];for(let d of b){if(""===d)return a;let b=function(a){let b=10;return(a.length>=2&&"0"===a.charAt(0)&&"x"===a.charAt(1).toLowerCase()?(a=a.substring(2),b=16):a.length>=2&&"0"===a.charAt(0)&&(a=a.substring(1),b=8),""===a)?0:(10===b?/[^0-9]/:16===b?/[^0-9A-Fa-f]/:/[^0-7]/).test(a)?g:parseInt(a,b)}(d);if(b===g)return a;c.push(b)}for(let a=0;a<c.length-1;++a)if(c[a]>255)return g;if(c[c.length-1]>=Math.pow(256,5-c.length))return g;let d=c.pop(),e=0;for(let a of c)d+=a*Math.pow(256,3-e),++e;return d}(h);return"number"==typeof k||k===g?k:h}function y(a){if("number"==typeof a){let b="",c=a;for(let a=1;a<=4;++a)b=String(c%256)+b,4!==a&&(b="."+b),c=Math.floor(c/256);return b}return a instanceof Array?"["+function(a){let b="",c=function(a){let b=null,c=1,d=null,e=0;for(let f=0;f<a.length;++f)0!==a[f]?(e>c&&(b=d,c=e),d=null,e=0):(null===d&&(d=f),++e);return e>c&&(b=d,c=e),{idx:b,len:c}}(a).idx,d=!1;for(let e=0;e<=7;++e)if(!d||0!==a[e]){if(d&&(d=!1),c===e){b+=0===e?"::":":",d=!0;continue}b+=a[e].toString(16),7!==e&&(b+=":")}return b}(a)+"]":a}function z(a){var b;let c=a.path;0===c.length||"file"===a.scheme&&1===c.length&&(b=c[0],/^[A-Za-z]:$/.test(b))||c.pop()}function A(a){return""!==a.username||""!==a.password}function B(a,b,c,e,f){if(this.pointer=0,this.input=a,this.base=b||null,this.encodingOverride=c||"utf-8",this.stateOverride=f,this.url=e,this.failure=!1,this.parseError=!1,!this.url){this.url={scheme:"",username:"",password:"",host:null,port:null,path:[],query:null,fragment:null,cannotBeABaseURL:!1};let a=this.input.replace(/^[\u0000-\u001F\u0020]+|[\u0000-\u001F\u0020]+$/g,"");a!==this.input&&(this.parseError=!0),this.input=a}let h=this.input.replace(/\u0009|\u000A|\u000D/g,"");for(h!==this.input&&(this.parseError=!0),this.input=h,this.state=f||"scheme start",this.buffer="",this.atFlag=!1,this.arrFlag=!1,this.passwordTokenSeenFlag=!1,this.input=d.ucs2.decode(this.input);this.pointer<=this.input.length;++this.pointer){let a=this.input[this.pointer],b=isNaN(a)?void 0:String.fromCodePoint(a),c=this["parse "+this.state](a,b);if(c){if(c===g){this.failure=!0;break}}else break}}B.prototype["parse scheme start"]=function(a,b){if(k(a))this.buffer+=b.toLowerCase(),this.state="scheme";else{if(this.stateOverride)return this.parseError=!0,g;this.state="no scheme",--this.pointer}return!0},B.prototype["parse scheme"]=function(a,b){if(k(a)||j(a)||43===a||45===a||46===a)this.buffer+=b.toLowerCase();else if(58===a){if(this.stateOverride&&(p(this.url)&&!o(this.buffer)||!p(this.url)&&o(this.buffer)||(A(this.url)||null!==this.url.port)&&"file"===this.buffer||"file"===this.url.scheme&&(""===this.url.host||null===this.url.host))||(this.url.scheme=this.buffer,this.buffer="",this.stateOverride))return!1;"file"===this.url.scheme?((47!==this.input[this.pointer+1]||47!==this.input[this.pointer+2])&&(this.parseError=!0),this.state="file"):p(this.url)&&null!==this.base&&this.base.scheme===this.url.scheme?this.state="special relative or authority":p(this.url)?this.state="special authority slashes":47===this.input[this.pointer+1]?(this.state="path or authority",++this.pointer):(this.url.cannotBeABaseURL=!0,this.url.path.push(""),this.state="cannot-be-a-base-URL path")}else{if(this.stateOverride)return this.parseError=!0,g;this.buffer="",this.state="no scheme",this.pointer=-1}return!0},B.prototype["parse no scheme"]=function(a){return null===this.base||this.base.cannotBeABaseURL&&35!==a?g:(this.base.cannotBeABaseURL&&35===a?(this.url.scheme=this.base.scheme,this.url.path=this.base.path.slice(),this.url.query=this.base.query,this.url.fragment="",this.url.cannotBeABaseURL=!0,this.state="fragment"):("file"===this.base.scheme?this.state="file":this.state="relative",--this.pointer),!0)},B.prototype["parse special relative or authority"]=function(a){return 47===a&&47===this.input[this.pointer+1]?(this.state="special authority ignore slashes",++this.pointer):(this.parseError=!0,this.state="relative",--this.pointer),!0},B.prototype["parse path or authority"]=function(a){return 47===a?this.state="authority":(this.state="path",--this.pointer),!0},B.prototype["parse relative"]=function(a){return this.url.scheme=this.base.scheme,isNaN(a)?(this.url.username=this.base.username,this.url.password=this.base.password,this.url.host=this.base.host,this.url.port=this.base.port,this.url.path=this.base.path.slice(),this.url.query=this.base.query):47===a?this.state="relative slash":63===a?(this.url.username=this.base.username,this.url.password=this.base.password,this.url.host=this.base.host,this.url.port=this.base.port,this.url.path=this.base.path.slice(),this.url.query="",this.state="query"):35===a?(this.url.username=this.base.username,this.url.password=this.base.password,this.url.host=this.base.host,this.url.port=this.base.port,this.url.path=this.base.path.slice(),this.url.query=this.base.query,this.url.fragment="",this.state="fragment"):p(this.url)&&92===a?(this.parseError=!0,this.state="relative slash"):(this.url.username=this.base.username,this.url.password=this.base.password,this.url.host=this.base.host,this.url.port=this.base.port,this.url.path=this.base.path.slice(0,this.base.path.length-1),this.state="path",--this.pointer),!0},B.prototype["parse relative slash"]=function(a){return p(this.url)&&(47===a||92===a)?(92===a&&(this.parseError=!0),this.state="special authority ignore slashes"):47===a?this.state="authority":(this.url.username=this.base.username,this.url.password=this.base.password,this.url.host=this.base.host,this.url.port=this.base.port,this.state="path",--this.pointer),!0},B.prototype["parse special authority slashes"]=function(a){return 47===a&&47===this.input[this.pointer+1]?(this.state="special authority ignore slashes",++this.pointer):(this.parseError=!0,this.state="special authority ignore slashes",--this.pointer),!0},B.prototype["parse special authority ignore slashes"]=function(a){return 47!==a&&92!==a?(this.state="authority",--this.pointer):this.parseError=!0,!0},B.prototype["parse authority"]=function(a,b){if(64===a){this.parseError=!0,this.atFlag&&(this.buffer="%40"+this.buffer),this.atFlag=!0;let a=h(this.buffer);for(let b=0;b<a;++b){let a=this.buffer.codePointAt(b);if(58===a&&!this.passwordTokenSeenFlag){this.passwordTokenSeenFlag=!0;continue}let c=w(a,v);this.passwordTokenSeenFlag?this.url.password+=c:this.url.username+=c}this.buffer=""}else if(isNaN(a)||47===a||63===a||35===a||p(this.url)&&92===a){if(this.atFlag&&""===this.buffer)return this.parseError=!0,g;this.pointer-=h(this.buffer)+1,this.buffer="",this.state="host"}else this.buffer+=b;return!0},B.prototype["parse hostname"]=B.prototype["parse host"]=function(a,b){if(this.stateOverride&&"file"===this.url.scheme)--this.pointer,this.state="file host";else if(58!==a||this.arrFlag)if(isNaN(a)||47===a||63===a||35===a||p(this.url)&&92===a){if(--this.pointer,p(this.url)&&""===this.buffer)return this.parseError=!0,g;if(this.stateOverride&&""===this.buffer&&(A(this.url)||null!==this.url.port))return this.parseError=!0,!1;let a=x(this.buffer,p(this.url));if(a===g)return g;if(this.url.host=a,this.buffer="",this.state="path start",this.stateOverride)return!1}else 91===a?this.arrFlag=!0:93===a&&(this.arrFlag=!1),this.buffer+=b;else{if(""===this.buffer)return this.parseError=!0,g;let a=x(this.buffer,p(this.url));if(a===g)return g;if(this.url.host=a,this.buffer="",this.state="port","hostname"===this.stateOverride)return!1}return!0},B.prototype["parse port"]=function(a,b){if(j(a))this.buffer+=b;else{if(!(isNaN(a)||47===a||63===a||35===a||p(this.url)&&92===a)&&!this.stateOverride)return this.parseError=!0,g;if(""!==this.buffer){let a=parseInt(this.buffer);if(a>65535)return this.parseError=!0,g;this.url.port=a===f[this.url.scheme]?null:a,this.buffer=""}if(this.stateOverride)return!1;this.state="path start",--this.pointer}return!0};let C=new Set([47,92,63,35]);B.prototype["parse file"]=function(a){if(this.url.scheme="file",47===a||92===a)92===a&&(this.parseError=!0),this.state="file slash";else if(null!==this.base&&"file"===this.base.scheme)if(isNaN(a))this.url.host=this.base.host,this.url.path=this.base.path.slice(),this.url.query=this.base.query;else if(63===a)this.url.host=this.base.host,this.url.path=this.base.path.slice(),this.url.query="",this.state="query";else if(35===a)this.url.host=this.base.host,this.url.path=this.base.path.slice(),this.url.query=this.base.query,this.url.fragment="",this.state="fragment";else{var b;this.input.length-this.pointer-1!=0&&(b=this.input[this.pointer+1],k(a)&&(58===b||124===b))&&(!(this.input.length-this.pointer-1>=2)||C.has(this.input[this.pointer+2]))?this.parseError=!0:(this.url.host=this.base.host,this.url.path=this.base.path.slice(),z(this.url)),this.state="path",--this.pointer}else this.state="path",--this.pointer;return!0},B.prototype["parse file slash"]=function(a){if(47===a||92===a)92===a&&(this.parseError=!0),this.state="file host";else{if(null!==this.base&&"file"===this.base.scheme){var b;2===(b=this.base.path[0]).length&&k(b.codePointAt(0))&&":"===b[1]?this.url.path.push(this.base.path[0]):this.url.host=this.base.host}this.state="path",--this.pointer}return!0},B.prototype["parse file host"]=function(a,b){if(isNaN(a)||47===a||92===a||63===a||35===a)if(--this.pointer,!this.stateOverride&&n(this.buffer))this.parseError=!0,this.state="path";else if(""===this.buffer){if(this.url.host="",this.stateOverride)return!1;this.state="path start"}else{let a=x(this.buffer,p(this.url));if(a===g)return g;if("localhost"===a&&(a=""),this.url.host=a,this.stateOverride)return!1;this.buffer="",this.state="path start"}else this.buffer+=b;return!0},B.prototype["parse path start"]=function(a){return p(this.url)?(92===a&&(this.parseError=!0),this.state="path",47!==a&&92!==a&&--this.pointer):this.stateOverride||63!==a?this.stateOverride||35!==a?void 0!==a&&(this.state="path",47!==a&&--this.pointer):(this.url.fragment="",this.state="fragment"):(this.url.query="",this.state="query"),!0},B.prototype["parse path"]=function(a){if(isNaN(a)||47===a||p(this.url)&&92===a||!this.stateOverride&&(63===a||35===a)){var b;if((p(this.url)&&92===a&&(this.parseError=!0),".."===(b=(b=this.buffer).toLowerCase())||"%2e."===b||".%2e"===b||"%2e%2e"===b)?(z(this.url),47===a||p(this.url)&&92===a||this.url.path.push("")):m(this.buffer)&&47!==a&&!(p(this.url)&&92===a)?this.url.path.push(""):m(this.buffer)||("file"===this.url.scheme&&0===this.url.path.length&&n(this.buffer)&&(""!==this.url.host&&null!==this.url.host&&(this.parseError=!0,this.url.host=""),this.buffer=this.buffer[0]+":"),this.url.path.push(this.buffer)),this.buffer="","file"===this.url.scheme&&(void 0===a||63===a||35===a))for(;this.url.path.length>1&&""===this.url.path[0];)this.parseError=!0,this.url.path.shift();63===a&&(this.url.query="",this.state="query"),35===a&&(this.url.fragment="",this.state="fragment")}else 37!==a||l(this.input[this.pointer+1])&&l(this.input[this.pointer+2])||(this.parseError=!0),this.buffer+=w(a,t);return!0},B.prototype["parse cannot-be-a-base-URL path"]=function(a){return 63===a?(this.url.query="",this.state="query"):35===a?(this.url.fragment="",this.state="fragment"):(isNaN(a)||37===a||(this.parseError=!0),37!==a||l(this.input[this.pointer+1])&&l(this.input[this.pointer+2])||(this.parseError=!0),isNaN(a)||(this.url.path[0]=this.url.path[0]+w(a,r))),!0},B.prototype["parse query"]=function(a,b){if(isNaN(a)||!this.stateOverride&&35===a){p(this.url)&&"ws"!==this.url.scheme&&"wss"!==this.url.scheme||(this.encodingOverride="utf-8");let b=new Buffer(this.buffer);for(let a=0;a<b.length;++a)b[a]<33||b[a]>126||34===b[a]||35===b[a]||60===b[a]||62===b[a]?this.url.query+=q(b[a]):this.url.query+=String.fromCodePoint(b[a]);this.buffer="",35===a&&(this.url.fragment="",this.state="fragment")}else 37!==a||l(this.input[this.pointer+1])&&l(this.input[this.pointer+2])||(this.parseError=!0),this.buffer+=b;return!0},B.prototype["parse fragment"]=function(a){return isNaN(a)||(0===a?this.parseError=!0:(37!==a||l(this.input[this.pointer+1])&&l(this.input[this.pointer+2])||(this.parseError=!0),this.url.fragment+=w(a,r))),!0},b.exports.serializeURL=function(a,b){let c=a.scheme+":";if(null!==a.host?(c+="//",(""!==a.username||""!==a.password)&&(c+=a.username,""!==a.password&&(c+=":"+a.password),c+="@"),c+=y(a.host),null!==a.port&&(c+=":"+a.port)):null===a.host&&"file"===a.scheme&&(c+="//"),a.cannotBeABaseURL)c+=a.path[0];else for(let b of a.path)c+="/"+b;return null!==a.query&&(c+="?"+a.query),b||null===a.fragment||(c+="#"+a.fragment),c},b.exports.serializeURLOrigin=function(a){switch(a.scheme){case"blob":try{return b.exports.serializeURLOrigin(b.exports.parseURL(a.path[0]))}catch(a){return"null"}case"ftp":case"gopher":case"http":case"https":case"ws":case"wss":var c;let d;return d=(c={scheme:a.scheme,host:a.host,port:a.port}).scheme+"://"+y(c.host),null!==c.port&&(d+=":"+c.port),d;case"file":return"file://";default:return"null"}},b.exports.basicURLParse=function(a,b){void 0===b&&(b={});let c=new B(a,b.baseURL,b.encodingOverride,b.url,b.stateOverride);return c.failure?"failure":c.url},b.exports.setTheUsername=function(a,b){a.username="";let c=d.ucs2.decode(b);for(let b=0;b<c.length;++b)a.username+=w(c[b],v)},b.exports.setThePassword=function(a,b){a.password="";let c=d.ucs2.decode(b);for(let b=0;b<c.length;++b)a.password+=w(c[b],v)},b.exports.serializeHost=y,b.exports.cannotHaveAUsernamePasswordPort=function(a){return null===a.host||""===a.host||a.cannotBeABaseURL||"file"===a.scheme},b.exports.serializeInteger=function(a){return String(a)},b.exports.parseURL=function(a,c){return void 0===c&&(c={}),b.exports.basicURLParse(a,{baseURL:c.baseURL,encodingOverride:c.encodingOverride})}},96983,(a,b,c)=>{"use strict";let d=a.r(16114);c.implementation=class{constructor(a){const b=a[0],c=a[1];let e=null;if(void 0!==c&&"failure"===(e=d.basicURLParse(c)))throw TypeError("Invalid base URL");const f=d.basicURLParse(b,{baseURL:e});if("failure"===f)throw TypeError("Invalid URL");this._url=f}get href(){return d.serializeURL(this._url)}set href(a){let b=d.basicURLParse(a);if("failure"===b)throw TypeError("Invalid URL");this._url=b}get origin(){return d.serializeURLOrigin(this._url)}get protocol(){return this._url.scheme+":"}set protocol(a){d.basicURLParse(a+":",{url:this._url,stateOverride:"scheme start"})}get username(){return this._url.username}set username(a){d.cannotHaveAUsernamePasswordPort(this._url)||d.setTheUsername(this._url,a)}get password(){return this._url.password}set password(a){d.cannotHaveAUsernamePasswordPort(this._url)||d.setThePassword(this._url,a)}get host(){let a=this._url;return null===a.host?"":null===a.port?d.serializeHost(a.host):d.serializeHost(a.host)+":"+d.serializeInteger(a.port)}set host(a){this._url.cannotBeABaseURL||d.basicURLParse(a,{url:this._url,stateOverride:"host"})}get hostname(){return null===this._url.host?"":d.serializeHost(this._url.host)}set hostname(a){this._url.cannotBeABaseURL||d.basicURLParse(a,{url:this._url,stateOverride:"hostname"})}get port(){return null===this._url.port?"":d.serializeInteger(this._url.port)}set port(a){d.cannotHaveAUsernamePasswordPort(this._url)||(""===a?this._url.port=null:d.basicURLParse(a,{url:this._url,stateOverride:"port"}))}get pathname(){return this._url.cannotBeABaseURL?this._url.path[0]:0===this._url.path.length?"":"/"+this._url.path.join("/")}set pathname(a){this._url.cannotBeABaseURL||(this._url.path=[],d.basicURLParse(a,{url:this._url,stateOverride:"path start"}))}get search(){return null===this._url.query||""===this._url.query?"":"?"+this._url.query}set search(a){let b=this._url;if(""===a){b.query=null;return}let c="?"===a[0]?a.substring(1):a;b.query="",d.basicURLParse(c,{url:b,stateOverride:"query"})}get hash(){return null===this._url.fragment||""===this._url.fragment?"":"#"+this._url.fragment}set hash(a){if(""===a){this._url.fragment=null;return}let b="#"===a[0]?a.substring(1):a;this._url.fragment="",d.basicURLParse(b,{url:this._url,stateOverride:"fragment"})}toJSON(){return this.href}}},60007,(a,b,c)=>{"use strict";let d=a.r(51933),e=a.r(39534),f=a.r(96983),g=e.implSymbol;function h(a){if(!this||this[g]||!(this instanceof h))throw TypeError("Failed to construct 'URL': Please use the 'new' operator, this DOM object constructor cannot be called as a function.");if(arguments.length<1)throw TypeError("Failed to construct 'URL': 1 argument required, but only "+arguments.length+" present.");let c=[];for(let a=0;a<arguments.length&&a<2;++a)c[a]=arguments[a];c[0]=d.USVString(c[0]),void 0!==c[1]&&(c[1]=d.USVString(c[1])),b.exports.setup(this,c)}h.prototype.toJSON=function(){if(!this||!b.exports.is(this))throw TypeError("Illegal invocation");let a=[];for(let b=0;b<arguments.length&&b<0;++b)a[b]=arguments[b];return this[g].toJSON.apply(this[g],a)},Object.defineProperty(h.prototype,"href",{get(){return this[g].href},set(a){a=d.USVString(a),this[g].href=a},enumerable:!0,configurable:!0}),h.prototype.toString=function(){if(!this||!b.exports.is(this))throw TypeError("Illegal invocation");return this.href},Object.defineProperty(h.prototype,"origin",{get(){return this[g].origin},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"protocol",{get(){return this[g].protocol},set(a){a=d.USVString(a),this[g].protocol=a},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"username",{get(){return this[g].username},set(a){a=d.USVString(a),this[g].username=a},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"password",{get(){return this[g].password},set(a){a=d.USVString(a),this[g].password=a},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"host",{get(){return this[g].host},set(a){a=d.USVString(a),this[g].host=a},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"hostname",{get(){return this[g].hostname},set(a){a=d.USVString(a),this[g].hostname=a},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"port",{get(){return this[g].port},set(a){a=d.USVString(a),this[g].port=a},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"pathname",{get(){return this[g].pathname},set(a){a=d.USVString(a),this[g].pathname=a},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"search",{get(){return this[g].search},set(a){a=d.USVString(a),this[g].search=a},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"hash",{get(){return this[g].hash},set(a){a=d.USVString(a),this[g].hash=a},enumerable:!0,configurable:!0}),b.exports={is:a=>!!a&&a[g]instanceof f.implementation,create(a,b){let c=Object.create(h.prototype);return this.setup(c,a,b),c},setup(a,b,c){c||(c={}),c.wrapper=a,a[g]=new f.implementation(b,c),a[g][e.wrapperSymbol]=a},interface:h,expose:{Window:{URL:h},Worker:{URL:h}}}},97884,(a,b,c)=>{"use strict";c.URL=a.r(60007).interface,c.serializeURL=a.r(16114).serializeURL,c.serializeURLOrigin=a.r(16114).serializeURLOrigin,c.basicURLParse=a.r(16114).basicURLParse,c.setTheUsername=a.r(16114).setTheUsername,c.setThePassword=a.r(16114).setThePassword,c.serializeHost=a.r(16114).serializeHost,c.serializeInteger=a.r(16114).serializeInteger,c.parseURL=a.r(16114).parseURL},18210,a=>{"use strict";let b;var c=a.i(88947),d=a.i(21517),e=a.i(92509),f=a.i(97884),g=a.i(24836),h=a.i(6461);let i=c.default.Readable,j=Symbol("buffer"),k=Symbol("type");class l{constructor(){this[k]="";const a=arguments[0],b=arguments[1],c=[];if(a){const b=Number(a.length);for(let d=0;d<b;d++){let b;const e=a[d];(b=e instanceof Buffer?e:ArrayBuffer.isView(e)?Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?Buffer.from(e):e instanceof l?e[j]:Buffer.from("string"==typeof e?e:String(e))).length,c.push(b)}}this[j]=Buffer.concat(c);let d=b&&void 0!==b.type&&String(b.type).toLowerCase();d&&!/[^\u0020-\u007E]/.test(d)&&(this[k]=d)}get size(){return this[j].length}get type(){return this[k]}text(){return Promise.resolve(this[j].toString())}arrayBuffer(){let a=this[j];return Promise.resolve(a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength))}stream(){let a=new i;return a._read=function(){},a.push(this[j]),a.push(null),a}toString(){return"[object Blob]"}slice(){let a,b=this.size,c=arguments[0],d=arguments[1];a=void 0===c?0:c<0?Math.max(b+c,0):Math.min(c,b);let e=Math.max((void 0===d?b:d<0?Math.max(b+d,0):Math.min(d,b))-a,0),f=this[j].slice(a,a+e),g=new l([],{type:arguments[2]});return g[j]=f,g}}function m(a,b,c){Error.call(this,a),this.message=a,this.type=b,c&&(this.code=this.errno=c.code),Error.captureStackTrace(this,this.constructor)}Object.defineProperties(l.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(l.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),m.prototype=Object.create(Error.prototype),m.prototype.constructor=m,m.prototype.name="FetchError";try{b=(()=>{let a=Error("Cannot find module 'encoding'");throw a.code="MODULE_NOT_FOUND",a})().convert}catch(a){}let n=Symbol("Body internals"),o=c.default.PassThrough;function p(a){var b=this,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=d.size,f=d.timeout;null==a?a=null:r(a)?a=Buffer.from(a.toString()):s(a)||Buffer.isBuffer(a)||("[object ArrayBuffer]"===Object.prototype.toString.call(a)?a=Buffer.from(a):ArrayBuffer.isView(a)?a=Buffer.from(a.buffer,a.byteOffset,a.byteLength):a instanceof c.default||(a=Buffer.from(String(a)))),this[n]={body:a,disturbed:!1,error:null},this.size=void 0===e?0:e,this.timeout=void 0===f?0:f,a instanceof c.default&&a.on("error",function(a){let c="AbortError"===a.name?a:new m(`Invalid response body while trying to fetch ${b.url}: ${a.message}`,"system",a);b[n].error=c})}function q(){var a=this;if(this[n].disturbed)return p.Promise.reject(TypeError(`body used already for: ${this.url}`));if(this[n].disturbed=!0,this[n].error)return p.Promise.reject(this[n].error);let b=this.body;if(null===b)return p.Promise.resolve(Buffer.alloc(0));if(s(b)&&(b=b.stream()),Buffer.isBuffer(b))return p.Promise.resolve(b);if(!(b instanceof c.default))return p.Promise.resolve(Buffer.alloc(0));let d=[],e=0,f=!1;return new p.Promise(function(c,g){let h;a.timeout&&(h=setTimeout(function(){f=!0,g(new m(`Response timeout while trying to fetch ${a.url} (over ${a.timeout}ms)`,"body-timeout"))},a.timeout)),b.on("error",function(b){"AbortError"===b.name?(f=!0,g(b)):g(new m(`Invalid response body while trying to fetch ${a.url}: ${b.message}`,"system",b))}),b.on("data",function(b){if(!f&&null!==b){if(a.size&&e+b.length>a.size){f=!0,g(new m(`content size at ${a.url} over limit: ${a.size}`,"max-size"));return}e+=b.length,d.push(b)}}),b.on("end",function(){if(!f){clearTimeout(h);try{c(Buffer.concat(d,e))}catch(b){g(new m(`Could not create Buffer from response body for ${a.url}: ${b.message}`,"system",b))}}})})}function r(a){return"object"==typeof a&&"function"==typeof a.append&&"function"==typeof a.delete&&"function"==typeof a.get&&"function"==typeof a.getAll&&"function"==typeof a.has&&"function"==typeof a.set&&("URLSearchParams"===a.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(a)||"function"==typeof a.sort)}function s(a){return"object"==typeof a&&"function"==typeof a.arrayBuffer&&"string"==typeof a.type&&"function"==typeof a.stream&&"function"==typeof a.constructor&&"string"==typeof a.constructor.name&&/^(Blob|File)$/.test(a.constructor.name)&&/^(Blob|File)$/.test(a[Symbol.toStringTag])}function t(a){let b,d,e=a.body;if(a.bodyUsed)throw Error("cannot clone body after it is used");return e instanceof c.default&&"function"!=typeof e.getBoundary&&(b=new o,d=new o,e.pipe(b),e.pipe(d),a[n].body=b,e=d),e}function u(a){if(null===a)return null;if("string"==typeof a)return"text/plain;charset=UTF-8";if(r(a))return"application/x-www-form-urlencoded;charset=UTF-8";if(s(a))return a.type||null;if(Buffer.isBuffer(a))return null;else if("[object ArrayBuffer]"===Object.prototype.toString.call(a))return null;else if(ArrayBuffer.isView(a))return null;else if("function"==typeof a.getBoundary)return`multipart/form-data;boundary=${a.getBoundary()}`;else if(a instanceof c.default)return null;else return"text/plain;charset=UTF-8"}function v(a){let b=a.body;return null===b?0:s(b)?b.size:Buffer.isBuffer(b)?b.length:b&&"function"==typeof b.getLengthSync?b._lengthRetrievers&&0==b._lengthRetrievers.length||b.hasKnownLength&&b.hasKnownLength()?b.getLengthSync():null:null}p.prototype={get body(){return this[n].body},get bodyUsed(){return this[n].disturbed},arrayBuffer(){return q.call(this).then(function(a){return a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength)})},blob(){let a=this.headers&&this.headers.get("content-type")||"";return q.call(this).then(function(b){return Object.assign(new l([],{type:a.toLowerCase()}),{[j]:b})})},json(){var a=this;return q.call(this).then(function(b){try{return JSON.parse(b.toString())}catch(b){return p.Promise.reject(new m(`invalid json response body at ${a.url} reason: ${b.message}`,"invalid-json"))}})},text(){return q.call(this).then(function(a){return a.toString()})},buffer(){return q.call(this)},textConverted(){var a=this;return q.call(this).then(function(c){return function(a,c){let d,e;if("function"!=typeof b)throw Error("The package `encoding` must be installed to use the textConverted() function");let f=c.get("content-type"),g="utf-8";return f&&(d=/charset=([^;]*)/i.exec(f)),e=a.slice(0,1024).toString(),!d&&e&&(d=/<meta.+?charset=(['"])(.+?)\1/i.exec(e)),!d&&e&&(!(d=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(e))&&(d=/<meta[\s]+?content=(['"])(.+?)\1[\s]+?http-equiv=(['"])content-type\3/i.exec(e))&&d.pop(),d&&(d=/charset=(.*)/i.exec(d.pop()))),!d&&e&&(d=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(e)),d&&("gb2312"===(g=d.pop())||"gbk"===g)&&(g="gb18030"),b(a,"UTF-8",g).toString()}(c,a.headers)})}},Object.defineProperties(p.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),p.mixIn=function(a){for(let b of Object.getOwnPropertyNames(p.prototype))if(!(b in a)){let c=Object.getOwnPropertyDescriptor(p.prototype,b);Object.defineProperty(a,b,c)}},p.Promise=a.g.Promise;let w=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,x=/[^\t\x20-\x7e\x80-\xff]/;function y(a){if(a=`${a}`,w.test(a)||""===a)throw TypeError(`${a} is not a legal HTTP header name`)}function z(a){if(a=`${a}`,x.test(a))throw TypeError(`${a} is not a legal HTTP header value`)}function A(a,b){for(let c in b=b.toLowerCase(),a)if(c.toLowerCase()===b)return c}let B=Symbol("map");class C{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[B]=Object.create(null),a instanceof C){const b=a.raw();for(const a of Object.keys(b))for(const c of b[a])this.append(a,c);return}if(null==a);else if("object"==typeof a){const b=a[Symbol.iterator];if(null!=b){if("function"!=typeof b)throw TypeError("Header pairs must be iterable");const c=[];for(const b of a){if("object"!=typeof b||"function"!=typeof b[Symbol.iterator])throw TypeError("Each header pair must be iterable");c.push(Array.from(b))}for(const a of c){if(2!==a.length)throw TypeError("Each header pair must be a name/value tuple");this.append(a[0],a[1])}}else for(const b of Object.keys(a)){const c=a[b];this.append(b,c)}}else throw TypeError("Provided initializer must be an object")}get(a){y(a=`${a}`);let b=A(this[B],a);return void 0===b?null:this[B][b].join(", ")}forEach(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,c=D(this),d=0;for(;d<c.length;){var e=c[d];let f=e[0],g=e[1];a.call(b,g,f,this),c=D(this),d++}}set(a,b){a=`${a}`,b=`${b}`,y(a),z(b);let c=A(this[B],a);this[B][void 0!==c?c:a]=[b]}append(a,b){a=`${a}`,b=`${b}`,y(a),z(b);let c=A(this[B],a);void 0!==c?this[B][c].push(b):this[B][a]=[b]}has(a){return y(a=`${a}`),void 0!==A(this[B],a)}delete(a){y(a=`${a}`);let b=A(this[B],a);void 0!==b&&delete this[B][b]}raw(){return this[B]}keys(){return F(this,"key")}values(){return F(this,"value")}[Symbol.iterator](){return F(this,"key+value")}}function D(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";return Object.keys(a[B]).sort().map("key"===b?function(a){return a.toLowerCase()}:"value"===b?function(b){return a[B][b].join(", ")}:function(b){return[b.toLowerCase(),a[B][b].join(", ")]})}C.prototype.entries=C.prototype[Symbol.iterator],Object.defineProperty(C.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(C.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});let E=Symbol("internal");function F(a,b){let c=Object.create(G);return c[E]={target:a,kind:b,index:0},c}let G=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==G)throw TypeError("Value of `this` is not a HeadersIterator");var a=this[E];let b=a.target,c=a.kind,d=a.index,e=D(b,c);return d>=e.length?{value:void 0,done:!0}:(this[E].index=d+1,{value:e[d],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));Object.defineProperty(G,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});let H=Symbol("Response internals"),I=d.default.STATUS_CODES;class J{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};p.call(this,a,b);const c=b.status||200,d=new C(b.headers);if(null!=a&&!d.has("Content-Type")){const b=u(a);b&&d.append("Content-Type",b)}this[H]={url:b.url,status:c,statusText:b.statusText||I[c],headers:d,counter:b.counter}}get url(){return this[H].url||""}get status(){return this[H].status}get ok(){return this[H].status>=200&&this[H].status<300}get redirected(){return this[H].counter>0}get statusText(){return this[H].statusText}get headers(){return this[H].headers}clone(){return new J(t(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}p.mixIn(J.prototype),Object.defineProperties(J.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(J.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});let K=Symbol("Request internals"),L=e.default.URL||f.default.URL,M=e.default.parse,N=e.default.format;function O(a){return/^[a-zA-Z][a-zA-Z\d+\-.]*:/.exec(a)&&(a=new L(a).toString()),M(a)}let P="destroy"in c.default.Readable.prototype;function Q(a){return"object"==typeof a&&"object"==typeof a[K]}class R{constructor(a){let b,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Q(a)?b=O(a.url):(b=a&&a.href?O(a.href):O(`${a}`),a={});let d=c.method||a.method||"GET";if(d=d.toUpperCase(),(null!=c.body||Q(a)&&null!==a.body)&&("GET"===d||"HEAD"===d))throw TypeError("Request with GET/HEAD method cannot have body");let e=null!=c.body?c.body:Q(a)&&null!==a.body?t(a):null;p.call(this,e,{timeout:c.timeout||a.timeout||0,size:c.size||a.size||0});const f=new C(c.headers||a.headers||{});if(null!=e&&!f.has("Content-Type")){const a=u(e);a&&f.append("Content-Type",a)}let g=Q(a)?a.signal:null;if("signal"in c&&(g=c.signal),null!=g&&!function(a){let b=a&&"object"==typeof a&&Object.getPrototypeOf(a);return!!(b&&"AbortSignal"===b.constructor.name)}(g))throw TypeError("Expected signal to be an instanceof AbortSignal");this[K]={method:d,redirect:c.redirect||a.redirect||"follow",headers:f,parsedURL:b,signal:g},this.follow=void 0!==c.follow?c.follow:void 0!==a.follow?a.follow:20,this.compress=void 0!==c.compress?c.compress:void 0===a.compress||a.compress,this.counter=c.counter||a.counter||0,this.agent=c.agent||a.agent}get method(){return this[K].method}get url(){return N(this[K].parsedURL)}get headers(){return this[K].headers}get redirect(){return this[K].redirect}get signal(){return this[K].signal}clone(){return new R(this)}}function S(a){Error.call(this,a),this.type="aborted",this.message=a,Error.captureStackTrace(this,this.constructor)}p.mixIn(R.prototype),Object.defineProperty(R.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(R.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),S.prototype=Object.create(Error.prototype),S.prototype.constructor=S,S.prototype.name="AbortError";let T=e.default.URL||f.default.URL,U=c.default.PassThrough,V=function(a,b){let c=new T(b).hostname,d=new T(a).hostname;return c===d||"."===c[c.length-d.length-1]&&c.endsWith(d)};function W(a,b){if(!W.Promise)throw Error("native promise missing, set fetch.Promise to your favorite alternative");return p.Promise=W.Promise,new W.Promise(function(e,f){var i,j;let k,l,n,o=new R(a,b),p=function(a){let b,d,e=a[K].parsedURL,f=new C(a[K].headers);if(f.has("Accept")||f.set("Accept","*/*"),!e.protocol||!e.hostname)throw TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(e.protocol))throw TypeError("Only HTTP(S) protocols are supported");if(a.signal&&a.body instanceof c.default.Readable&&!P)throw Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let g=null;if(null==a.body&&/^(POST|PUT)$/i.test(a.method)&&(g="0"),null!=a.body){let b=v(a);"number"==typeof b&&(g=String(b))}g&&f.set("Content-Length",g),f.has("User-Agent")||f.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),a.compress&&!f.has("Accept-Encoding")&&f.set("Accept-Encoding","gzip,deflate");let h=a.agent;return"function"==typeof h&&(h=h(e)),Object.assign({},e,{method:a.method,headers:(b=Object.assign({__proto__:null},f[B]),void 0!==(d=A(f[B],"Host"))&&(b[d]=b[d][0]),b),agent:h})}(o),q=("https:"===p.protocol?g.default:d.default).request,r=o.signal,t=null,u=function(){let a=new S("The user aborted a request.");f(a),o.body&&o.body instanceof c.default.Readable&&X(o.body,a),t&&t.body&&t.body.emit("error",a)};if(r&&r.aborted)return void u();let y=function(){u(),D()},z=q(p);function D(){z.abort(),r&&r.removeEventListener("abort",y),clearTimeout(l)}r&&r.addEventListener("abort",y),o.timeout&&z.once("socket",function(a){l=setTimeout(function(){f(new m(`network timeout at: ${o.url}`,"request-timeout")),D()},o.timeout)}),z.on("error",function(a){f(new m(`request to ${o.url} failed, reason: ${a.message}`,"system",a)),t&&t.body&&X(t.body,a),D()}),i=z,j=function(a){(!r||!r.aborted)&&t&&t.body&&X(t.body,a)},i.on("socket",function(a){k=a}),i.on("response",function(a){let b=a.headers;"chunked"!==b["transfer-encoding"]||b["content-length"]||a.once("close",function(a){if(k&&k.listenerCount("data")>0&&!a){let a=Error("Premature close");a.code="ERR_STREAM_PREMATURE_CLOSE",j(a)}})}),14>parseInt(process.version.substring(1))&&z.on("socket",function(a){a.addListener("close",function(b){let c=a.listenerCount("data")>0;if(t&&c&&!b&&!(r&&r.aborted)){let a=Error("Premature close");a.code="ERR_STREAM_PREMATURE_CLOSE",t.body.emit("error",a)}})}),z.on("response",function(a){clearTimeout(l);let b=function(a){let b=new C;for(let c of Object.keys(a))if(!w.test(c))if(Array.isArray(a[c]))for(let d of a[c])x.test(d)||(void 0===b[B][c]?b[B][c]=[d]:b[B][c].push(d));else x.test(a[c])||(b[B][c]=[a[c]]);return b}(a.headers);if(W.isRedirect(a.statusCode)){let d=b.get("Location"),g=null;try{g=null===d?null:new T(d,o.url).toString()}catch(a){if("manual"!==o.redirect){f(new m(`uri requested responds with an invalid redirect URL: ${d}`,"invalid-redirect")),D();return}}switch(o.redirect){case"error":f(new m(`uri requested responds with a redirect, redirect mode is set to error: ${o.url}`,"no-redirect")),D();return;case"manual":if(null!==g)try{b.set("Location",g)}catch(a){f(a)}break;case"follow":var c;if(null===g)break;if(o.counter>=o.follow){f(new m(`maximum redirect reached at: ${o.url}`,"max-redirect")),D();return}let h={headers:new C(o.headers),follow:o.follow,counter:o.counter+1,agent:o.agent,compress:o.compress,method:o.method,body:o.body,signal:o.signal,timeout:o.timeout,size:o.size};if(!V(o.url,g)||(c=o.url,new T(g).protocol!==new T(c).protocol))for(let a of["authorization","www-authenticate","cookie","cookie2"])h.headers.delete(a);if(303!==a.statusCode&&o.body&&null===v(o)){f(new m("Cannot follow redirect with body being a readable stream","unsupported-redirect")),D();return}(303===a.statusCode||(301===a.statusCode||302===a.statusCode)&&"POST"===o.method)&&(h.method="GET",h.body=void 0,h.headers.delete("content-length")),e(W(new R(g,h))),D();return}}a.once("end",function(){r&&r.removeEventListener("abort",y)});let d=a.pipe(new U),g={url:o.url,status:a.statusCode,statusText:a.statusMessage,headers:b,size:o.size,timeout:o.timeout,counter:o.counter},i=b.get("Content-Encoding");if(!o.compress||"HEAD"===o.method||null===i||204===a.statusCode||304===a.statusCode)return void e(t=new J(d,g));let j={flush:h.default.Z_SYNC_FLUSH,finishFlush:h.default.Z_SYNC_FLUSH};if("gzip"==i||"x-gzip"==i)return void e(t=new J(d=d.pipe(h.default.createGunzip(j)),g));if("deflate"==i||"x-deflate"==i){let b=a.pipe(new U);b.once("data",function(a){e(t=new J(d=(15&a[0])==8?d.pipe(h.default.createInflate()):d.pipe(h.default.createInflateRaw()),g))}),b.on("end",function(){t||e(t=new J(d,g))});return}"br"==i&&"function"==typeof h.default.createBrotliDecompress?e(t=new J(d=d.pipe(h.default.createBrotliDecompress()),g)):e(t=new J(d,g))}),null===(n=o.body)?z.end():s(n)?n.stream().pipe(z):Buffer.isBuffer(n)?(z.write(n),z.end()):n.pipe(z)})}function X(a,b){a.destroy?a.destroy(b):(a.emit("error",b),a.end())}W.isRedirect=function(a){return 301===a||302===a||303===a||307===a||308===a},W.Promise=a.g.Promise,a.s(["AbortError",()=>S,"FetchError",()=>m,"Headers",()=>C,"Request",()=>R,"Response",()=>J,"default",0,W])},57903,(a,b,c)=>{let d=a.r(18210),e=d.default||d,f=function(a,b){return/^\/\//.test(a)&&(a="https:"+a),e.call(this,a,b)};f.ponyfill=!0,b.exports=c=f,c.fetch=f,c.Headers=d.Headers,c.Request=d.Request,c.Response=d.Response,c.default=f},16056,(a,b,c)=>{function d(a,b){var c=!1,d=this;return Promise.all(a.map(function(){var a=arguments;return d(function(){if(!c)return b.apply(void 0,a).catch(function(a){throw c=!0,a})})}))}function e(a){return a.queue=0,a.map=d,a}b.exports=function(a){return a?e(function(a){var b=0,c=[];function d(){var d;--b<a&&(d=c.shift(),f.queue=c.length,d&&e(d.fn).then(d.resolve).catch(d.reject))}function e(a){b++;try{return Promise.resolve(a()).then(function(a){return d(),a},function(a){throw d(),a})}catch(a){return d(),Promise.reject(a)}}var f=function(d){return b>=a?new Promise(function(a,b){c.push({fn:d,resolve:a,reject:b}),f.queue=c.length}):e(d)};return f}(a)):e(function(a){return a()})}},44978,a=>{"use strict";let b,c;var d=a.i(7997);class e extends Error{code;extendedCode;rawCode;constructor(a,b,c,d,e){void 0!==b&&(a=`${b}: ${a}`),super(a,{cause:e}),this.code=b,this.extendedCode=c,this.rawCode=d,this.name="LibsqlError"}}class f extends e{statementIndex;constructor(a,b,c,d,e,f){super(a,c,d,e,f),this.statementIndex=b,this.name="LibsqlBatchError"}}let g=RegExp("^(?<scheme>[A-Za-z][A-Za-z.+-]*):(//(?<authority>[^/?#]*))?(?<path>[^?#]*)(\\?(?<query>[^#]*))?(#(?<fragment>.*))?$","su"),h=RegExp("^((?<username>[^:]*)(:(?<password>.*))?@)?((?<host>[^:\\[\\]]*)|(\\[(?<host_br>[^\\[\\]]*)\\]))(:(?<port>[0-9]*))?$","su");function i(a){try{return decodeURIComponent(a)}catch(a){if(a instanceof URIError)throw new e(`URL component has invalid percent encoding: ${a}`,"URL_INVALID",void 0,void 0,a);throw a}}function j(a,b,c){var d,f;if(void 0===b)throw new e(`URL with scheme ${JSON.stringify(a+":")} requires authority (the "//" part)`,"URL_INVALID");let g=`${a}:`,h=(d=b.host).includes(":")?`[${encodeURI(d)}]`:encodeURI(d),i=void 0!==(f=b.port)?`:${f}`:"",j=function(a){if(void 0===a)return"";let b=encodeURIComponent(a.username),c=void 0!==a.password?`:${encodeURIComponent(a.password)}`:"";return`${b}${c}@`}(b.userinfo),k=`//${j}${h}${i}`,l=c.split("/").map(encodeURIComponent).join("/");return""===l||l.startsWith("/")||(l="/"+l),new URL(`${g}${k}${l}`)}let k="function"==typeof Buffer,l="function"==typeof TextDecoder?new TextDecoder:void 0,m="function"==typeof TextEncoder?new TextEncoder:void 0,n=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),o=(c={},n.forEach((a,b)=>c[a]=b),c),p=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,q=String.fromCharCode.bind(String),r="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):a=>new Uint8Array(Array.prototype.slice.call(a,0)),s=a=>a.replace(/=/g,"").replace(/[+\/]/g,a=>"+"==a?"-":"_"),t="function"==typeof btoa?a=>btoa(a):k?a=>Buffer.from(a,"binary").toString("base64"):a=>{let b,c,d,e,f="",g=a.length%3;for(let g=0;g<a.length;){if((c=a.charCodeAt(g++))>255||(d=a.charCodeAt(g++))>255||(e=a.charCodeAt(g++))>255)throw TypeError("invalid character found");f+=n[(b=c<<16|d<<8|e)>>18&63]+n[b>>12&63]+n[b>>6&63]+n[63&b]}return g?f.slice(0,g-3)+"===".substring(g):f},u=k?a=>Buffer.from(a).toString("base64"):a=>{let b=[];for(let c=0,d=a.length;c<d;c+=4096)b.push(q.apply(null,a.subarray(c,c+4096)));return t(b.join(""))},v=(a,b=!1)=>b?s(u(a)):u(a),w=a=>{if(a.length<2){var b=a.charCodeAt(0);return b<128?a:b<2048?q(192|b>>>6)+q(128|63&b):q(224|b>>>12&15)+q(128|b>>>6&63)+q(128|63&b)}var b=65536+(a.charCodeAt(0)-55296)*1024+(a.charCodeAt(1)-56320);return q(240|b>>>18&7)+q(128|b>>>12&63)+q(128|b>>>6&63)+q(128|63&b)},x=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,y=k?a=>Buffer.from(a,"utf8").toString("base64"):m?a=>u(m.encode(a)):a=>t(a.replace(x,w)),z=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,A=a=>{switch(a.length){case 4:var b=((7&a.charCodeAt(0))<<18|(63&a.charCodeAt(1))<<12|(63&a.charCodeAt(2))<<6|63&a.charCodeAt(3))-65536;return q((b>>>10)+55296)+q((1023&b)+56320);case 3:return q((15&a.charCodeAt(0))<<12|(63&a.charCodeAt(1))<<6|63&a.charCodeAt(2));default:return q((31&a.charCodeAt(0))<<6|63&a.charCodeAt(1))}},B="function"==typeof atob?a=>atob(a.replace(/[^A-Za-z0-9\+\/]/g,"")):k?a=>Buffer.from(a,"base64").toString("binary"):a=>{let b,c,d;if(a=a.replace(/\s+/g,""),!p.test(a))throw TypeError("malformed base64.");a+="==".slice(2-(3&a.length));let e=[];for(let f=0;f<a.length;)b=o[a.charAt(f++)]<<18|o[a.charAt(f++)]<<12|(c=o[a.charAt(f++)])<<6|(d=o[a.charAt(f++)]),64===c?e.push(q(b>>16&255)):64===d?e.push(q(b>>16&255,b>>8&255)):e.push(q(b>>16&255,b>>8&255,255&b));return e.join("")},C=k?a=>r(Buffer.from(a,"base64")):a=>r(B(a).split("").map(a=>a.charCodeAt(0))),D=a=>C(F(a)),E=k?a=>Buffer.from(a,"base64").toString("utf8"):l?a=>l.decode(C(a)):a=>B(a).replace(z,A),F=a=>a.replace(/[-_]/g,a=>"-"==a?"+":"/").replace(/[^A-Za-z0-9\+\/]/g,""),G="https://github.com/libsql/libsql-client-ts#supported-urls";function H(a){if("write"===a)return"BEGIN IMMEDIATE";if("read"===a)return"BEGIN TRANSACTION READONLY";if("deferred"===a)return"BEGIN DEFERRED";throw RangeError('Unknown transaction mode, supported values are "write", "read" and "deferred"')}class I{columns;columnTypes;rows;rowsAffected;lastInsertRowid;constructor(a,b,c,d,e){this.columns=a,this.columnTypes=b,this.rows=c,this.rowsAffected=d,this.lastInsertRowid=e}toJSON(){return{columns:this.columns,columnTypes:this.columnTypes,rows:this.rows.map(J),rowsAffected:this.rowsAffected,lastInsertRowid:void 0!==this.lastInsertRowid?""+this.lastInsertRowid:null}}}function J(a){return Array.prototype.map.call(a,K)}function K(a){return"bigint"==typeof a?""+a:a instanceof ArrayBuffer?v(new Uint8Array(a)):a}let L=":memory:";a.i(16816),a.i(23852),a.i(21819);var M=a.i(73253);a.i(72513),M.default;class N{constructor(){this.intMode="number"}intMode}class O extends Error{constructor(a){super(a),this.name="ClientError"}}class P extends O{constructor(a){super(a),this.name="ProtoError"}}class Q extends O{code;proto;constructor(a,b){super(a),this.name="ResponseError",this.code=b.code,this.proto=b,this.stack=void 0}}class R extends O{constructor(a,b){void 0!==b?(super(`${a}: ${b}`),this.cause=b):super(a),this.name="ClosedError"}}class S extends O{constructor(a){super(a),this.name="WebSocketUnsupportedError"}}class T extends O{constructor(a){super(a),this.name="WebSocketError"}}class U extends O{status;constructor(a,b){super(a),this.status=b,this.name="HttpServerError"}}class V extends O{constructor(a){super(a),this.name="ProtocolVersionError"}}class W extends O{constructor(a){super(a),this.name="InternalError"}}class X extends O{constructor(a){super(a),this.name="MisuseError"}}function Y(a){if("string"==typeof a)return a;throw ad(a,"string")}function Z(a){if(null!=a){if("string"==typeof a)return a;throw ad(a,"string or null")}}function $(a){if("number"==typeof a)return a;throw ad(a,"number")}function _(a){if("boolean"==typeof a)return a;throw ad(a,"boolean")}function aa(a){if(Array.isArray(a))return a;throw ad(a,"array")}function ab(a){if(null!==a&&"object"==typeof a&&!Array.isArray(a))return a;throw ad(a,"object")}function ac(a,b){return aa(a).map(a=>b(ab(a)))}function ad(a,b){if(void 0===a)return new P(`Expected ${b}, but the property was missing`);let c=typeof a;return null===a?c="null":Array.isArray(a)&&(c="array"),new P(`Expected ${b}, received ${c}`)}class ae{#a;#b;constructor(a){this.#a=a,this.#b=!1}begin(){this.#a.push("{"),this.#b=!0}end(){this.#a.push("}"),this.#b=!1}#c(a){this.#b?(this.#a.push('"'),this.#b=!1):this.#a.push(',"'),this.#a.push(a),this.#a.push('":')}string(a,b){this.#c(a),this.#a.push(JSON.stringify(b))}stringRaw(a,b){this.#c(a),this.#a.push('"'),this.#a.push(b),this.#a.push('"')}number(a,b){this.#c(a),this.#a.push(""+b)}boolean(a,b){this.#c(a),this.#a.push(b?"true":"false")}object(a,b,c){this.#c(a),this.begin(),c(this,b),this.end()}arrayObjects(a,b,c){this.#c(a),this.#a.push("[");for(let a=0;a<b.length;++a)0!==a&&this.#a.push(","),this.begin(),c(this,b[a]),this.end();this.#a.push("]")}}function af(a,b){let c=[],d=new ae(c);return d.begin(),b(d,a),d.end(),c.join("")}class ag{#d;#e;#f;constructor(a){this.#d=a,this.#e=new DataView(a.buffer,a.byteOffset,a.byteLength),this.#f=0}varint(){let a=0;for(let b=0;;b+=7){let c=this.#d[this.#f++];if(a|=(127&c)<<b,!(128&c))break}return a}varintBig(){let a=0n;for(let b=0n;;b+=7n){let c=this.#d[this.#f++];if(a|=BigInt(127&c)<<b,!(128&c))break}return a}bytes(a){let b=new Uint8Array(this.#d.buffer,this.#d.byteOffset+this.#f,a);return this.#f+=a,b}double(){let a=this.#e.getFloat64(this.#f,!0);return this.#f+=8,a}skipVarint(){for(;128&this.#d[this.#f++];);}skip(a){this.#f+=a}eof(){return this.#f>=this.#d.byteLength}}class ah{#g;#h;constructor(a){this.#g=a,this.#h=-1}setup(a){this.#h=a}#i(a){if(this.#h!==a)throw new P(`Expected wire type ${a}, got ${this.#h}`);this.#h=-1}bytes(){this.#i(2);let a=this.#g.varint();return this.#g.bytes(a)}string(){return new TextDecoder().decode(this.bytes())}message(a){return ai(this.bytes(),a)}int32(){return this.#i(0),this.#g.varint()}uint32(){return this.int32()}bool(){return 0!==this.int32()}uint64(){return this.#i(0),this.#g.varintBig()}sint64(){let a=this.uint64();return a>>1n^-(1n&a)}double(){return this.#i(1),this.#g.double()}maybeSkip(){if(!(this.#h<0)){if(0===this.#h)this.#g.skipVarint();else if(1===this.#h)this.#g.skip(8);else if(2===this.#h){let a=this.#g.varint();this.#g.skip(a)}else if(5===this.#h)this.#g.skip(4);else throw new P(`Unexpected wire type ${this.#h}`);this.#h=-1}}}function ai(a,b){let c=new ag(a),d=new ah(c),e=b.default();for(;!c.eof();){let a=c.varint(),f=a>>3,g=7&a;d.setup(g);let h=b[f];if(void 0!==h){let a=h(d,e);void 0!==a&&(e=a)}d.maybeSkip()}return e}class aj{#j;#d;#e;#f;constructor(){this.#j=new ArrayBuffer(256),this.#d=new Uint8Array(this.#j),this.#e=new DataView(this.#j),this.#f=0}#k(a){if(this.#f+a<=this.#j.byteLength)return;let b=this.#j.byteLength;for(;b<this.#f+a;)b*=2;let c=new ArrayBuffer(b),d=new Uint8Array(c),e=new DataView(c);d.set(new Uint8Array(this.#j,0,this.#f)),this.#j=c,this.#d=d,this.#e=e}#l(a){this.#k(5),a|=0;do{let b=127&a;a>>>=7,b|=128*!!a,this.#d[this.#f++]=b}while(a)}#m(a){this.#k(10),a&=0xffffffffffffffffn;do{let b=Number(127n&a);a>>=7n,b|=128*!!a,this.#d[this.#f++]=b}while(a)}#n(a,b){this.#l(a<<3|b)}bytes(a,b){this.#n(a,2),this.#l(b.byteLength),this.#k(b.byteLength),this.#d.set(b,this.#f),this.#f+=b.byteLength}string(a,b){this.bytes(a,new TextEncoder().encode(b))}message(a,b,c){let d=new aj;c(d,b),this.bytes(a,d.data())}int32(a,b){this.#n(a,0),this.#l(b)}uint32(a,b){this.int32(a,b)}bool(a,b){this.int32(a,+!!b)}sint64(a,b){this.#n(a,0),this.#m(b<<1n^b>>63n)}double(a,b){this.#n(a,1),this.#k(8),this.#e.setFloat64(this.#f,b,!0),this.#f+=8}data(){return new Uint8Array(this.#j,0,this.#f)}}function ak(a,b){let c=new aj;return b(c,a),c.data()}class al{#o;#p;constructor(){this.#o=new Set,this.#p=new Set}alloc(){for(let a of this.#p)return this.#p.delete(a),this.#o.add(a),this.#o.has(this.#o.size-1)||this.#p.add(this.#o.size-1),a;let a=this.#o.size;return this.#o.add(a),a}free(a){if(!this.#o.delete(a))throw new W("Freeing an id that is not allocated");this.#p.delete(this.#o.size),a<this.#o.size&&this.#p.add(a)}}function am(a,b){throw new W(b)}function an(a){if(null===a)return null;if("string"==typeof a)return a;if("number"==typeof a){if(!Number.isFinite(a))throw RangeError("Only finite numbers (not Infinity or NaN) can be passed as arguments");return a}if("bigint"==typeof a){if(a<ao||a>ap)throw RangeError("This bigint value is too large to be represented as a 64-bit integer and passed as argument");return a}if("boolean"==typeof a)return a?1n:0n;else if(a instanceof ArrayBuffer)return new Uint8Array(a);else if(a instanceof Uint8Array)return a;else if(a instanceof Date)return+a.valueOf();else if("object"==typeof a)return""+a.toString();else throw TypeError("Unsupported type of value")}let ao=-0x8000000000000000n,ap=0x7fffffffffffffffn;function aq(a,b){if(null===a)return null;if("number"==typeof a)return a;if("string"==typeof a)return a;if("bigint"==typeof a)if("number"===b){let b=Number(a);if(!Number.isSafeInteger(b))throw RangeError("Received integer which is too large to be safely represented as a JavaScript number");return b}else if("bigint"===b)return a;else if("string"===b)return""+a;else throw new X("Invalid value for IntMode");if(a instanceof Uint8Array)return a.slice().buffer;else if(void 0===a)throw new P("Received unrecognized type of Value");else throw am(a,"Impossible type of Value")}function ar(a){return{affectedRowCount:a.affectedRowCount,lastInsertRowid:a.lastInsertRowid,columnNames:a.cols.map(a=>a.name),columnDecltypes:a.cols.map(a=>a.decltype)}}function as(a,b){let c=ar(a),d=a.rows.map(a=>av(c.columnNames,a,b));return{...c,rows:d}}function at(a,b){let c,d=ar(a);return a.rows.length>0&&(c=av(d.columnNames,a.rows[0],b)),{...d,row:c}}function au(a,b){let c,d=ar(a);return a.rows.length>0&&d.columnNames.length>0&&(c=aq(a.rows[0][0],b)),{...d,value:c}}function av(a,b,c){let d={};Object.defineProperty(d,"length",{value:b.length});for(let e=0;e<b.length;++e){let f=aq(b[e],c);Object.defineProperty(d,e,{value:f});let g=a[e];void 0===g||Object.hasOwn(d,g)||Object.defineProperty(d,g,{value:f,enumerable:!0,configurable:!0,writable:!0})}return d}function aw(a){return new Q(a.message,a)}class ax{#q;#r;#s;constructor(a,b){this.#q=a,this.#r=b,this.#s=void 0}_getSqlId(a){if(this.#q!==a)throw new X("Attempted to use SQL text opened with other object");if(void 0!==this.#s)throw new R("SQL text is closed",this.#s);return this.#r}close(){this._setClosed(new O("SQL text was manually closed"))}_setClosed(a){void 0===this.#s&&(this.#s=a,this.#q._closeSql(this.#r))}get closed(){return void 0!==this.#s}}function ay(a,b){return b instanceof ax?{sqlId:b._getSqlId(a)}:{sql:""+b}}class az{#t;#u;constructor(){this.#t=[],this.#u=[]}get length(){return this.#t.length+this.#u.length}push(a){this.#t.push(a)}shift(){return 0===this.#u.length&&this.#t.length>0&&(this.#u=this.#t.reverse(),this.#t=[]),this.#u.pop()}first(){return 0!==this.#u.length?this.#u[this.#u.length-1]:this.#t[0]}}class aA{sql;_args;_namedArgs;constructor(a){this.sql=a,this._args=[],this._namedArgs=new Map}bindIndexes(a){for(let b of(this._args.length=0,a))this._args.push(an(b));return this}bindIndex(a,b){if(a!==(0|a)||a<=0)throw RangeError("Index of a positional argument must be positive integer");for(;this._args.length<a;)this._args.push(null);return this._args[a-1]=an(b),this}bindName(a,b){return this._namedArgs.set(a,an(b)),this}unbindAll(){return this._args.length=0,this._namedArgs.clear(),this}}function aB(a,b,c){let d,e=[],f=[];if(b instanceof aA)for(let[a,c]of(d=b.sql,e=b._args,b._namedArgs.entries()))f.push({name:a,value:c});else Array.isArray(b)?(d=b[0],Array.isArray(b[1])?e=b[1].map(a=>an(a)):f=Object.entries(b[1]).map(([a,b])=>({name:a,value:an(b)}))):d=b;let{sql:g,sqlId:h}=ay(a,d);return{sql:g,sqlId:h,args:e,namedArgs:f,wantRows:c}}class aC{_stream;#v;_steps;#w;constructor(a,b){this._stream=a,this.#v=b,this._steps=[],this.#w=!1}step(){return new aE(this)}execute(){var a,b,c;if(this.#w)throw new X("This batch has already been executed");this.#w=!0;let d={steps:this._steps.map(a=>a.proto)};return this.#v?aD(this._stream,this._steps,d):(a=this._stream,b=this._steps,c=d,a._batch(c).then(a=>{for(let c=0;c<b.length;++c){let d=a.stepResults.get(c),e=a.stepErrors.get(c);b[c].callback(d,e)}}))}}async function aD(a,b,c){let d=await a._openCursor(c);try{let a,c=0,e=[];for(;;){let f=await d.next();if(void 0===f)break;if("step_begin"===f.type){if(f.step<c||f.step>=b.length)throw new P("Server produced StepBeginEntry for unexpected step");if(void 0!==a)throw new P("Server produced StepBeginEntry before terminating previous step");for(let a=c;a<f.step;++a)b[a].callback(void 0,void 0);c=f.step+1,a=f,e=[]}else if("step_end"===f.type){if(void 0===a)throw new P("Server produced StepEndEntry but no step is active");let c={cols:a.cols,rows:e,affectedRowCount:f.affectedRowCount,lastInsertRowid:f.lastInsertRowid};b[a.step].callback(c,void 0),a=void 0,e=[]}else if("step_error"===f.type){if(void 0===a){if(f.step>=b.length)throw new P("Server produced StepErrorEntry for unexpected step");for(let a=c;a<f.step;++a)b[a].callback(void 0,void 0)}else{if(f.step!==a.step)throw new P("Server produced StepErrorEntry for unexpected step");a=void 0,e=[]}b[f.step].callback(void 0,f.error),c=f.step+1}else if("row"===f.type){if(void 0===a)throw new P("Server produced RowEntry but no step is active");e.push(f.row)}else if("error"===f.type)throw aw(f.error);else if("none"===f.type)throw new P("Server produced unrecognized CursorEntry");else throw am(f,"Impossible CursorEntry")}if(void 0!==a)throw new P("Server closed Cursor before terminating active step");for(let a=c;a<b.length;++a)b[a].callback(void 0,void 0)}finally{d.close()}}class aE{_batch;#x;_index;constructor(a){this._batch=a,this.#x=[],this._index=void 0}condition(a){return this.#x.push(a._proto),this}query(a){return this.#y(a,!0,as)}queryRow(a){return this.#y(a,!0,at)}queryValue(a){return this.#y(a,!0,au)}run(a){return this.#y(a,!1,ar)}#y(a,b,c){if(void 0!==this._index)throw new X("This BatchStep has already been added to the batch");let d={stmt:aB(this._batch._stream._sqlOwner(),a,b),condition:0===this.#x.length?void 0:1===this.#x.length?this.#x[0]:{type:"and",conds:this.#x.slice()}};return new Promise((a,b)=>{let e=(d,e)=>{void 0!==d&&void 0!==e?b(new P("Server returned both result and error")):void 0!==e?b(aw(e)):void 0!==d?a(c(d,this._batch._stream.intMode)):a(void 0)};this._index=this._batch._steps.length,this._batch._steps.push({proto:d,callback:e})})}}class aF{_batch;_proto;constructor(a,b){this._batch=a,this._proto=b}static ok(a){return new aF(a._batch,{type:"ok",step:aG(a)})}static error(a){return new aF(a._batch,{type:"error",step:aG(a)})}static not(a){return new aF(a._batch,{type:"not",cond:a._proto})}static and(a,b){for(let c of b)aH(a,c);return new aF(a,{type:"and",conds:b.map(a=>a._proto)})}static or(a,b){for(let c of b)aH(a,c);return new aF(a,{type:"or",conds:b.map(a=>a._proto)})}static isAutocommit(a){return a._stream.client()._ensureVersion(3,"BatchCond.isAutocommit()"),new aF(a,{type:"is_autocommit"})}}function aG(a){if(void 0===a._index)throw new X("Cannot add a condition referencing a step that has not been added to the batch");return a._index}function aH(a,b){if(b._batch!==a)throw new X("Cannot mix BatchCond objects for different Batch objects")}function aI(a){return{paramNames:a.params.map(a=>a.name),columns:a.cols,isExplain:a.isExplain,isReadonly:a.isReadonly}}class aJ{constructor(a){this.intMode=a}query(a){return this.#z(a,!0,as)}queryRow(a){return this.#z(a,!0,at)}queryValue(a){return this.#z(a,!0,au)}run(a){return this.#z(a,!1,ar)}#z(a,b,c){let d=aB(this._sqlOwner(),a,b);return this._execute(d).then(a=>c(a,this.intMode))}batch(a=!1){return new aC(this,a)}describe(a){let b=ay(this._sqlOwner(),a);return this._describe(b).then(aI)}sequence(a){let b=ay(this._sqlOwner(),a);return this._sequence(b)}intMode}class aK{}class aL extends aK{#A;#B;#C;#D;#E;#s;#F;constructor(a,b,c){super(),this.#A=a,this.#B=b,this.#C=c,this.#D=new az,this.#E=new az,this.#s=void 0,this.#F=!1}async next(){for(;;){if(void 0!==this.#s)throw new R("Cursor is closed",this.#s);for(;!this.#F&&this.#E.length<10;)this.#E.push(this.#G());let a=this.#D.shift();if(this.#F||void 0!==a)return a;await this.#E.shift().then(a=>{if(void 0!==a){for(let b of a.entries)this.#D.push(b);this.#F||=a.done}})}}#G(){return this.#B._sendCursorRequest(this,{type:"fetch_cursor",cursorId:this.#C,maxCount:1e3}).then(a=>a,a=>{this._setClosed(a)})}_setClosed(a){void 0===this.#s&&(this.#s=a,this.#B._sendCursorRequest(this,{type:"close_cursor",cursorId:this.#C}).catch(()=>void 0),this.#B._cursorClosed(this))}close(){this._setClosed(new O("Cursor was manually closed"))}get closed(){return void 0!==this.#s}}class aM extends aJ{#A;#H;#I;#J;#K;#s;static open(a){let b=a._streamIdAlloc.alloc(),c=new aM(a,b);return a._sendRequest({type:"open_stream",streamId:b},{responseCallback:()=>void 0,errorCallback:a=>c.#L(a)}),c}constructor(a,b){super(a.intMode),this.#A=a,this.#H=b,this.#I=new az,this.#J=void 0,this.#K=!1,this.#s=void 0}client(){return this.#A}_sqlOwner(){return this.#A}_execute(a){return this.#M({type:"execute",streamId:this.#H,stmt:a}).then(a=>a.result)}_batch(a){return this.#M({type:"batch",streamId:this.#H,batch:a}).then(a=>a.result)}_describe(a){return this.#A._ensureVersion(2,"describe()"),this.#M({type:"describe",streamId:this.#H,sql:a.sql,sqlId:a.sqlId}).then(a=>a.result)}_sequence(a){return this.#A._ensureVersion(2,"sequence()"),this.#M({type:"sequence",streamId:this.#H,sql:a.sql,sqlId:a.sqlId}).then(a=>{})}getAutocommit(){return this.#A._ensureVersion(3,"getAutocommit()"),this.#M({type:"get_autocommit",streamId:this.#H}).then(a=>a.isAutocommit)}#M(a){return new Promise((b,c)=>{this.#N({type:"request",request:a,responseCallback:b,errorCallback:c})})}_openCursor(a){return this.#A._ensureVersion(3,"cursor"),new Promise((b,c)=>{this.#N({type:"cursor",batch:a,cursorCallback:b,errorCallback:c})})}_sendCursorRequest(a,b){if(a!==this.#J)throw new W("Cursor not associated with the stream attempted to execute a request");return new Promise((a,c)=>{void 0!==this.#s?c(new R("Stream is closed",this.#s)):this.#A._sendRequest(b,{responseCallback:a,errorCallback:c})})}_cursorClosed(a){if(a!==this.#J)throw new W("Cursor was closed, but it was not associated with the stream");this.#J=void 0,this.#O()}#N(a){void 0!==this.#s?a.errorCallback(new R("Stream is closed",this.#s)):this.#K?a.errorCallback(new R("Stream is closing",void 0)):(this.#I.push(a),this.#O())}#O(){for(;;){let a=this.#I.first();if(void 0===a&&void 0===this.#J&&this.#K){this.#L(new O("Stream was gracefully closed"));break}if(a?.type==="request"&&void 0===this.#J){let{request:b,responseCallback:c,errorCallback:d}=a;this.#I.shift(),this.#A._sendRequest(b,{responseCallback:c,errorCallback:d})}else if(a?.type==="cursor"&&void 0===this.#J){let{batch:b,cursorCallback:c}=a;this.#I.shift();let d=this.#A._cursorIdAlloc.alloc(),e=new aL(this.#A,this,d),f={type:"open_cursor",streamId:this.#H,cursorId:d,batch:b},g=()=>void 0,h=a=>e._setClosed(a);this.#A._sendRequest(f,{responseCallback:g,errorCallback:h}),this.#J=e,c(e)}else break}}#L(a){if(void 0!==this.#s)return;for(this.#s=a,void 0!==this.#J&&this.#J._setClosed(a);;){let b=this.#I.shift();if(void 0!==b)b.errorCallback(a);else break}let b={type:"close_stream",streamId:this.#H},c=()=>this.#A._streamIdAlloc.free(this.#H);this.#A._sendRequest(b,{responseCallback:c,errorCallback:()=>void 0})}close(){this.#L(new O("Stream was manually closed"))}closeGracefully(){this.#K=!0,this.#O()}get closed(){return void 0!==this.#s||this.#K}}function aN(a,b){void 0!==b.sql&&a.string("sql",b.sql),void 0!==b.sqlId&&a.number("sql_id",b.sqlId),a.arrayObjects("args",b.args,aS),a.arrayObjects("named_args",b.namedArgs,aO),a.boolean("want_rows",b.wantRows)}function aO(a,b){a.string("name",b.name),a.object("value",b.value,aS)}function aP(a,b){a.arrayObjects("steps",b.steps,aQ)}function aQ(a,b){void 0!==b.condition&&a.object("condition",b.condition,aR),a.object("stmt",b.stmt,aN)}function aR(a,b){if(a.stringRaw("type",b.type),"ok"===b.type||"error"===b.type)a.number("step",b.step);else if("not"===b.type)a.object("cond",b.cond,aR);else if("and"===b.type||"or"===b.type)a.arrayObjects("conds",b.conds,aR);else if("is_autocommit"===b.type);else throw am(b,"Impossible type of BatchCond")}function aS(a,b){if(null===b)a.stringRaw("type","null");else if("bigint"==typeof b)a.stringRaw("type","integer"),a.stringRaw("value",""+b);else if("number"==typeof b)a.stringRaw("type","float"),a.number("value",b);else if("string"==typeof b)a.stringRaw("type","text"),a.string("value",b);else if(b instanceof Uint8Array)a.stringRaw("type","blob"),a.stringRaw("base64",v(b));else if(void 0===b);else throw am(b,"Impossible type of Value")}function aT(a,b){if(a.stringRaw("type",b.type),"hello"===b.type)void 0!==b.jwt&&a.string("jwt",b.jwt);else if("request"===b.type)a.number("request_id",b.requestId),a.object("request",b.request,aU);else throw am(b,"Impossible type of ClientMsg")}function aU(a,b){if(a.stringRaw("type",b.type),"open_stream"===b.type)a.number("stream_id",b.streamId);else if("close_stream"===b.type)a.number("stream_id",b.streamId);else if("execute"===b.type)a.number("stream_id",b.streamId),a.object("stmt",b.stmt,aN);else if("batch"===b.type)a.number("stream_id",b.streamId),a.object("batch",b.batch,aP);else if("open_cursor"===b.type)a.number("stream_id",b.streamId),a.number("cursor_id",b.cursorId),a.object("batch",b.batch,aP);else if("close_cursor"===b.type)a.number("cursor_id",b.cursorId);else if("fetch_cursor"===b.type)a.number("cursor_id",b.cursorId),a.number("max_count",b.maxCount);else if("sequence"===b.type)a.number("stream_id",b.streamId),void 0!==b.sql&&a.string("sql",b.sql),void 0!==b.sqlId&&a.number("sql_id",b.sqlId);else if("describe"===b.type)a.number("stream_id",b.streamId),void 0!==b.sql&&a.string("sql",b.sql),void 0!==b.sqlId&&a.number("sql_id",b.sqlId);else if("store_sql"===b.type)a.number("sql_id",b.sqlId),a.string("sql",b.sql);else if("close_sql"===b.type)a.number("sql_id",b.sqlId);else if("get_autocommit"===b.type)a.number("stream_id",b.streamId);else throw am(b,"Impossible type of Request")}function aV(a,b){for(let c of(void 0!==b.sql&&a.string(1,b.sql),void 0!==b.sqlId&&a.int32(2,b.sqlId),b.args))a.message(3,c,a_);for(let c of b.namedArgs)a.message(4,c,aW);a.bool(5,b.wantRows)}function aW(a,b){a.string(1,b.name),a.message(2,b.value,a_)}function aX(a,b){for(let c of b.steps)a.message(1,c,aY)}function aY(a,b){void 0!==b.condition&&a.message(1,b.condition,aZ),a.message(2,b.stmt,aV)}function aZ(a,b){if("ok"===b.type)a.uint32(1,b.step);else if("error"===b.type)a.uint32(2,b.step);else if("not"===b.type)a.message(3,b.cond,aZ);else if("and"===b.type)a.message(4,b.conds,a$);else if("or"===b.type)a.message(5,b.conds,a$);else if("is_autocommit"===b.type)a.message(6,void 0,a0);else throw am(b,"Impossible type of BatchCond")}function a$(a,b){for(let c of b)a.message(1,c,aZ)}function a_(a,b){if(null===b)a.message(1,void 0,a0);else if("bigint"==typeof b)a.sint64(2,b);else if("number"==typeof b)a.double(3,b);else if("string"==typeof b)a.string(4,b);else if(b instanceof Uint8Array)a.bytes(5,b);else if(void 0===b);else throw am(b,"Impossible type of Value")}function a0(a,b){}function a1(a,b){if("hello"===b.type)a.message(1,b,a2);else if("request"===b.type)a.message(2,b,a3);else throw am(b,"Impossible type of ClientMsg")}function a2(a,b){void 0!==b.jwt&&a.string(1,b.jwt)}function a3(a,b){a.int32(1,b.requestId);let c=b.request;if("open_stream"===c.type)a.message(2,c,a4);else if("close_stream"===c.type)a.message(3,c,a5);else if("execute"===c.type)a.message(4,c,a6);else if("batch"===c.type)a.message(5,c,a7);else if("open_cursor"===c.type)a.message(6,c,a8);else if("close_cursor"===c.type)a.message(7,c,a9);else if("fetch_cursor"===c.type)a.message(8,c,ba);else if("sequence"===c.type)a.message(9,c,bb);else if("describe"===c.type)a.message(10,c,bc);else if("store_sql"===c.type)a.message(11,c,bd);else if("close_sql"===c.type)a.message(12,c,be);else if("get_autocommit"===c.type)a.message(13,c,bf);else throw am(c,"Impossible type of Request")}function a4(a,b){a.int32(1,b.streamId)}function a5(a,b){a.int32(1,b.streamId)}function a6(a,b){a.int32(1,b.streamId),a.message(2,b.stmt,aV)}function a7(a,b){a.int32(1,b.streamId),a.message(2,b.batch,aX)}function a8(a,b){a.int32(1,b.streamId),a.int32(2,b.cursorId),a.message(3,b.batch,aX)}function a9(a,b){a.int32(1,b.cursorId)}function ba(a,b){a.int32(1,b.cursorId),a.uint32(2,b.maxCount)}function bb(a,b){a.int32(1,b.streamId),void 0!==b.sql&&a.string(2,b.sql),void 0!==b.sqlId&&a.int32(3,b.sqlId)}function bc(a,b){a.int32(1,b.streamId),void 0!==b.sql&&a.string(2,b.sql),void 0!==b.sqlId&&a.int32(3,b.sqlId)}function bd(a,b){a.int32(1,b.sqlId),a.string(2,b.sql)}function be(a,b){a.int32(1,b.sqlId)}function bf(a,b){a.int32(1,b.streamId)}function bg(a){return{message:Y(a.message),code:Z(a.code)}}function bh(a){let b=ac(a.cols,bi),c=aa(a.rows).map(a=>ac(a,bo)),d=$(a.affected_row_count),e=Z(a.last_insert_rowid);return{cols:b,rows:c,affectedRowCount:d,lastInsertRowid:void 0!==e?BigInt(e):void 0}}function bi(a){return{name:Z(a.name),decltype:Z(a.decltype)}}function bj(a){let b=new Map;aa(a.step_results).forEach((a,c)=>{null!==a&&b.set(c,bh(ab(a)))});let c=new Map;return aa(a.step_errors).forEach((a,b)=>{null!==a&&c.set(b,bg(ab(a)))}),{stepResults:b,stepErrors:c}}function bk(a){let b=Y(a.type);if("step_begin"===b)return{type:"step_begin",step:$(a.step),cols:ac(a.cols,bi)};if("step_end"===b){let b=$(a.affected_row_count),c=Z(a.last_insert_rowid);return{type:"step_end",affectedRowCount:b,lastInsertRowid:void 0!==c?BigInt(c):void 0}}if("step_error"===b)return{type:"step_error",step:$(a.step),error:bg(ab(a.error))};if("row"===b)return{type:"row",row:ac(a.row,bo)};if("error"===b)return{type:"error",error:bg(ab(a.error))};else throw new P("Unexpected type of CursorEntry")}function bl(a){let b=ac(a.params,bm),c=ac(a.cols,bn);return{params:b,cols:c,isExplain:_(a.is_explain),isReadonly:_(a.is_readonly)}}function bm(a){return{name:Z(a.name)}}function bn(a){return{name:Y(a.name),decltype:Z(a.decltype)}}function bo(a){let b=Y(a.type);if("null"===b)return null;if("integer"===b)return BigInt(Y(a.value));if("float"===b)return $(a.value);if("text"===b)return Y(a.value);if("blob"===b)return D(Y(a.base64));else throw new P("Unexpected type of Value")}let bp={default:()=>({message:"",code:void 0}),1(a,b){b.message=a.string()},2(a,b){b.code=a.string()}},bq={default:()=>({cols:[],rows:[],affectedRowCount:0,lastInsertRowid:void 0}),1(a,b){b.cols.push(a.message(br))},2(a,b){b.rows.push(a.message(bs))},3(a,b){b.affectedRowCount=Number(a.uint64())},4(a,b){b.lastInsertRowid=a.sint64()}},br={default:()=>({name:void 0,decltype:void 0}),1(a,b){b.name=a.string()},2(a,b){b.decltype=a.string()}},bs={default:()=>[],1(a,b){b.push(a.message(bD))}},bt={default:()=>({stepResults:new Map,stepErrors:new Map}),1(a,b){let[c,d]=a.message(bu);b.stepResults.set(c,d)},2(a,b){let[c,d]=a.message(bv);b.stepErrors.set(c,d)}},bu={default:()=>[0,bq.default()],1(a,b){b[0]=a.uint32()},2(a,b){b[1]=a.message(bq)}},bv={default:()=>[0,bp.default()],1(a,b){b[0]=a.uint32()},2(a,b){b[1]=a.message(bp)}},bw={default:()=>({type:"none"}),1:a=>a.message(bx),2:a=>a.message(by),3:a=>a.message(bz),4:a=>({type:"row",row:a.message(bs)}),5:a=>({type:"error",error:a.message(bp)})},bx={default:()=>({type:"step_begin",step:0,cols:[]}),1(a,b){b.step=a.uint32()},2(a,b){b.cols.push(a.message(br))}},by={default:()=>({type:"step_end",affectedRowCount:0,lastInsertRowid:void 0}),1(a,b){b.affectedRowCount=a.uint32()},2(a,b){b.lastInsertRowid=a.uint64()}},bz={default:()=>({type:"step_error",step:0,error:bp.default()}),1(a,b){b.step=a.uint32()},2(a,b){b.error=a.message(bp)}},bA={default:()=>({params:[],cols:[],isExplain:!1,isReadonly:!1}),1(a,b){b.params.push(a.message(bB))},2(a,b){b.cols.push(a.message(bC))},3(a,b){b.isExplain=a.bool()},4(a,b){b.isReadonly=a.bool()}},bB={default:()=>({name:void 0}),1(a,b){b.name=a.string()}},bC={default:()=>({name:"",decltype:void 0}),1(a,b){b.name=a.string()},2(a,b){b.decltype=a.string()}},bD={default(){},1:a=>null,2:a=>a.sint64(),3:a=>a.double(),4:a=>a.string(),5:a=>a.bytes()},bE={default:()=>({type:"none"}),1:a=>({type:"hello_ok"}),2:a=>a.message(bF),3:a=>a.message(bH),4:a=>a.message(bG)},bF={default:()=>({type:"hello_error",error:bp.default()}),1(a,b){b.error=a.message(bp)}},bG={default:()=>({type:"response_error",requestId:0,error:bp.default()}),1(a,b){b.requestId=a.int32()},2(a,b){b.error=a.message(bp)}},bH={default:()=>({type:"response_ok",requestId:0,response:{type:"none"}}),1(a,b){b.requestId=a.int32()},2(a,b){b.response={type:"open_stream"}},3(a,b){b.response={type:"close_stream"}},4(a,b){b.response=a.message(bI)},5(a,b){b.response=a.message(bJ)},6(a,b){b.response={type:"open_cursor"}},7(a,b){b.response={type:"close_cursor"}},8(a,b){b.response=a.message(bK)},9(a,b){b.response={type:"sequence"}},10(a,b){b.response=a.message(bL)},11(a,b){b.response={type:"store_sql"}},12(a,b){b.response={type:"close_sql"}},13(a,b){b.response=a.message(bM)}},bI={default:()=>({type:"execute",result:bq.default()}),1(a,b){b.result=a.message(bq)}},bJ={default:()=>({type:"batch",result:bt.default()}),1(a,b){b.result=a.message(bt)}},bK={default:()=>({type:"fetch_cursor",entries:[],done:!1}),1(a,b){b.entries.push(a.message(bw))},2(a,b){b.done=a.bool()}},bL={default:()=>({type:"describe",result:bA.default()}),1(a,b){b.result=a.message(bA)}},bM={default:()=>({type:"get_autocommit",isAutocommit:!1}),1(a,b){b.isAutocommit=a.bool()}},bN=new Map([["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]),bO=new Map([["hrana3-protobuf",{version:3,encoding:"protobuf"}],["hrana3",{version:3,encoding:"json"}],["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]);class bP extends N{#P;#Q;#R;#s;#S;#T;#U;#V;#W;_streamIdAlloc;_cursorIdAlloc;#X;constructor(a,b){super(),this.#P=a,this.#Q=[],this.#R=!1,this.#s=void 0,this.#S=!1,this.#T=void 0,this.#U=!1,this.#V=new Map,this.#W=new al,this._streamIdAlloc=new al,this._cursorIdAlloc=new al,this.#X=new al,this.#P.binaryType="arraybuffer",this.#P.addEventListener("open",()=>this.#Y()),this.#P.addEventListener("close",a=>this.#Z(a)),this.#P.addEventListener("error",a=>this.#$(a)),this.#P.addEventListener("message",a=>this.#_(a)),this.#aa({type:"hello",jwt:b})}#aa(a){if(void 0!==this.#s)throw new W("Trying to send a message on a closed client");if(this.#R)this.#ab(a);else{let b=()=>this.#ab(a);this.#Q.push({openCallback:b,errorCallback:()=>void 0})}}#Y(){let a=this.#P.protocol;if(void 0===a)return void this.#L(new O("The `WebSocket.protocol` property is undefined. This most likely means that the WebSocket implementation provided by the environment is broken. If you are using Miniflare 2, please update to Miniflare 3, which fixes this problem."));if(""===a)this.#T={version:1,encoding:"json"};else if(this.#T=bO.get(a),void 0===this.#T)return void this.#L(new P(`Unrecognized WebSocket subprotocol: ${JSON.stringify(a)}`));for(let a of this.#Q)a.openCallback();this.#Q.length=0,this.#R=!0}#ab(a){let b=this.#T.encoding;if("json"===b){let b=af(a,aT);this.#P.send(b)}else if("protobuf"===b){let b=ak(a,a1);this.#P.send(b)}else throw am(b,"Impossible encoding")}getVersion(){return new Promise((a,b)=>{if(this.#U=!0,void 0!==this.#s)b(this.#s);else if(this.#R)a(this.#T.version);else{let c=()=>a(this.#T.version);this.#Q.push({openCallback:c,errorCallback:b})}})}_ensureVersion(a,b){if(void 0!==this.#T&&this.#U){if(this.#T.version<a)throw new V(`${b} is supported on protocol version ${a} and higher, but the WebSocket server only supports version ${this.#T.version}`)}else throw new V(`${b} is supported only on protocol version ${a} and higher, but the version supported by the WebSocket server is not yet known. Use Client.getVersion() to wait until the version is available.`)}_sendRequest(a,b){if(void 0!==this.#s)return void b.errorCallback(new R("Client is closed",this.#s));let c=this.#W.alloc();this.#V.set(c,{...b,type:a.type}),this.#aa({type:"request",requestId:c,request:a})}#$(a){let b=a.message;this.#L(new T(b??"WebSocket was closed due to an error"))}#Z(a){let b=`WebSocket was closed with code ${a.code}`;a.reason&&(b+=`: ${a.reason}`),this.#L(new T(b))}#L(a){if(void 0===this.#s){for(let b of(this.#s=a,this.#Q))b.errorCallback(a);for(let[b,c]of(this.#Q.length=0,this.#V.entries()))c.errorCallback(a),this.#W.free(b);this.#V.clear(),this.#P.close()}}#_(a){if(void 0===this.#s)try{let c,d=this.#T.encoding;if("json"===d){var b;if("string"!=typeof a.data){this.#P.close(3003,"Only text messages are accepted with JSON encoding"),this.#L(new P("Received non-text message from server with JSON encoding"));return}b=JSON.parse(a.data),c=function(a){let b=Y(a.type);if("hello_ok"===b)return{type:"hello_ok"};if("hello_error"===b)return{type:"hello_error",error:bg(ab(a.error))};if("response_ok"===b)return{type:"response_ok",requestId:$(a.request_id),response:function(a){let b=Y(a.type);if("open_stream"===b)return{type:"open_stream"};if("close_stream"===b)return{type:"close_stream"};if("execute"===b)return{type:"execute",result:bh(ab(a.result))};if("batch"===b)return{type:"batch",result:bj(ab(a.result))};if("open_cursor"===b)return{type:"open_cursor"};else if("close_cursor"===b)return{type:"close_cursor"};else if("fetch_cursor"===b)return{type:"fetch_cursor",entries:ac(a.entries,bk),done:_(a.done)};else if("sequence"===b)return{type:"sequence"};else if("describe"===b)return{type:"describe",result:bl(ab(a.result))};else if("store_sql"===b)return{type:"store_sql"};else if("close_sql"===b)return{type:"close_sql"};else if("get_autocommit"===b)return{type:"get_autocommit",isAutocommit:_(a.is_autocommit)};else throw new P("Unexpected type of Response")}(ab(a.response))};if("response_error"===b)return{type:"response_error",requestId:$(a.request_id),error:bg(ab(a.error))};throw new P("Unexpected type of ServerMsg")}(ab(b))}else if("protobuf"===d){if(!(a.data instanceof ArrayBuffer)){this.#P.close(3003,"Only binary messages are accepted with Protobuf encoding"),this.#L(new P("Received non-binary message from server with Protobuf encoding"));return}c=ai(new Uint8Array(a.data),bE)}else throw am(d,"Impossible encoding");this.#ac(c)}catch(a){this.#P.close(3007,"Could not handle message"),this.#L(a)}}#ac(a){if("none"===a.type)throw new P("Received an unrecognized ServerMsg");if("hello_ok"===a.type||"hello_error"===a.type){if(this.#S)throw new P("Received a duplicated hello response");if(this.#S=!0,"hello_error"===a.type)throw aw(a.error);return}if(!this.#S)throw new P("Received a non-hello message before a hello response");if("response_ok"===a.type){let b=a.requestId,c=this.#V.get(b);if(this.#V.delete(b),void 0===c)throw new P("Received unexpected OK response");this.#W.free(b);try{if(c.type!==a.response.type)throw console.dir({responseState:c,msg:a}),new P("Received unexpected type of response");c.responseCallback(a.response)}catch(a){throw c.errorCallback(a),a}}else if("response_error"===a.type){let b=a.requestId,c=this.#V.get(b);if(this.#V.delete(b),void 0===c)throw new P("Received unexpected error response");this.#W.free(b),c.errorCallback(aw(a.error))}else throw am(a,"Impossible ServerMsg type")}openStream(){return aM.open(this)}storeSql(a){this._ensureVersion(2,"storeSql()");let b=this.#X.alloc(),c=new ax(this,b);return this._sendRequest({type:"store_sql",sqlId:b,sql:a},{responseCallback:()=>void 0,errorCallback:a=>c._setClosed(a)}),c}_closeSql(a){if(void 0!==this.#s)return;let b=()=>this.#X.free(a),c=a=>this.#L(a);this._sendRequest({type:"close_sql",sqlId:a},{responseCallback:b,errorCallback:c})}close(){this.#L(new O("Client was manually closed"))}get closed(){return void 0!==this.#s}}var bQ=a.i(57903);if("u">typeof queueMicrotask)b=queueMicrotask;else{let a=Promise.resolve();b=b=>{a.then(b)}}class bR{#d;#ad;#ae;constructor(a){this.#d=new Uint8Array(new ArrayBuffer(a)),this.#ad=0,this.#ae=0}get length(){return this.#ae-this.#ad}data(){return this.#d.slice(this.#ad,this.#ae)}push(a){this.#af(a.byteLength),this.#d.set(a,this.#ae),this.#ae+=a.byteLength}#af(a){if(this.#ae+a<=this.#d.byteLength)return;let b=this.#ae-this.#ad;if(b+a<=this.#d.byteLength&&2*this.#ae>=this.#d.byteLength)this.#d.copyWithin(0,this.#ad,this.#ae);else{let c=this.#d.byteLength;do c*=2;while(b+a>c)let d=new Uint8Array(new ArrayBuffer(c));d.set(this.#d.slice(this.#ad,this.#ae),0),this.#d=d}this.#ae=b,this.#ad=0}shift(a){this.#ad+=a}}function bS(a){let b=Y(a.type);if("ok"===b)return{type:"ok",response:function(a){let b=Y(a.type);if("close"===b)return{type:"close"};if("execute"===b)return{type:"execute",result:bh(ab(a.result))};if("batch"===b)return{type:"batch",result:bj(ab(a.result))};if("sequence"===b)return{type:"sequence"};if("describe"===b)return{type:"describe",result:bl(ab(a.result))};else if("store_sql"===b)return{type:"store_sql"};else if("close_sql"===b)return{type:"close_sql"};else if("get_autocommit"===b)return{type:"get_autocommit",isAutocommit:_(a.is_autocommit)};else throw new P("Unexpected type of StreamResponse")}(ab(a.response))};if("error"===b)return{type:"error",error:bg(ab(a.error))};throw new P("Unexpected type of StreamResult")}function bT(a){return{baton:Z(a.baton),baseUrl:Z(a.base_url)}}let bU={default:()=>({baton:void 0,baseUrl:void 0,results:[]}),1(a,b){b.baton=a.string()},2(a,b){b.baseUrl=a.string()},3(a,b){b.results.push(a.message(bV))}},bV={default:()=>({type:"none"}),1:a=>({type:"ok",response:a.message(bW)}),2:a=>({type:"error",error:a.message(bp)})},bW={default:()=>({type:"none"}),1:a=>({type:"close"}),2:a=>a.message(bX),3:a=>a.message(bY),4:a=>({type:"sequence"}),5:a=>a.message(bZ),6:a=>({type:"store_sql"}),7:a=>({type:"close_sql"}),8:a=>a.message(b$)},bX={default:()=>({type:"execute",result:bq.default()}),1(a,b){b.result=a.message(bq)}},bY={default:()=>({type:"batch",result:bt.default()}),1(a,b){b.result=a.message(bt)}},bZ={default:()=>({type:"describe",result:bA.default()}),1(a,b){b.result=a.message(bA)}},b$={default:()=>({type:"get_autocommit",isAutocommit:!1}),1(a,b){b.isAutocommit=a.bool()}},b_={default:()=>({baton:void 0,baseUrl:void 0}),1(a,b){b.baton=a.string()},2(a,b){b.baseUrl=a.string()}};class b0 extends aK{#B;#ag;#g;#I;#s;#F;constructor(a,b){super(),this.#B=a,this.#ag=b,this.#g=void 0,this.#I=new bR(16384),this.#s=void 0,this.#F=!1}async open(a){if(null===a.body)throw new P("No response body for cursor request");this.#g=a.body[Symbol.asyncIterator]();let b=await this.#ah(bT,b_);if(void 0===b)throw new P("Empty response to cursor request");return b}next(){return this.#ah(bk,bw)}close(){this._setClosed(new O("Cursor was manually closed"))}_setClosed(a){void 0===this.#s&&(this.#s=a,this.#B._cursorClosed(this),void 0!==this.#g&&this.#g.return())}get closed(){return void 0!==this.#s}async #ah(a,b){for(;;){if(this.#F)return;if(void 0!==this.#s)throw new R("Cursor is closed",this.#s);if("json"===this.#ag){let b=this.#ai();if(void 0!==b)return a(ab(JSON.parse(new TextDecoder().decode(b))))}else if("protobuf"===this.#ag){let a=this.#aj();if(void 0!==a)return ai(a,b)}else throw am(this.#ag,"Impossible encoding");if(void 0===this.#g)throw new W("Attempted to read from HTTP cursor before it was opened");let{value:c,done:d}=await this.#g.next();if(d&&0===this.#I.length)this.#F=!0;else if(d)throw new P("Unexpected end of cursor stream");else this.#I.push(c)}}#ai(){let a=this.#I.data(),b=a.indexOf(10);if(b<0)return;let c=a.slice(0,b);return this.#I.shift(b+1),c}#aj(){let a=this.#I.data(),b=0,c=0;for(;;){if(c>=a.byteLength)return;let d=a[c];if(b|=(127&d)<<7*c,c+=1,!(128&d))break}if(a.byteLength<c+b)return;let d=a.slice(c,c+b);return this.#I.shift(c+b),d}}function b1(a,b){void 0!==b.baton&&a.string("baton",b.baton),a.arrayObjects("requests",b.requests,b2)}function b2(a,b){if(a.stringRaw("type",b.type),"close"===b.type);else if("execute"===b.type)a.object("stmt",b.stmt,aN);else if("batch"===b.type)a.object("batch",b.batch,aP);else if("sequence"===b.type)void 0!==b.sql&&a.string("sql",b.sql),void 0!==b.sqlId&&a.number("sql_id",b.sqlId);else if("describe"===b.type)void 0!==b.sql&&a.string("sql",b.sql),void 0!==b.sqlId&&a.number("sql_id",b.sqlId);else if("store_sql"===b.type)a.number("sql_id",b.sqlId),a.string("sql",b.sql);else if("close_sql"===b.type)a.number("sql_id",b.sqlId);else if("get_autocommit"===b.type);else throw am(b,"Impossible type of StreamRequest")}function b3(a,b){void 0!==b.baton&&a.string("baton",b.baton),a.object("batch",b.batch,aP)}function b4(a,b){for(let c of(void 0!==b.baton&&a.string(1,b.baton),b.requests))a.message(2,c,b5)}function b5(a,b){if("close"===b.type)a.message(1,b,b6);else if("execute"===b.type)a.message(2,b,b7);else if("batch"===b.type)a.message(3,b,b8);else if("sequence"===b.type)a.message(4,b,b9);else if("describe"===b.type)a.message(5,b,ca);else if("store_sql"===b.type)a.message(6,b,cb);else if("close_sql"===b.type)a.message(7,b,cc);else if("get_autocommit"===b.type)a.message(8,b,cd);else throw am(b,"Impossible type of StreamRequest")}function b6(a,b){}function b7(a,b){a.message(1,b.stmt,aV)}function b8(a,b){a.message(1,b.batch,aX)}function b9(a,b){void 0!==b.sql&&a.string(1,b.sql),void 0!==b.sqlId&&a.int32(2,b.sqlId)}function ca(a,b){void 0!==b.sql&&a.string(1,b.sql),void 0!==b.sqlId&&a.int32(2,b.sqlId)}function cb(a,b){a.int32(1,b.sqlId),a.string(2,b.sql)}function cc(a,b){a.int32(1,b.sqlId)}function cd(a,b){}function ce(a,b){void 0!==b.baton&&a.string(1,b.baton),a.message(2,b.batch,aX)}class cf extends aJ{#A;#ak;#al;#G;#am;#an;#I;#ao;#J;#K;#ap;#s;#X;constructor(a,b,c,d,e){super(a.intMode),this.#A=a,this.#ak=b.toString(),this.#al=c,this.#G=d,this.#am=e,this.#an=void 0,this.#I=new az,this.#ao=!1,this.#K=!1,this.#ap=!1,this.#s=void 0,this.#X=new al}client(){return this.#A}_sqlOwner(){return this}storeSql(a){let b=this.#X.alloc();return this.#M({type:"store_sql",sqlId:b,sql:a}).then(()=>void 0,a=>this._setClosed(a)),new ax(this,b)}_closeSql(a){void 0===this.#s&&this.#M({type:"close_sql",sqlId:a}).then(()=>this.#X.free(a),a=>this._setClosed(a))}_execute(a){return this.#M({type:"execute",stmt:a}).then(a=>a.result)}_batch(a){return this.#M({type:"batch",batch:a}).then(a=>a.result)}_describe(a){return this.#M({type:"describe",sql:a.sql,sqlId:a.sqlId}).then(a=>a.result)}_sequence(a){return this.#M({type:"sequence",sql:a.sql,sqlId:a.sqlId}).then(a=>{})}getAutocommit(){return this.#A._ensureVersion(3,"getAutocommit()"),this.#M({type:"get_autocommit"}).then(a=>a.isAutocommit)}#M(a){return new Promise((b,c)=>{this.#N({type:"pipeline",request:a,responseCallback:b,errorCallback:c})})}_openCursor(a){return new Promise((b,c)=>{this.#N({type:"cursor",batch:a,cursorCallback:b,errorCallback:c})})}_cursorClosed(a){if(a!==this.#J)throw new W("Cursor was closed, but it was not associated with the stream");this.#J=void 0,b(()=>this.#O())}close(){this._setClosed(new O("Stream was manually closed"))}closeGracefully(){this.#K=!0,b(()=>this.#O())}get closed(){return void 0!==this.#s||this.#K}_setClosed(a){if(void 0===this.#s){for(this.#s=a,void 0!==this.#J&&this.#J._setClosed(a),this.#A._streamClosed(this);;){let b=this.#I.shift();if(void 0!==b)b.errorCallback(a);else break}(void 0!==this.#an||this.#ao)&&!this.#ap&&(this.#I.push({type:"pipeline",request:{type:"close"},responseCallback:()=>void 0,errorCallback:()=>void 0}),this.#ap=!0,b(()=>this.#O()))}}#N(a){if(void 0!==this.#s)throw new R("Stream is closed",this.#s);if(this.#K)throw new R("Stream is closing",void 0);this.#I.push(a),b(()=>this.#O())}#O(){if(this.#ao||void 0!==this.#J)return;if(this.#K&&0===this.#I.length)return void this._setClosed(new O("Stream was gracefully closed"));let a=this.#A._endpoint;if(void 0===a)return void this.#A._endpointPromise.then(()=>this.#O(),a=>this._setClosed(a));let b=this.#I.shift();if(void 0!==b)if("pipeline"===b.type){let c=[b];for(;;){let a=this.#I.first();if(void 0!==a&&"pipeline"===a.type)c.push(a),this.#I.shift();else if(void 0===a&&this.#K&&!this.#ap){c.push({type:"pipeline",request:{type:"close"},responseCallback:()=>void 0,errorCallback:()=>void 0}),this.#ap=!0;break}else break}this.#aq(a,c)}else if("cursor"===b.type)this.#ar(a,b);else throw am(b,"Impossible type of QueueEntry")}#aq(a,b){this.#as(()=>this.#at(b,a),b=>cg(b,a.encoding),a=>a.baton,a=>a.baseUrl,a=>(function(a,b){if(b.results.length!==a.length)throw new P("Server returned unexpected number of pipeline results");for(let c=0;c<a.length;++c){let d=b.results[c],e=a[c];if("ok"===d.type){if(d.response.type!==e.request.type)throw new P("Received unexpected type of response");e.responseCallback(d.response)}else if("error"===d.type)e.errorCallback(aw(d.error));else if("none"===d.type)throw new P("Received unrecognized type of StreamResult");else throw am(d,"Received impossible type of StreamResult")}})(b,a),a=>b.forEach(b=>b.errorCallback(a)))}#ar(a,b){let c=new b0(this,a.encoding);this.#J=c,this.#as(()=>this.#au(b,a),a=>c.open(a),a=>a.baton,a=>a.baseUrl,a=>b.cursorCallback(c),a=>b.errorCallback(a))}#as(a,b,c,d,e,f){let g;try{let b=a();g=(0,this.#G)(b)}catch(a){g=Promise.reject(a)}this.#ao=!0,g.then(a=>a.ok?b(a):ch(a).then(a=>{throw a})).then(a=>{this.#an=c(a),this.#ak=d(a)??this.#ak,e(a)}).catch(a=>{this._setClosed(a),f(a)}).finally(()=>{this.#ao=!1,this.#O()})}#at(a,b){return this.#av(new URL(b.pipelinePath,this.#ak),{baton:this.#an,requests:a.map(a=>a.request)},b.encoding,b1,b4)}#au(a,b){if(void 0===b.cursorPath)throw new V(`Cursors are supported only on protocol version 3 and higher, but the HTTP server only supports version ${b.version}.`);return this.#av(new URL(b.cursorPath,this.#ak),{baton:this.#an,batch:a.batch},b.encoding,b3,ce)}#av(a,b,c,d,e){let f,g;if("json"===c)f=af(b,d),g="application/json";else if("protobuf"===c)f=ak(b,e),g="application/x-protobuf";else throw am(c,"Impossible encoding");let h=new bQ.Headers;return h.set("content-type",g),void 0!==this.#al&&h.set("authorization",`Bearer ${this.#al}`),void 0!==this.#am&&h.set("x-turso-encryption-key",this.#am),new bQ.Request(a.toString(),{method:"POST",headers:h,body:f})}}async function cg(a,b){if("json"===b){var c;return{baton:Z((c=ab(await a.json())).baton),baseUrl:Z(c.base_url),results:ac(c.results,bS)}}if("protobuf"===b)return ai(new Uint8Array(await a.arrayBuffer()),bU);throw await a.body?.cancel(),am(b,"Impossible encoding")}async function ch(a){let b=a.headers.get("content-type")??"text/plain",c=`Server returned HTTP status ${a.status}`;if("application/json"===b){let b=await a.json();return"message"in b?aw(b):new U(c,a.status)}if("text/plain"===b){let b=(await a.text()).trim();return""!==b&&(c+=`: ${b}`),new U(c,a.status)}return await a.body?.cancel(),new U(c,a.status)}let ci=[{versionPath:"v3-protobuf",pipelinePath:"v3-protobuf/pipeline",cursorPath:"v3-protobuf/cursor",version:3,encoding:"protobuf"}],cj={versionPath:"v2",pipelinePath:"v2/pipeline",cursorPath:void 0,version:2,encoding:"json"};class ck extends N{#aw;#al;#G;#am;#s;#ax;_endpointPromise;_endpoint;constructor(a,b,c,d,e=2){super(),this.#aw=a,this.#al=b,this.#G=c??bQ.fetch,this.#am=d,this.#s=void 0,this.#ax=new Set,3==e?(this._endpointPromise=cl(this.#G,this.#aw),this._endpointPromise.then(a=>this._endpoint=a,a=>this.#L(a))):(this._endpointPromise=Promise.resolve(cj),this._endpointPromise.then(a=>this._endpoint=a,a=>this.#L(a)))}async getVersion(){return void 0!==this._endpoint?this._endpoint.version:(await this._endpointPromise).version}_ensureVersion(a,b){if(!(a<=cj.version)){if(void 0===this._endpoint)throw new V(`${b} is supported only on protocol version ${a} and higher, but the version supported by the HTTP server is not yet known. Use Client.getVersion() to wait until the version is available.`);if(this._endpoint.version<a)throw new V(`${b} is supported only on protocol version ${a} and higher, but the HTTP server only supports version ${this._endpoint.version}.`)}}openStream(){if(void 0!==this.#s)throw new R("Client is closed",this.#s);let a=new cf(this,this.#aw,this.#al,this.#G,this.#am);return this.#ax.add(a),a}_streamClosed(a){this.#ax.delete(a)}close(){this.#L(new O("Client was manually closed"))}get closed(){return void 0!==this.#s}#L(a){if(void 0===this.#s)for(let b of(this.#s=a,Array.from(this.#ax)))b._setClosed(new R("Client was closed",a))}}async function cl(a,b){for(let c of ci){let d=new URL(c.versionPath,b),e=new bQ.Request(d.toString(),{method:"GET"}),f=await a(e);if(await f.arrayBuffer(),f.ok)return c}return cj}function cm(a,b,c=2){if(void 0===M.default)throw new S("WebSockets are not supported in this environment");var d=void 0;return d=3==c?Array.from(bO.keys()):Array.from(bN.keys()),new bP(new M.default(a,d),b)}function cn(a,b,c,d,e=2){return new ck(a instanceof URL?a:new URL(a),b,c,d,e)}class co{#ay;#az;#aA;constructor(a,b){this.#ay=a,this.#az=b,this.#aA=void 0}execute(a){return this.batch([a]).then(a=>a[0])}async batch(a){let b=this._getStream();if(b.closed)throw new e("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{let c,d=a.map(cq);if(void 0===this.#aA){this._getSqlCache().apply(d);let a=b.batch(this.#az>=3),e=a.step(),f=e.run(H(this.#ay)),g=e;c=d.map(b=>{let c=a.step().condition(aF.ok(g));this.#az>=3&&c.condition(aF.not(aF.isAutocommit(a)));let d=c.query(b);return d.catch(()=>void 0),g=c,d}),this.#aA=a.execute().then(()=>f).then(()=>void 0);try{await this.#aA}catch(a){throw this.close(),a}}else{let a;this.#az<3&&await this.#aA,this._getSqlCache().apply(d);let e=b.batch(this.#az>=3);c=d.map(b=>{let c=e.step();void 0!==a&&c.condition(aF.ok(a)),this.#az>=3&&c.condition(aF.not(aF.isAutocommit(e)));let d=c.query(b);return d.catch(()=>void 0),a=c,d}),await e.execute()}let g=[];for(let a=0;a<c.length;a++)try{let b=await c[a];if(void 0===b)throw new f("Statement in a transaction was not executed, probably because the transaction has been rolled back",a,"TRANSACTION_CLOSED");g.push(cr(b))}catch(c){if(c instanceof f)throw c;let b=cs(c);if(b instanceof e)throw new f(b.message,a,b.code,b.extendedCode,b.rawCode,b.cause instanceof Error?b.cause:void 0);throw b}return g}catch(a){throw cs(a)}}async executeMultiple(a){let b=this._getStream();if(b.closed)throw new e("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{if(void 0===this.#aA){this.#aA=b.run(H(this.#ay)).then(()=>void 0);try{await this.#aA}catch(a){throw this.close(),a}}else await this.#aA;await b.sequence(a)}catch(a){throw cs(a)}}async rollback(){try{let a=this._getStream();if(a.closed||void 0===this.#aA)return;let b=a.run("ROLLBACK").catch(a=>{throw cs(a)});a.closeGracefully(),await b}catch(a){throw cs(a)}finally{this.close()}}async commit(){try{let a=this._getStream();if(a.closed)throw new e("Cannot commit the transaction because it is already closed","TRANSACTION_CLOSED");if(void 0===this.#aA)return;await this.#aA;let b=a.run("COMMIT").catch(a=>{throw cs(a)});a.closeGracefully(),await b}catch(a){throw cs(a)}finally{this.close()}}}async function cp(a,b,c,d,g=!1){g&&c.step().run("PRAGMA foreign_keys=off");let h=c.step(),i=h.run(H(a)),j=h,k=d.map(a=>{let d=c.step().condition(aF.ok(j));b>=3&&d.condition(aF.not(aF.isAutocommit(c)));let e=d.query(a);return j=d,e}),l=c.step().condition(aF.ok(j));b>=3&&l.condition(aF.not(aF.isAutocommit(c)));let m=l.run("COMMIT");c.step().condition(aF.not(aF.ok(l))).run("ROLLBACK").catch(a=>void 0),g&&c.step().run("PRAGMA foreign_keys=on"),await c.execute();let n=[];await i;for(let a=0;a<k.length;a++)try{let b=await k[a];if(void 0===b)throw new f("Statement in a batch was not executed, probably because the transaction has been rolled back",a,"TRANSACTION_CLOSED");n.push(cr(b))}catch(c){if(c instanceof f)throw c;let b=cs(c);if(b instanceof e)throw new f(b.message,a,b.code,b.extendedCode,b.rawCode,b.cause instanceof Error?b.cause:void 0);throw b}return await m,n}function cq(a){let b,c;Array.isArray(a)?[b,c]=a:"string"==typeof a?b=a:(b=a.sql,c=a.args);let d=new aA(b);if(c)if(Array.isArray(c))d.bindIndexes(c);else for(let[a,b]of Object.entries(c))d.bindName(a,b);return d}function cr(a){return new I(a.columnNames.map(a=>a??""),a.columnDecltypes.map(a=>a??""),a.rows,a.affectedRowCount,void 0!==a.lastInsertRowid?a.lastInsertRowid:void 0)}function cs(a){if(a instanceof O){let b=function a(b){if(b instanceof Q&&void 0!==b.code)return b.code;if(b instanceof P)return"HRANA_PROTO_ERROR";if(b instanceof R)return b.cause instanceof O?a(b.cause):"HRANA_CLOSED_ERROR";if(b instanceof T)return"HRANA_WEBSOCKET_ERROR";if(b instanceof U)return"SERVER_ERROR";else if(b instanceof V)return"PROTOCOL_VERSION_ERROR";else if(b instanceof W)return"INTERNAL_ERROR";else return"UNKNOWN"}(a);return new e(a.message,b,void 0,void 0,a)}return a}class ct{#q;#aB;capacity;constructor(a,b){this.#q=a,this.#aB=new cu,this.capacity=b}apply(a){if(this.capacity<=0)return;let b=new Set;for(let c of a){if("string"!=typeof c.sql)continue;let a=c.sql;if(a.length>=5e3)continue;let d=this.#aB.get(a);if(void 0===d){for(;this.#aB.size+1>this.capacity;){let[a,c]=this.#aB.peekLru();if(b.has(c))break;c.close(),this.#aB.delete(a)}this.#aB.size+1<=this.capacity&&(d=this.#q.storeSql(a),this.#aB.set(a,d))}void 0!==d&&(c.sql=d,b.add(d))}}}class cu{#aC;constructor(){this.#aC=new Map}get(a){let b=this.#aC.get(a);return void 0!==b&&(this.#aC.delete(a),this.#aC.set(a,b)),b}set(a,b){this.#aC.set(a,b)}peekLru(){for(let a of this.#aC.entries())return a}delete(a){this.#aC.delete(a)}get size(){return this.#aC.size}}var cv=a.i(16056);class cw{#aw;#aD;#aE;#aF;#aG;closed;protocol;#aH;#aI;constructor(a,b,c,d,e){this.#aw=b,this.#aD=c,this.#aE=d,this.#aF=this.#aJ(a),this.#aG=void 0,this.closed=!1,this.protocol="ws",this.#aI=(0,cv.default)(e)}async limit(a){return this.#aI(a)}async execute(a,b){let c;return c="string"==typeof a?{sql:a,args:b||[]}:a,this.limit(async()=>{let a=await this.#aK();try{let b=cq(c);a.conn.sqlCache.apply([b]);let d=a.stream.query(b);a.stream.closeGracefully();let e=await d;return cr(e)}catch(a){throw cs(a)}finally{this._closeStream(a)}})}async batch(a,b="deferred"){return this.limit(async()=>{let c=await this.#aK();try{let d=a.map(a=>Array.isArray(a)?{sql:a[0],args:a[1]||[]}:a).map(cq),e=await c.conn.client.getVersion();c.conn.sqlCache.apply(d);let f=c.stream.batch(e>=3),g=cp(b,e,f,d);return await g}catch(a){throw cs(a)}finally{this._closeStream(c)}})}async migrate(a){return this.limit(async()=>{let b=await this.#aK();try{let c=a.map(cq),d=await b.conn.client.getVersion(),e=b.stream.batch(d>=3),f=cp("deferred",d,e,c,!0);return await f}catch(a){throw cs(a)}finally{this._closeStream(b)}})}async transaction(a="write"){return this.limit(async()=>{let b=await this.#aK();try{let c=await b.conn.client.getVersion();return new cx(this,b,a,c)}catch(a){throw this._closeStream(b),cs(a)}})}async executeMultiple(a){return this.limit(async()=>{let b=await this.#aK();try{let c=b.stream.sequence(a);b.stream.closeGracefully(),await c}catch(a){throw cs(a)}finally{this._closeStream(b)}})}sync(){throw new e("sync not supported in ws mode","SYNC_NOT_SUPPORTED")}async #aK(){if(this.closed)throw new e("The client is closed","CLIENT_CLOSED");if(new Date().valueOf()-this.#aF.openTime.valueOf()>6e4&&void 0===this.#aG){let a=this.#aJ();this.#aG=a,a.client.getVersion().then(b=>{this.#aF!==a&&0===this.#aF.streamStates.size&&this.#aF.client.close(),this.#aF=a,this.#aG=void 0},a=>{this.#aG=void 0})}if(this.#aF.client.closed)try{void 0!==this.#aG?this.#aF=this.#aG:this.#aF=this.#aJ()}catch(a){throw cs(a)}let a=this.#aF;try{void 0===a.useSqlCache&&(a.useSqlCache=await a.client.getVersion()>=2,a.useSqlCache&&(a.sqlCache.capacity=100));let b=a.client.openStream();b.intMode=this.#aE;let c={conn:a,stream:b};return a.streamStates.add(c),c}catch(a){throw cs(a)}}#aJ(a){try{return{client:a??=cm(this.#aw,this.#aD),useSqlCache:void 0,sqlCache:new ct(a,0),openTime:new Date,streamStates:new Set}}catch(a){throw cs(a)}}async reconnect(){try{for(let a of Array.from(this.#aF.streamStates))try{a.stream.close()}catch{}this.#aF.client.close()}catch{}if(this.#aG){try{this.#aG.client.close()}catch{}this.#aG=void 0}let a=this.#aJ(),b=await a.client.getVersion();a.useSqlCache=b>=2,a.useSqlCache&&(a.sqlCache.capacity=100),this.#aF=a,this.closed=!1}_closeStream(a){a.stream.close();let b=a.conn;b.streamStates.delete(a),0===b.streamStates.size&&b!==this.#aF&&b.client.close()}close(){if(this.#aF.client.close(),this.closed=!0,this.#aG){try{this.#aG.client.close()}catch{}this.#aG=void 0}this.closed=!0}}class cx extends co{#A;#aL;constructor(a,b,c,d){super(c,d),this.#A=a,this.#aL=b}_getStream(){return this.#aL.stream}_getSqlCache(){return this.#aL.conn.sqlCache}close(){this.#A._closeStream(this.#aL)}get closed(){return this.#aL.stream.closed}}class cy{#A;protocol;#aw;#aE;#aM;#aN;#aD;#am;#aI;constructor(a,b,c,d,e,f){this.#aw=a,this.#aD=b,this.#aE=c,this.#aM=d,this.#aN=e,this.#am=f,this.#A=cn(this.#aw,this.#aD,this.#aM,f),this.#A.intMode=this.#aE,this.protocol="http",this.#aI=(0,cv.default)(this.#aN)}async limit(a){return this.#aI(a)}async execute(a,b){let c;return c="string"==typeof a?{sql:a,args:b||[]}:a,this.limit(async()=>{try{let a,b=cq(c),d=this.#A.openStream();try{a=d.query(b)}finally{d.closeGracefully()}let e=await a;return cr(e)}catch(a){throw cs(a)}})}async batch(a,b="deferred"){return this.limit(async()=>{try{let c,d=a.map(a=>Array.isArray(a)?{sql:a[0],args:a[1]||[]}:a).map(cq),e=await this.#A.getVersion(),f=this.#A.openStream();try{new ct(f,30).apply(d);let a=f.batch(!1);c=cp(b,e,a,d)}finally{f.closeGracefully()}return await c}catch(a){throw cs(a)}})}async migrate(a){return this.limit(async()=>{try{let b,c=a.map(cq),d=await this.#A.getVersion(),e=this.#A.openStream();try{let a=e.batch(!1);b=cp("deferred",d,a,c,!0)}finally{e.closeGracefully()}return await b}catch(a){throw cs(a)}})}async transaction(a="write"){return this.limit(async()=>{try{let b=await this.#A.getVersion();return new cz(this.#A.openStream(),a,b)}catch(a){throw cs(a)}})}async executeMultiple(a){return this.limit(async()=>{try{let b,c=this.#A.openStream();try{b=c.sequence(a)}finally{c.closeGracefully()}await b}catch(a){throw cs(a)}})}sync(){throw new e("sync not supported in http mode","SYNC_NOT_SUPPORTED")}close(){this.#A.close()}async reconnect(){try{this.closed||this.#A.close()}finally{this.#A=cn(this.#aw,this.#aD,this.#aM,this.#am),this.#A.intMode=this.#aE}}get closed(){return this.#A.closed}}class cz extends co{#B;#aO;constructor(a,b,c){super(b,c),this.#B=a,this.#aO=new ct(a,30)}_getStream(){return this.#B}_getSqlCache(){return this.#aO}close(){this.#B.close()}get closed(){return this.#B.closed}}function cA(a){return function(a){if("ws"===a.scheme||"wss"===a.scheme){let b;if("wss"!==a.scheme&&"ws"!==a.scheme)throw new e(`The WebSocket client supports only "libsql:", "wss:" and "ws:" URLs, got ${JSON.stringify(a.scheme+":")}. For more information, please read ${G}`,"URL_SCHEME_NOT_SUPPORTED");if(void 0!==a.encryptionKey)throw new e("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if("ws"===a.scheme&&a.tls)throw new e('A "ws:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");if("wss"===a.scheme&&!a.tls)throw new e('A "wss:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");let c=j(a.scheme,a.authority,a.path);try{b=cm(c,a.authToken)}catch(b){if(b instanceof S){let b="wss"===a.scheme?"https":"http",c=j(b,a.authority,a.path);throw new e(`This environment does not support WebSockets, please switch to the HTTP client by using a "${b}:" URL (${JSON.stringify(c)}). For more information, please read ${G}`,"WEBSOCKETS_NOT_SUPPORTED")}throw cs(b)}return new cw(b,c,a.authToken,a.intMode,a.concurrency)}if("http"===a.scheme||"https"===a.scheme){if("https"!==a.scheme&&"http"!==a.scheme)throw new e(`The HTTP client supports only "libsql:", "https:" and "http:" URLs, got ${JSON.stringify(a.scheme+":")}. For more information, please read ${G}`,"URL_SCHEME_NOT_SUPPORTED");if(void 0!==a.encryptionKey)throw new e("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if("http"===a.scheme&&a.tls)throw new e('A "http:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");if("https"===a.scheme&&!a.tls)throw new e('A "https:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");return new cy(j(a.scheme,a.authority,a.path),a.authToken,a.intMode,a.fetch,a.concurrency,a.remoteEncryptionKey)}throw new e(`The client that uses Web standard APIs supports only "libsql:", "wss:", "ws:", "https:" and "http:" URLs, got ${JSON.stringify(a.scheme+":")}. For more information, please read ${G}`,"URL_SCHEME_NOT_SUPPORTED")}(function(a,b){let c,d;if("object"!=typeof a)throw TypeError(`Expected client configuration as object, got ${typeof a}`);let{url:f,authToken:j,tls:k,intMode:l,concurrency:m}=a;m=Math.max(0,m||20),l??="number";let n=[];f===L&&(f="file::memory:");let o=function(a){let b=g.exec(a);if(null===b)throw new e(`The URL '${a}' is not in a valid format`,"URL_INVALID");let c=b.groups,d=c.scheme,f=void 0!==c.authority?function(a){let b=h.exec(a);if(null===b)throw new e("The authority part of the URL is not in a valid format","URL_INVALID");let c=b.groups,d=i(c.host_br??c.host);return{host:d,port:c.port?parseInt(c.port,10):void 0,userinfo:void 0!==c.username?{username:i(c.username),password:void 0!==c.password?i(c.password):void 0}:void 0}}(c.authority):void 0,j=i(c.path);return{scheme:d,authority:f,path:j,query:void 0!==c.query?function(a){let b=a.split("&"),c=[];for(let a of b){let b,d;if(""===a)continue;let e=a.indexOf("=");e<0?(b=a,d=""):(b=a.substring(0,e),d=a.substring(e+1)),c.push({key:i(b.replaceAll("+"," ")),value:i(d.replaceAll("+"," "))})}return{pairs:c}}(c.query):void 0,fragment:void 0!==c.fragment?i(c.fragment):void 0}}(f),p=o.scheme.toLowerCase(),q="file"===p&&o.path===L&&void 0===o.authority;for(let{key:a,value:b}of(c=q?{cache:{values:["shared","private"],update:(a,b)=>n.push(`${a}=${b}`)}}:{tls:{values:["0","1"],update:(a,b)=>k="1"===b},authToken:{update:(a,b)=>j=b}},o.query?.pairs??[])){if(!Object.hasOwn(c,a))throw new e(`Unsupported URL query parameter ${JSON.stringify(a)}`,"URL_PARAM_NOT_SUPPORTED");let d=c[a];if(void 0!==d.values&&!d.values.includes(b))throw new e(`Unknown value for the "${a}" query argument: ${JSON.stringify(b)}. Supported values are: [${d.values.map(a=>'"'+a+'"').join(", ")}]`,"URL_INVALID");void 0!==d.update&&d?.update(a,b)}let r=0===n.length?"":`?${n.join("&")}`,s=o.path+r;if("libsql"===p)if(!1===k){if(o.authority?.port===void 0)throw new e('A "libsql:" URL with ?tls=0 must specify an explicit port',"URL_INVALID");d=b?"http":"ws"}else d=b?"https":"wss";else d=p;if("http"===d||"ws"===d?k??=!1:k??=!0,"http"!==d&&"ws"!==d&&"https"!==d&&"wss"!==d&&"file"!==d)throw new e(`The client supports only "libsql:", "wss:", "ws:", "https:", "http:" and "file:" URLs, got ${JSON.stringify(o.scheme+":")}. For more information, please read ${G}`,"URL_SCHEME_NOT_SUPPORTED");if("number"!==l&&"bigint"!==l&&"string"!==l)throw TypeError(`Invalid value for intMode, expected "number", "bigint" or "string", got ${JSON.stringify(l)}`);if(void 0!==o.fragment)throw new e(`URL fragments are not supported: ${JSON.stringify("#"+o.fragment)}`,"URL_INVALID");return q?{scheme:"file",tls:!1,path:s,intMode:l,concurrency:m,syncUrl:a.syncUrl,syncInterval:a.syncInterval,readYourWrites:a.readYourWrites,offline:a.offline,fetch:a.fetch,authToken:void 0,encryptionKey:void 0,remoteEncryptionKey:void 0,authority:void 0}:{scheme:d,tls:k,authority:o.authority,path:s,authToken:j,intMode:l,concurrency:m,encryptionKey:a.encryptionKey,remoteEncryptionKey:a.remoteEncryptionKey,syncUrl:a.syncUrl,syncInterval:a.syncInterval,readYourWrites:a.readYourWrites,offline:a.offline,fetch:a.fetch}}(a,!0))}async function cB(a){await a.execute(`
    CREATE TABLE IF NOT EXISTS pages (
      id TEXT PRIMARY KEY,
      recipient_name TEXT NOT NULL,
      sender_email TEXT NOT NULL,
      question TEXT NOT NULL,
      dodge_button TEXT NOT NULL,
      answer TEXT,
      created_at INTEGER NOT NULL,
      answered_at INTEGER
    )
  `),await a.execute(`
    CREATE TABLE IF NOT EXISTS email_subscriptions (
      email TEXT NOT NULL,
      source TEXT NOT NULL,
      subscribed_at INTEGER NOT NULL,
      PRIMARY KEY (email, source)
    )
  `)}let cC={get url(){return`file://${a.P("lib/db.ts")}`}};function cD(a){let b=cC?.env?.[a];if("string"==typeof b&&b.length)return b;let c=globalThis?.process?.env?.[a];if("string"==typeof c&&c.length)return c;let d=globalThis?.[a];if("string"==typeof d&&d.length)return d}function cE(){let a=cD("TURSO_DB_URL")||cD("TURSO_DATABASE_URL"),b=cD("TURSO_DB_AUTH_TOKEN")||cD("TURSO_AUTH_TOKEN");if(!a)throw Error("Missing TURSO_DB_URL (or TURSO_DATABASE_URL) in environment");return{url:a,authToken:b&&b.trim().length?b.trim():void 0}}let cF=null;async function cG(){cF||(cF=(async()=>{let{url:a,authToken:b}=cE(),c={url:a,fetch:globalThis.fetch};b&&(c.authToken=b);let d=cA(c);await cB(d)})().catch(a=>{throw cF=null,a})),await cF}async function cH(){await cG();let{url:a,authToken:b}=cE(),c={url:a,fetch:globalThis.fetch};return b&&(c.authToken=b),cA(c)}function cI(a){let b="number"==typeof a?a:Number(a);return Number.isFinite(b)?b:0}async function cJ(a){let b=await cH(),c=String(a||"").trim();if(!c)return null;let d=await b.execute({sql:"SELECT * FROM pages WHERE id = ? LIMIT 1",args:[c]}),e=d?.rows?.[0];return e?{id:String(e.id),recipient_name:String(e.recipient_name),sender_email:String(e.sender_email||"").trim().toLowerCase(),question:String(e.question),dodge_button:"no"===e.dodge_button?"no":"yes",answer:"yes"===e.answer||"no"===e.answer?e.answer:null,created_at:cI(e.created_at),answered_at:null==e.answered_at?null:cI(e.answered_at)}:null}async function cK(a){let b=await cJ(a);return b?{id:b.id,question:b.question,recepientName:b.recipient_name,answer:b.answer,createdAt:b.created_at}:null}async function cL({params:a}){let{id:b}=await a,c=await cK(b),e=c?.answer??null;return(0,d.jsx)("main",{className:"page",children:(0,d.jsx)("section",{className:"hero",style:{minHeight:"70vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,d.jsxs)("div",{style:{textAlign:"center"},children:["yes"===e&&(0,d.jsx)("div",{style:{fontSize:"28px",fontWeight:600,marginBottom:"20px",letterSpacing:"0.5px"},children:"aha! you made my day "}),"yes"===e?(0,d.jsx)("img",{src:"/images/yes.png",alt:"Yes",style:{width:"220px",maxWidth:"80vw",height:"auto",borderRadius:"20px",boxShadow:"0 16px 40px rgba(0, 0, 0, 0.25)"}}):(0,d.jsx)("span",{style:{fontSize:"96px",lineHeight:1},children:"no"===e?"":""})]})})})}a.s(["default",()=>cL],44978)}];

//# sourceMappingURL=_fc44d010._.js.map